<html><head><title>Jak se p√≠≈°e programovac√≠ jazyk 2: Lexer</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark-href {
	font-size: 0.75em;
	opacity: 0.5;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, KaiTi, STKaiTi, 'ÂçéÊñáÊ•∑‰Ωì', KaiTi_GB2312, 'Ê•∑‰Ωì_GB2312', serif; }
.mono { font-family: Nitti, 'Microsoft YaHei', 'ÂæÆËΩØÈõÖÈªë', monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, KaiTi, STKaiTi, 'ÂçéÊñáÊ•∑‰Ωì', KaiTi_GB2312, 'Ê•∑‰Ωì_GB2312', serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, Nitti, 'Microsoft YaHei', 'ÂæÆËΩØÈõÖÈªë', monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="9524512c-8edc-4049-b39e-5b512821d5ee" class="page sans"><header><h1 class="page-title">Jak se p√≠≈°e programovac√≠ jazyk 2: Lexer</h1></header><div class="page-body"><p id="c864860e-9b70-46e5-b852-41fd1131b488"><time>@2019/02/09</time></p><p id="5f2c0a54-ca38-440b-a5d9-69db0750c99a">V p≈ôedchoz√≠ ƒç√°sti (<a href="Jak se p e programovac jazyk 1 Motivace.html">Jak se p√≠≈°e programovac√≠ jazyk 1: Motivace</a>) jsem popsal motivaci, jen≈æ mƒõ zavedla na trnitou cestu v√Ωvoj√°≈ô≈Ø vlastn√≠ho jazyka. V dne≈°n√≠ ƒç√°sti se pod√≠v√°me na to jak vlastnƒõ m√° m≈Øj jazyk vypadat a taky se na prvn√≠ a pravdƒõpodobnƒõ nejjednodu≈°≈°√≠ komponentu: <em>lexer</em>.</p><h1 id="8b20632d-d3a1-4428-9fba-071aee8b6a86">Self</h1><p id="35bfa657-671b-4658-b31f-e45f2fbdfe8c">Z√°kladn√≠ syntaxi Selfu dob≈ôe popisuje n√°sleduj√≠c√≠ obr√°zek:</p><figure id="8772dd13-3403-4daa-bfde-5edbd6d41144" class="image"><a href="Jak se p e programovac jazyk 2 Lexer/self_syntax_overview.png"><img style="width:1640px" src="Jak se p e programovac jazyk 2 Lexer/self_syntax_overview.png"/></a></figure><p id="53b667d9-a548-42fd-a028-cef2344665c1">Pokud by v√°s zaj√≠maly podrobnosti, doporuƒçuji <a href="https://en.wikipedia.org/wiki/Self_(programming_language)#Description">anglickou wikipedii</a>, <a href="http://handbook.selflanguage.org/">Self handbook</a>, ƒçi m≈Øj paralelnƒõ vych√°zej√≠c√≠ <a href="../Seri l o Selfu.html"><span class="icon">üìÇ</span>Seri√°l o Selfu</a>.</p><h1 id="0a6fd39f-fc58-4c70-9004-c0f8b81b7385">tinySelf</h1><p id="85b76b84-dddf-405a-9136-ff09dc65637e">tinySelf, jak jsem se kdysi nerozv√°≈ænƒõ (uk√°zalo se, ≈æe stejnƒõ pojmenovan√Ω projekt u≈æ kdysi existoval) rozhodl m≈Øj jazyk nazvat, je v podstatƒõ Self, i kdy≈æ trochu ‚Äûvylep≈°en√Ω‚Äú po str√°nce syntaxe.</p><p id="23ea7e83-9ed6-4c1f-997a-2bae013e0097">Nap≈ô√≠klad jsem p≈ôidal podporu pro kask√°dy, jak je pou≈æ√≠v√° Smalltalk. Nikdy jsem nech√°pal, proƒç v p≈Øvodn√≠m Selfu nejsou, kdy≈æ tam dokonale sednou. Taky jsem zmƒõnil <code>&quot;koment√°≈ô&quot;</code> na <code># koment√°≈ô</code>, proto≈æe uvozovky se podle m√©ho n√°zoru v√≠c hod√≠ na stringy, ne≈æ na koment√°≈ôe a tak√© se l√©pe p√≠≈°ou na ƒçesk√© kl√°vesnici, ne≈æ standardn√≠ Selfovsk√© <code>&#x27;stringy&#x27;</code> psan√© jednoduch√Ωmi uvozovkami. Pro stringy je nyn√≠ mo≈æn√© pou≈æ√≠vat oboj√≠, co≈æ ƒçlovƒõku ≈°et≈ô√≠ escapov√°n√≠, pokud zrovna pot≈ôebuje napsat string s uvozovkami.</p><p id="d530fb48-2a2b-49fe-81c1-3b509a152291">Kromƒõ toho jsem zmƒõnil i syntaxi objekt≈Ø a blok≈Ø, kde jsem umo≈ænil vynech√°n√≠ otev√≠rac√≠ho <code>|</code>, tak≈æe je mo≈æn√© ps√°t <code>(slot |)</code> m√≠sto <code>(| slot |)</code>. K parsov√°n√≠ to stejnƒõ nen√≠ zapot≈ôeb√≠ a v≈ædycky mi to p≈ôi≈°lo jako zbyteƒçn√Ω opruz. Chtƒõl jsem p≈ôidat i <code>(| code)</code>, ale uk√°zalo se, ≈æe to u≈æ parseru vad√≠ hodnƒõ, tak≈æe je nutn√© zapisovat objekty bez slot≈Ø jako <code>(|| code)</code>.</p><p id="a70d23a9-f928-4c45-bb4b-7c44100ac5cf">Oproti Selfu tak√© nen√≠ podtr≈æ√≠tko na zaƒç√°tku zpr√°vy rezervovan√© pro vol√°n√≠ primitivn√≠ch zpr√°v. <code>_s</code> je norm√°lnƒõ pou≈æiteln√° un√°rn√≠ zpr√°va. Primitivn√≠ zpr√°vy (vol√°n√≠ k√≥du interpretru) jsou implementovan√© jako zpr√°vy poslan√© objektu <code>primitive</code>. Primitivn√≠ch zpr√°v je stejnƒõ v bƒõ≈æn√©m k√≥du minimum, tak mi nikdy nebylo jasn√©, proƒç by pro nƒõ mƒõla b√Ωt vyhrazen√° syntaxe.</p><h1 id="b5088aa4-3756-46a4-a4fe-dba95d964e61">Lexer</h1><p id="b967d2f3-3fc8-491b-ba3a-c8198a728852">Psan√≠ jazyka zaƒç√≠n√° lexerem. Ten definuje, z jak√Ωch komponent se jazyk skl√°d√° roz≈ôez√°n√≠m zdrojov√©ho k√≥du na <em>tokeny</em>. Ve standardn√≠m imperativn√≠m jazyce to m≈Ø≈æou b√Ωt r≈Øzn√© p≈ô√≠kazy, definice funkce, if podm√≠nky, kl√≠ƒçov√° slova a tak podobnƒõ. V tinySelfu je to vesmƒõs definice objekt≈Ø, slot≈Ø, blok≈Ø, nebo pos√≠l√°n√≠ zpr√°v mezi nimi.</p><p id="c591eed2-1cfb-4674-bbe9-e535edef102e">Lexer v√°m k√≥d roz≈ôe≈æe na pole jednotliv√Ωch element≈Ø. Z k√≥du jako:</p><pre id="f556fa7d-7fd3-40cb-b4e6-9504fd4cddbf" class="code"><code>(| asd = 1 | ^asd.)</code></pre><p id="eed70684-d623-4ab4-82f0-415229e1cabc">v√°m udƒõl√° pole ve stylu:</p><pre id="a0491164-811b-49ff-9b15-30ae5f383f1d" class="code"><code>[
  Token(&quot;OBJ_START&quot;, &quot;(&quot;),
  Token(&quot;SEPARATOR&quot;, &quot;|&quot;),
  Token(&quot;IDENTIFIER&quot;, &quot;asd&quot;),
  Token(&quot;ASSIGNMENT&quot;, &quot;=&quot;),
  Token(&quot;NUMBER&quot;, &quot;1&quot;),
  Token(&quot;SEPARATOR&quot;, &quot;|&quot;),
  Token(&quot;RETURN&quot;, &quot;^&quot;),
  Token(&quot;IDENTIFIER&quot;, &quot;asd&quot;),
  Token(&quot;OBJ_END&quot;, &quot;)&quot;)
]</code></pre><p id="6988b7fd-2227-4e54-b0b6-d1f3bc32bb66">V√Ωstupem je ploch√° struktura, do kter√© byl jen roz≈ôez√°n vstupn√≠ ≈ôetƒõzec a kde byly ke ka≈æd√© ƒç√°sti p≈ôi≈ôazeny typy tokenu.</p><p id="07be088b-1e29-45c9-939e-e38dbe0a1a2a">Lexer je mo≈æn√© si napsat ruƒçnƒõ, formou stavov√©ho automatu, kter√Ω v cyklu proch√°z√≠ k√≥d znak po znaku a postupnƒõ ho roz≈ôez√°v√° a analyzuje roz≈ôezan√© kousky (<em>tokeny</em>), aby jim p≈ôisoudil typ. Kdysi jsem nƒõco podobn√©ho z neznalosti a z nutnosti <a href="https://github.com/Bystroushaak/pyDHTMLParser/blob/master/src/dhtmlparser/__init__.py#L43">udƒõlal</a> (tenkr√°t v D nebyl ≈æ√°dn√Ω lexer), kdy≈æ jsem si psal <a href="https://github.com/Bystroushaak/pyDHTMLParser">HTML parser</a>, proto mi vƒõ≈ôte, kdy≈æ v√°m tento p≈ô√≠stup <strong>D√öRAZNƒö NEDOPORUƒå√çM</strong>.</p><p id="96dce62b-2407-4d7b-96d3-2ec58ffb46dd">Jedn√° o nepru≈æn√Ω, k chyb√°m n√°chyln√Ω, na pochopen√≠ slo≈æit√Ω a tƒõ≈æce udr≈æiteln√Ω p≈ô√≠stup. A≈æ na nƒõkter√© velmi speci√°ln√≠ p≈ô√≠pady, kdy p≈ôesnƒõ v√≠te co dƒõl√°te a proƒç, se v√°m v≈ædy vyplat√≠ pou≈æ√≠t nƒõjakou knihovnu, kterou nakrm√≠te popisy token≈Ø a ona v√°m stavov√Ω automat na z√°kladƒõ popisu vygeneruje.</p><p id="205b13b8-66bb-4fc4-aa0d-d8db05e899b6">V m√©m p≈ô√≠padƒõ se jedn√° o knihovnu <a href="https://rply.readthedocs.io/">rply</a> (podrobnosti p≈ôinese p≈ô√≠≈°t√≠ d√≠l), konkr√©tnƒõ ƒç√°st <a href="https://rply.readthedocs.io/en/latest/users-guide/lexers.html">rply.LexerGenerator</a>.</p><h2 id="7a092455-a136-4588-b1bc-a710628ebeeb">tinySelfov√© tokeny</h2><p id="be067035-9c53-4d35-918c-929c2c214ad8">tinySelf je tvo≈ôen n√°sleduj√≠c√≠mi tokeny:</p><h2 id="753ec819-5d46-4d5f-9826-cb51795b679e">SELF</h2><p id="95bf47e9-46db-4f62-8dbf-0f6129aa5e80">Kl√≠ƒçov√© slovo <code>self</code> tvo≈ô√≠ token Self. Pou≈æit√≠ je podobn√© jako t≈ôeba v pythonu, ƒçi <code>this</code> v javƒõ.</p><h2 id="6da31ed7-77cc-4825-a6a4-7f633529b25a">NUMBER</h2><p id="e712e7b6-a317-499b-9bd7-bd5244b77956">ƒå√≠sla. <code>5</code> je ƒç√≠slo. <code>-5</code> je ƒç√≠slo. <code>4.32</code> je taky ƒç√≠slo, stejnƒõ jako <code>\xFF</code>.</p><h2 id="9c4ae08a-e2ab-49c4-a874-81427d1d398f">OBJ_START</h2><p id="f7519207-a16c-4a33-8597-f2654a468bca">Zaƒç√°tek definice objektu. Jedn√° se jednodu≈°e o z√°vorku <code>(</code> za n√≠≈æ n√°sleduje zbytek objektu.</p><h2 id="0d973a4b-623f-4228-8d84-8c636e52f04b">OBJ_END</h2><p id="09b83185-30d7-4478-b7d5-67c5dfaf09a7">Ukonƒçovac√≠ z√°vorka <code>)</code> znaƒç√≠c√≠ konec objektu. Nejkrat≈°√≠ (pr√°zdn√Ω) objekt v Selfu je <code>()</code>.</p><h2 id="5d3b1b67-1097-4ec5-8f4d-33c3e9a0d1ba">BLOCK_START</h2><p id="293fdb5d-e7b4-40a5-a179-afbf36468b63">Zaƒç√°tek bloku <code>[</code>. Bloky jsou objekty, kter√© maj√≠ <em>parenta</em> nadefinovan√©ho na <em>lok√°ln√≠ scope</em>, tak≈æe se chovaj√≠ podobnƒõ jako lambda funkce.</p><h2 id="bbcac4bb-6d47-469e-8c34-65ffeb33bb53">BLOCK_END</h2><p id="79712cf1-cf03-4d20-a316-35d1dc96d500">Konec bloku <code>]</code>. Nejkrat≈°√≠ blok vypad√° takhle; <code>[]</code>.</p><h2 id="798e3a20-2ac9-4d61-b78c-e8389ba78cce">SINGLE_Q_STRING a DOUBLE_Q_STRING</h2><p id="22934ff7-b6b2-47f3-9648-399ec4069c1a">Definice string≈Ø. Jak jsem zmi≈àoval, bere se ‚Äòstring‚Äô a ‚Äústring‚Äù se standardn√≠ma escape sekvencema.</p><h2 id="037650cd-5a6b-4006-bf34-25b1ea6de368">FIRST_KW</h2><p id="956ffdc7-49a4-4107-907a-4745f844cf41">V Selfu existuj√≠ t≈ôi druhy zpr√°v objekt≈Øm; un√°rn√≠, bin√°rn√≠ a <em>keyword</em>. Un√°rn√≠ nep≈ôij√≠m√° ≈æ√°dn√Ω parametr. Bin√°rn√≠ jeden, <em>keyword</em> pak libovoln√Ω poƒçet.</p><p id="2be4ac3c-b7b5-4a2a-9987-48a7074d9dd6">Self p≈ôinesl oproti Smalltalku drobn√© vylep≈°en√≠, kde <em>keyword</em> zpr√°vy jsou jednoznaƒçnƒõ parsovateln√© prost√Ωm okem t√≠m, ≈æe vynucuje ka≈æd√© n√°sleduj√≠c√≠ kl√≠ƒçov√© slovo zpr√°vy zaƒç√≠nat velk√Ωm p√≠smenem.</p><p id="8db8ad88-5df2-4337-a78c-609b3da1b28c">Ve Smalltalku m≈Ø≈æe zpr√°va <code>at: 1 put: 2</code> znamenat buƒè <code>(at: 1) put: 2</code>, tedy posl√°n√≠ zpr√°vy <code>at:</code> a n√°sledn√© posl√°n√≠ zpr√°vy <code>put:</code> v√Ωsledku z prvn√≠ho vol√°n√≠, nebo posl√°n√≠ zpr√°vy <code>at:put:</code> se dvƒõma parametry <code>1</code> a <code>2</code>. V Selfu je nutn√© druh√Ω popsan√Ω p≈ô√≠pad zapsat jako <code>at: 1 Put: 2</code>, co≈æ jednoznaƒçnƒõ identifikuje kde <em>keyword</em> zpr√°va zaƒç√≠n√° a konƒç√≠. Proto taky lexer rozli≈°uje zaƒç√°tek <em>keyword</em> zpr√°vy (string zaƒç√≠naj√≠c√≠ mal√Ωm p√≠smenem s dvojteƒçkou na konci) a pokraƒçov√°n√≠.</p><h2 id="47b4fb3b-7701-46f4-9cf6-8ac15bd3e90f">KEYWORD</h2><p id="4afa751c-fc37-49fa-b2fb-645baf5381d4">Zmi≈àovan√© pokraƒçov√°n√≠ zpr√°vy. String zaƒç√≠naj√≠c√≠ velk√Ωm p√≠smenem, s dvojteƒçkou na konci.</p><h2 id="52d75364-61cf-4bde-8dee-50775b16516e">IDENTIFIER</h2><p id="619b51c3-dd6e-4e89-acae-64dd5edb2cd1">String zaƒç√≠naj√≠c√≠ mal√Ωm ƒçi velk√Ωm p√≠smenem, ƒçi podtr≈æ√≠tkem n√°sleduj√≠c√≠ t√≠m sam√Ωm, ƒçi ƒç√≠slic√≠. <code>asd</code>, <code>BSD</code>, <code>_A</code> ƒçi <code>_35</code> jsou validn√≠ identifik√°tory, respektive un√°rn√≠ zpr√°vy.</p><h2 id="16353b7e-bb0a-4845-a314-c6d7c81b78cc">OPERATOR</h2><p id="944f2249-c94b-424b-ae5c-6a7b0267378e">Jako oper√°tor (bin√°rn√≠ zpr√°vu) je mo≈æn√© pou≈æ√≠t znaky z mno≈æiny: <code>!@$%&amp;*-+~/?&lt;&gt;,</code> v libovoln√©m poƒçtu opakov√°n√≠. <code>@</code> je oper√°tor, stejnƒõ jako <code>@@</code>.</p><p id="4a7f7a05-ec7c-4d41-9163-3314650a815d">Oper√°tory v≈ædy oƒçek√°vaj√≠ jeden parametr. <code>a + b</code> je bin√°rn√≠ zpr√°va oprer√°toru <code>+</code> s parametrem <code>b</code> zaslan√° objektu <code>a</code>.</p><h2 id="83da27ec-5146-4ae7-b966-7a5f058d56d2">ARGUMENT</h2><p id="af5e9b81-888b-4968-9726-11e51edd655f">Hlavnƒõ u blok≈Ø je pot≈ôeba napsat co za argumenty p≈ôij√≠maj√≠. Argumenty se zapisuj√≠ jako identifik√°tory zaƒç√≠naj√≠c√≠ dvojteƒçkou.</p><p id="cd7690aa-b983-42e2-b580-a09333e94018">Uk√°zky:</p><p id="cce17b42-6bd2-401b-8f38-2a2fd9ecc5e8"><code>:a</code></p><p id="2031c169-76a8-4870-9c91-bd2b10b8ad01"><code>:parameter</code></p><p id="0426728d-0e56-43fe-a07b-5ccf6c6f8531"><code>:_</code></p><p id="dee373ce-6fdf-440f-b6dc-af457a9b457d"><code>:_5OK</code></p><h2 id="230107dd-1f0c-42d8-9619-de7d4f3d426a">ASSIGNMENT</h2><p id="714a6f95-b883-4470-927b-5b28d387b80c">Speci√°ln√≠ oper√°tor p≈ôi≈ôazen√≠. M√° v√Ωznam v definici slot≈Ø, kde definuje sloty pouze ke ƒçten√≠. Tak√© je ho mo≈æn√© pou≈æ√≠t jako bƒõ≈æn√Ω oper√°tor (bin√°rn√≠ zpr√°vu). Zapisuje se jako znak pro rovn√° se (<code>=</code>).</p><h2 id="a391da66-4ccf-417d-a1b9-ab4a28815dfb">RW_ASSIGNMENT</h2><p id="b6874338-b77d-45fd-8843-9d399c3ba91b">P≈ôi≈ôazen√≠ do slotu ke ƒçten√≠ i z√°pisu. Takto jde p≈ôi≈ôazovat pouze konstanty, nebo reference na jin√© objekty, nikoliv metody.</p><p id="d6c99af6-1725-49a5-b148-f3fea8dd7b1c">Zapisuje se jako ≈°ipka do leva (<code>&lt;-</code>).</p><h2 id="078a79d8-8ac5-4b80-b775-eba8a111d1c8">RETURN</h2><p id="c8cdc9dc-6a85-482b-a70b-03954b4ff9be">Vr√°cen√≠ hodnoty z objektu / bloku. Zapisuje se jako st≈ô√≠≈°ka (<code>^</code>).</p><h2 id="0b8a4c07-48a4-489e-973e-d303d0e43288">END_OF_EXPR</h2><p id="fba1e9ba-e31b-407f-9082-8b922d444534">Konec v√Ωrazu. Oddƒõluje ≈ôetƒõzce zpr√°v. Zapisuje se stejnƒõ jako ve Smalltalku teƒçkou (<code>.</code>).</p><h2 id="d77d9cfc-80f0-495f-a861-fd2c4eaeae8f">SEPARATOR</h2><p id="f2074862-865a-4470-953e-0bdd7810ad80">Oddƒõlovaƒç slot≈Ø od k√≥du. Zapisuje se jako svisl√° ƒç√°rka (<code>|</code>).</p><h2 id="b616fedf-4097-4b20-9c07-d26fcacd17de">CASCADE</h2><p id="d67732f0-d366-4dec-a741-e363fc388d4b">Vyhrazen√Ω oper√°tor kask√°dy. Zapisuje se jako st≈ôedn√≠k (<code>;</code>). Sdƒõluje interpretru, ≈æe n√°sleduj√≠c√≠ zpr√°va se pos√≠l√° stejn√©mu objektu jako p≈ôedchoz√≠.</p><h2 id="451df77c-70c1-457d-af0d-856221443d37">COMMENT</h2><p id="ca8fb076-fc00-42d4-a340-2886f55334c6">Koment√°≈ô zaƒç√≠naj√≠c√≠ <code>#</code>, konƒç√≠c√≠ koncem ≈ô√°dku.</p><h2 id="043f5e92-cbb7-4fa1-9e88-c1140e50ee46">Je≈°tƒõ k lexeru</h2><p id="c6cf9848-af5d-440a-8396-0269c5afd865">M≈Ø≈æe se zd√°t, ≈æe v lexeru je toho spousta, ale ve skuteƒçnosti je cel√Ω jazyk dost jednoduch√Ω a uk√°zka v≈°eho co je v nƒõm mo≈æn√© se vejde tak nƒõjak na pohlednici:</p><pre id="bc1599af-2247-4fa3-87cb-5073515d9ba8" class="code"><code>()  # Pr√°zdn√Ω objekt.
(| |)  # Taky pr√°zdn√Ω objekt, ale s definic√≠ (pr√°zdn√Ωch) slot≈Ø.
(| slot |)  # Objekt obsahuj√≠c√≠ jeden slot (key/val storage, kde slot = nil.).

# Objekt obsahuj√≠c√≠ definice dvou slot≈Ø; read only ‚Äös‚Äò a zapisovateln√©ho slotu ‚Äös2‚Äò.
# Ekvivalentn√≠ slovn√≠ku {&quot;s&quot;: None, &quot;s2&quot;: 1}, kdy≈æ pominu zapisovatelnost slot≈Ø.
(| s = nil. s2 &lt;- 1 |)

# Objekt obsahuj√≠c√≠ slot ‚Äös‚Äò, a taky k√≥d, kter√Ω tomuto slotu po≈°le un√°rn√≠ zpr√°vu ‚ÄöprintLine‚Äò. Posledn√≠ v√Ωraz je v≈ædy vr√°cen, tak≈æe bude vr√°cena hodnota slotu ‚Äös‚Äò.
(s = 1 | s printLine. s)
(| s = 1. | s printLine. ^s. )  # Toto≈æn√Ω k√≥d jako v p≈ôedchoz√≠m p≈ô√≠padƒõ s alternativn√≠ syntax√≠ slot≈Ø a explicitn√≠ return.

[ ]  # pr√°zdn√Ω blok
[:a | a printLine. a]  # blok p≈ôij√≠maj√≠c√≠ parametr ‚Äöa‚Äò, kter√Ω vyp√≠≈°e posl√°n√≠m zpr√°vy ‚ÄöprintLine‚Äò a vr√°t√≠.
[| :a | a printLine. exit: a.]  # toto≈æn√Ω k√≥d - return v bloku vrac√≠ z nad≈ôazen√©ho scope, nikoliv jen z bloku samotn√©ho!.

# Komplexnƒõj≈°√≠ objekt obsahuj√≠c√≠ asi v≈°echny elementy jazyka.
( a = 1. b &lt;- 2. c |
  (a + b) &gt; 0
    ifTrue: [c: a+b. ^c]
    False: [self logger log: a; log b.].

  logger log: &#x27;Vsechny zpravy se prvne resolvuji na Self&#x27;.
  self logger log: &quot;Toto je tedy totozna zprava&quot;.

  ^ (| output = &quot;vysledek&quot;. line &lt;- &quot;metody&quot; |)
)</code></pre><p id="544b8f83-4919-4bff-90f9-ac89f91115d2">Cel√Ω k√≥d lexeru se vejde na 40 ≈ô√°dek a jde jen o definici jednotliv√Ωch element≈Ø jazyka pomoc√≠ regexp≈Ø:</p><pre id="ab9a968b-b114-4473-bb13-8025370d6874" class="code"><code># -*- coding: utf-8 -*-
from rply import LexerGenerator


lg = LexerGenerator()
lg.ignore(r&#x27;\s+&#x27;)

lg.add(&#x27;SELF&#x27;, r&#x27;self&#x27;)

lg.add(&#x27;NUMBER&#x27;, r&#x27;(0x[0-9a-fA-F]+)|((\-)?\d+(\.\d)?)&#x27;)

lg.add(&#x27;OBJ_START&#x27;, r&#x27;\(&#x27;)
lg.add(&#x27;OBJ_END&#x27;, r&#x27;\)&#x27;)

lg.add(&#x27;BLOCK_START&#x27;, r&#x27;\[&#x27;)
lg.add(&#x27;BLOCK_END&#x27;, r&#x27;\]&#x27;)

lg.add(&#x27;SINGLE_Q_STRING&#x27;, r&quot;&#x27;(?:\\.|[^&#x27;\\])*&#x27;&quot;)
lg.add(&#x27;DOUBLE_Q_STRING&#x27;, r&#x27;&quot;(?:\\.|[^&quot;\\])*&quot;&#x27;)

lg.add(&#x27;FIRST_KW&#x27;, r&#x27;([a-z_][a-zA-Z0-9_]*\.)*[a-z_]+[a-zA-Z0-9_]*:&#x27;)
lg.add(&#x27;KEYWORD&#x27;, r&#x27;[A-Z]+[a-zA-Z0-9_]*:&#x27;)
lg.add(&#x27;ARGUMENT&#x27;, r&#x27;:[a-zA-Z_]*[a-zA-Z0-9_]+&#x27;)

lg.add(&#x27;RW_ASSIGNMENT&#x27;, r&#x27;\&lt;-&#x27;)

lg.add(&#x27;OPERATOR&#x27;, r&#x27;[!@\$%&amp;\*\-\+~/?&lt;&gt;,]+|==+&#x27;)
lg.add(&#x27;RETURN&#x27;, r&#x27;\^&#x27;)
lg.add(&#x27;END_OF_EXPR&#x27;, r&#x27;\.&#x27;)
lg.add(&#x27;SEPARATOR&#x27;, r&#x27;\|&#x27;)
lg.add(&#x27;CASCADE&#x27;, r&#x27;\;&#x27;)

lg.add(&#x27;IDENTIFIER&#x27;, r&#x27;([a-zA-Z_][a-zA-Z0-9_]*\.)*[a-zA-Z_]*[a-zA-Z0-9_\*]+&#x27;)

lg.add(&#x27;ASSIGNMENT&#x27;, r&#x27;=&#x27;)

lg.add(&#x27;COMMENT&#x27;, r&#x27;#.*[\n|$]?&#x27;)


lexer = lg.build()</code></pre><h1 id="1583ad73-574e-45ec-abb1-961d09c57101">Pokraƒçov√°n√≠</h1><p id="68d98e0a-9d17-47fc-8427-86b8e9a270d7">V p≈ô√≠≈°t√≠m d√≠le se pod√≠v√°me na parser, kter√Ω tokeny bere a sestavuje z nich AST - <a href="https://cs.wikipedia.org/wiki/Syntaktick%C3%BD_strom">abstraktn√≠ syntaktick√Ω strom</a>.</p><h1 id="18653535-6f1e-4db5-924a-13246757a5a2">Relevantn√≠ diskuze</h1><ul id="8e9b3cbf-e1b8-4784-a1d8-c42b17cd866c" class="bulleted-list"><li><a href="http://www.abclinuxu.cz/blog/bystroushaak/2019/2/jak-se-pise-programovaci-jazyk-2-lexer">Jak se p√≠≈°e programovac√≠ jazyk 2: Lexer</a> (abclinuxu)</li></ul><p id="e830f99a-ad2b-4be8-af9a-4f96fee5965b"></p></div></article></body></html>
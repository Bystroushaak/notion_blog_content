<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Stackless python</title>
  <link rel="stylesheet" type="text/css" href="../../style.css">
  <link rel="alternate" type="application/atom+xml" href="https://blog.rfox.eu/atom_cz.xml">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Bystroushaak">
  <meta name="twitter:title" content="Stackless python">
  <meta name="twitter:description" content="UkÃ¡zka instalace a pouÅ¾itÃ­ stackless pythonu.">
  <script src="../../scripts.js"></script>
  <meta name="description" content="UkÃ¡zka instalace a pouÅ¾itÃ­ stackless pythonu.">
  <meta name="keywords" content="python,stackless,m0wFG3PRCoJVTs7JcgBwsOXb3U7yPxBB"><!-- Global site tag (gtag.js) - Google Analytics -->

  <script src="https://www.googletagmanager.com/gtag/js?id=UA-142545439-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-142545439-1');
  </script>
</head>
<body onload="on_body_load();">
  <div id="sidebar_top">
    <span><a href="https://blog.rfox.eu/atom_cz.xml"><img style="width: 3em;" src="../../rss_icon.png"></a> &nbsp; &nbsp; <a href="https://twitter.com/Bystroushaak"><img style="width: 3em;" src="../../twitter_icon.png"></a></span>
    <div id="last_five_top">
      <h3>New posts</h3>
      <ul>
        <li>
          <a href="../Povidky/Software.html" title="Software">Software</a>
        </li>
        <li>
          <a href="../Ostatni/Paromobilita_je_budoucnost.html" title="Paromobilita je budoucnost">Paromobilita je budoucnost</a>
        </li>
        <li>
          <a href="../Ostatni/Algoritmus_hledani_programatorske_prace_2021-4.html" title="Algoritmus hledÃ¡nÃ­ programÃ¡torskÃ© prÃ¡ce 2021/4">Algoritmus hledÃ¡nÃ­ programÃ¡torskÃ© prÃ¡ce 2021/4</a>
        </li>
        <li>
          <a href="../3D_tisk/Nastaveni_Blenderu_pro_3D_tisk.html" title="NastavenÃ­ Blenderu pro 3D tisk">NastavenÃ­ Blenderu pro 3D tisk</a>
        </li>
        <li>
          <a href="../3D_modelovani/Geometricky_stred_Prahy.html" title="GeometrickÃ½ stÅ™ed Prahy">GeometrickÃ½ stÅ™ed Prahy</a>
        </li>
        <li>
          <a href="../../Utrzky/Posta_poezie.html" title="PoÅ¡ta (poezie)"><span class="icon">ğŸ—’ï¸</span>PoÅ¡ta (poezie)</a>
        </li>
        <li>
          <a href="../Ostatni/Statni_zklamani.html" title="StÃ¡tnÃ­ zklamÃ¡nÃ­">StÃ¡tnÃ­ zklamÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_TODO_list_1_Drzak_na_sluchatka.html" title="3D TODO list 1; DrÅ¾Ã¡k na sluchÃ¡tka">3D TODO list 1; DrÅ¾Ã¡k na sluchÃ¡tka</a>
        </li>
        <li>
          <a href="../Ostatni/Dva_podvodnici.html" title="Dva podvodnÃ­ci">Dva podvodnÃ­ci</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_tiskarna_Prusa_MK3S_sestaveni_a_prvni_tisk.html" title="3D tiskÃ¡rna PrÅ¯Å¡a MK3S+; sestavenÃ­ a prvnÃ­ tisk">3D tiskÃ¡rna PrÅ¯Å¡a MK3S+; sestavenÃ­ a prvnÃ­ tisk</a>
        </li>
      </ul>& <a href="../../Zmeny.html" title="ZmÄ›ny">more</a>
    </div>
    <div>
      <h3>Tagy</h3>
      <p><a href="../../Tagy/python.html" title="python">python</a>, <a href="../../Tagy/stackless.html" title="stackless">stackless</a></p>
    </div>
    <div>
      <h3>Blog categories</h3>
      <ul class="no_icon">
        <li>
          <a href="../3D_modelovani.html" title="3D modelovÃ¡nÃ­">ğŸ“‚ 3D modelovÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../3D_tisk.html" title="3D tisk">ğŸ“‚ 3D tisk</a>
        </li>
        <li>
          <a href="../Abclinuxu.html" title="Abclinuxu">ğŸ“‚ Abclinuxu</a>
        </li>
        <li>
          <a href="../Crypto.html" title="Crypto">ğŸ“‚ Crypto</a>
        </li>
        <li>
          <a href="../Hardware.html" title="Hardware">ğŸ“‚ Hardware</a>
        </li>
        <li>
          <a href="../Hrbitov.html" title="HÅ™bitov">ğŸ“‚ HÅ™bitov</a>
        </li>
        <li>
          <a href="../Knihy.html" title="Knihy">ğŸ“‚ Knihy</a>
        </li>
        <li>
          <a href="../Ostatni.html" title="OstatnÃ­">ğŸ“‚ OstatnÃ­</a>
        </li>
        <li>
          <a href="../Povidky.html" title="PovÃ­dky">ğŸ“‚ PovÃ­dky</a>
        </li>
        <li>
          <a href="../Predstaveni.html" title="PÅ™edstavenÃ­">ğŸ“‚ PÅ™edstavenÃ­</a>
        </li>
        <li>
          <a href="../Programovani.html" title="ProgramovÃ¡nÃ­">ğŸ“‚ ProgramovÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../index.html" title="Czech section">ğŸ“‚ Czech section</a>
        </li>
      </ul>
    </div>
  </div><a class="breadcrumb" href="../../index.html" title="Bystroushaak's blog">Bystroushaak's blog</a> / <a class="breadcrumb" href="../index.html" title="Czech section">Czech section</a> / <a class="breadcrumb" href="index.html" title="ProgramovÃ¡nÃ­">ProgramovÃ¡nÃ­</a> / Stackless python
  <article id="9fcd4e00-dd05-4c36-b289-5623320f26d8" class="page sans">
    <header>
      <h1 class="page-title">Stackless python</h1>
    </header>
    <div class="page-body">
      <p id="12dd033d-33ed-4828-a0b4-42fe6fcb77a8" class=""><time>@2013/10/28</time></p>
      <p id="4e86ff17-8e3d-448c-9828-fe92ba70b91d" class="">MoÅ¾nÃ¡ jste nÄ›kdy mÄ›li na potÅ™ebu paralelizace vaÅ¡eho pythonnÃ­ho scriptu a thready se pro vÃ¡s ukÃ¡zaly jako nevhodnÃ© z dÅ¯vodu jejich vysokÃ© nÃ¡roÄnosti (zkuste si spustit 800 threadÅ¯ a pochopÃ­te o Äem mluvÃ­m). PÅ™esnÄ› pro takovÃ©to pÅ™Ã­pady byl vytvoÅ™en&nbsp;<a href="http://www.stackless.com/">Stackless python</a>, kterÃ½ vÃ¡m umoÅ¾nÃ­ pouÅ¾Ã­vat microthready/korutiny/tasklety za pouÅ¾itÃ­ preemptivnÃ­ho multitaskingu.</p>
      <h1 id="f3d0a13f-a85f-454f-ac40-bacf31fbaafa" class="">Update</h1>
      <p id="dc3e4aff-b45e-48b7-968a-64a78a6beb4c" class=""><strong>Na zÃ¡kladÄ› diskuze jsem se dozvÄ›dÄ›l, Å¾e pythonnÃ­ interpreter PyPy mÃ¡ v sobÄ› podporu Stackless pÅ™Ã­mo&nbsp;</strong><a href="http://pypy.org/features.html#stackless"><strong>zabudovanou</strong></a><strong>. Pokud uvaÅ¾ujete o pouÅ¾itÃ­ Stackless, tak tohle asi bude lepÅ¡Ã­ cesta, neÅ¾ kompilace interpreteru.</strong></p>
      <h1 id="9870b8c9-fafd-4ed9-a07c-7151ead1ed31" class="">Instalace</h1>
      <p id="a5eacc2b-f18f-4e91-8aed-72de3c9181d3" class="">Instalaci jsem provÃ¡dÄ›l na Mintu 13, ale mÄ›la by bÃ½t dost podobnÃ¡ na tÃ©mÄ›Å™ vÅ¡ech debianovskÃ½ch systÃ©mech, kde jiÅ¾ je nainstalovÃ¡n python 2.7. Postup je pomÄ›rnÄ› jednoduchÃ½, ale je nutnÃ© kompilovat a upravit jeden konfigurÃ¡k. NÃ­Å¾e uvedenÃ© pÅ™Ã­kazy to automatizujÃ­ tak, Å¾e je v podstatÄ› jen staÄÃ­ napastovat do konzole a obÄas zadat heslo na roota.</p>
      <p id="0e108160-c8b1-4ab2-8ead-bc22fbbb16b3" class="">NÃ¡vod je zaloÅ¾enÃ½ na ÄlÃ¡nku&nbsp;<a href="http://architects.dzone.com/articles/install-stackless-python">Install Stackless Python on Ubuntu</a>.</p>
      <h2 id="14afaf17-f170-4c73-bea5-fde21094b410" class="">PÅ™Ã­prava systÃ©mu</h2>
      <pre id="3c0f31e3-c8b3-4ef0-80e2-abe110528b50" class="code"><code>sudo apt-get update
sudo apt-get install libreadline-dev
sudo apt-get build-dep python2.7</code></pre>
      <h2 id="5d05e119-2c71-4f63-9b44-27975c1a234a" class="">StaÅ¾enÃ­ poslednÃ­ verze stackless pythonu</h2>
      <pre id="ea7b9cbd-7097-4bb3-ae90-163c6cd349bc" class="code"><code>cd /tmp
LAST_SL=`wget http://www.stackless.com/binaries/ -O - 2&gt;/dev/null | grep export.tar.bz2 | grep -v md5 | cut -d '"' -f 8 | grep "stackless-2" | sort | tail -n 1`
wget "http://www.stackless.com/binaries/$LAST_SL"
 
tar -xvf $LAST_SL
rm $LAST_SL
LAST_SL=`echo $LAST_SL | cut -d "." -f 1`
cd $LAST_SL</code></pre>
      <h2 id="3645251f-1386-4a6a-a89f-36b25a606832" class="">Kompilace a instalace</h2>
      <pre id="c756ac7a-000f-4476-81d9-ddf5103966e3" class="code"><code>./configure --prefix=/opt/stackless --enable-unicode=ucs4
make
sudo make install</code></pre>
      <h2 id="183e8e23-4896-4182-86bb-704f66320045" class="">PoinstalaÄnÃ­ fix</h2>
      <p id="5bac87c1-8575-4f53-ba0d-b6e7100d936c" class="">DoplnÄ›nÃ­ symlinkÅ¯ na standardnÃ­ pythonnÃ­ moduly a Ãºprava cest, kde mÃ¡ stackless hledat moduly. Ãšprava konfigurÃ¡ku probÄ›hne automaticky, pouÅ¾il jsem k tomu python, protoÅ¾e se mi nechtÄ›lo hrÃ¡t si 7 hodin se&nbsp;sedem a jeho escape sekvencemi.</p>
      <pre id="48e86243-cfc1-4cac-90e5-aa741694fb4b" class="code"><code>sudo ln -s /usr/lib/python2.7/dist-packages/ /opt/stackless/lib/python2.7/site-packages
sudo ln -s /usr/local/lib/python2.7/dist-packages/ /opt/stackless/lib/python2.7/dist-packages
sudo ln -s /opt/stackless/bin/python /usr/bin/stackless
 
cd /opt/stackless/lib/python2.7/
sudo python -c "a = '            sitepackages.append(os.path.join(prefix, \"lib\", \"site-python\"))'; print open('site.py').read().replace(a, '            sitepackages.append(os.path.join(prefix, \"lib\", \"python\" + sys.version[:3], \"dist-packages\"))\n'+a)" &gt; /tmp/site_.py
sudo mv /tmp/site_.py site.py</code></pre>
      <h2 id="5cff882a-ed1a-4fed-9a49-d15fd01d32f3" class="">OdstranÄ›nÃ­ instalaÄnÃ­ho smetÃ­</h2>
      <pre id="f5df5400-5591-4109-800f-e01be3d65e0a" class="code"><code>cd /tmp
rm -fr $LAST_SL</code></pre>
      <h3 id="ab85fe3d-2113-4295-a0dd-14e25de3d9a3" class="">Test interpreteru</h3>
      <p id="25af12c1-a6f6-42f7-886b-50395ccd8864" class="">Interpreter se spouÅ¡tÃ­ pÅ™Ã­kazem&nbsp;<code>stackless</code>.</p>
      <pre id="4210aa2f-8508-464c-b2f5-e1d16385f084" class="code"><code>$ stackless
Python 2.7.5 Stackless 3.1b3 060516 (default, Oct 28 2013, 15:34:27) 
[GCC 4.6.3] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import stackless
&gt;&gt;&gt;</code></pre>
      <h1 id="70ec54fa-2299-40c9-83b8-39f1fb6aedd2" class="">PouÅ¾Ã­vÃ¡nÃ­</h1>
      <p id="00f85fba-358b-4647-9087-ccd029388363" class="">Z programÃ¡torskÃ©ho hlediska probÃ­hajÃ­ interakce skrze modul&nbsp;<code>stackless</code>, kterÃ½ si ve Stackless interpreteru naimportujete. V klasickÃ©m pythonu vÃ¡m importovat nepÅ¯jde, protoÅ¾e pro svÅ¯j bÄ›h vyÅ¾aduje Ãºpravy interpreteru a zpÅ¯sobu, jakÃ½m jsou volÃ¡ny funkce (stackless = bez stacku).</p>
      <h2 id="6cfabd01-d89f-4fee-ba15-53a48309fb14" class="">VytvoÅ™enÃ­ taskletu</h2>
      <pre id="b09f238a-26b2-40aa-8c2f-527c7aa48cc6" class="code"><code>&gt;&gt;&gt; import stackless
&gt;&gt;&gt; def funkce(parametr):
...     print parametr
... 
&gt;&gt;&gt; t = stackless.tasklet(funkce)("prvni")
&gt;&gt;&gt;</code></pre>
      <p id="e9dc9998-a8d9-4232-ac1a-3dece8ec2077" class="">Co se vlastnÄ› ve vÃ½Å¡e uvedenÃ©m kÃ³du stalo? VytvoÅ™il jsem funkci nazvanou poeticky&nbsp;<code>funkce</code>, kterÃ¡ pÅ™ijÃ­mÃ¡ jeden&nbsp;<code>parametr</code>, jenÅ¾ je vypsÃ¡n na&nbsp;<code>stdout</code>. Z tÃ©to funkce jsem potÃ© udÄ›lal takzvanÃ½&nbsp;tasklet&nbsp;a pÅ™edal mu textovÃ½ parametr&nbsp;â€<code>prvnÃ­</code>â€œ.</p>
      <p id="833e7a6b-896c-4fa5-9cd9-8deccc58ca2f" class=""><em>Tasklet</em>&nbsp;byl automaticky pÅ™idÃ¡n do internÃ­ fronty uvnitÅ™ modulu&nbsp;<code>stackless</code>. Reference na nÄ›j byla uloÅ¾ena do promÄ›nnÃ©&nbsp;<code>t</code>.</p>
      <h2 id="2b452926-b467-40f9-82c3-99867077fa60" class="">Operace nad tasklety</h2>
      <p id="005ed073-c73e-400f-9416-30da9c57531d" class="">Jak uÅ¾ jsem psal, jednotlivÃ©&nbsp;<em>tasklety</em>&nbsp;jsou uchovÃ¡vÃ¡ny ve frontÄ›&nbsp;taskletÅ¯, Do tÃ©to fronty mohou bÃ½t pÅ™idÃ¡vÃ¡ny pomocÃ­&nbsp;<code>.insert()</code>, kterÃ¡&nbsp;<em>tasklet</em>&nbsp;pÅ™idÃ¡ na konec fronty a takÃ© z nÃ­ mohou bÃ½t odebÃ­rÃ¡ny pomocÃ­&nbsp;<code>.remove()</code>. Pokud chcete pÅ™esunout konkrÃ©tnÃ­&nbsp;<em>tasklet</em>&nbsp;na zaÄÃ¡tek fronty a spustit ho, pouÅ¾ijte&nbsp;<code>.run()</code>. Jestli potÅ™ebujete&nbsp;tasklet&nbsp;zabÃ­t, tak&nbsp;<code>.kill()</code>.</p>
      <p id="51c43292-47d8-48d7-9af4-83a6ab308e6f" class="">Pro Ãºplnost dodÃ¡m, Å¾e tyto metody se volajÃ­ pÅ™Ã­mo nad instancÃ­ konkrÃ©tnÃ­ho&nbsp;taskletu, tedy nad&nbsp;t&nbsp;z ukÃ¡zky, nikoliv nad modulem&nbsp;stackless.</p>
      <h3 id="9a524905-90ed-41ae-9c78-4826a8d3fdd2" class="">UkÃ¡zka</h3>
      <p id="b505bdbb-94a2-41df-9544-5becd9349446" class="">Pokud zavolÃ¡me nad konkrÃ©tnÃ­m&nbsp;<em>taskletem</em>&nbsp;<code>.run()</code>, tak se pÅ™esune na vrchol fronty a provede:</p>
      <pre id="b6e78b50-944d-4d4f-a578-4fcb532e7513" class="code"><code>&gt;&gt;&gt; t.run()
prvni</code></pre>
      <p id="9c9e3333-6f29-4f9f-91b2-a7900c6508ee" class=""><em>Tasklet</em>&nbsp;mÅ¯Å¾e probÄ›hnout jen jednou, proto pokusÃ­me-li se ho spustit znova, dostaneme chybu:</p>
      <pre id="0f813409-3e82-44d7-b115-fa244939830e" class="code"><code>&gt;&gt;&gt; t.run()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
RuntimeError: You cannot run an unbound(dead) tasklet</code></pre>
      <h2 id="b1139fc3-bf22-49a0-a33b-bb220409cdea" class="">BÄ›h fronty taskletÅ¯</h2>
      <p id="46718738-c389-48e7-86fb-bb4cb8189bb1" class="">VÃ½Å¡e uvedenÃ© ukÃ¡zky nejsou moc platnÃ© a v podstatÄ› neukazujÃ­ nic, co by neumÄ›l python sÃ¡m o sobÄ›. NynÃ­ vÃ¡m pÅ™edvedu, jak spustit celou frontu&nbsp;taskletÅ¯:</p>
      <pre id="470fe753-af98-4e1a-a0a9-6df88e7d5e7e" class="code"><code>#!/usr/bin/env stackless
# -*- coding: utf-8 -*-
import time
import stackless
 
 
def funkce(parametr):
    t1 = time.time()
    print "starting", parametr, t1
     
    for i in range(10000000):
        pass
 
    t2 = time.time()
    print "ending", parametr, t2, "-", t2 - t1
 
 
stackless.tasklet(funkce)("prvni")
stackless.tasklet(funkce)("druhy")
stackless.tasklet(funkce)("treti")
 
 
while stackless.getruncount() &gt; 1:
    t = stackless.run(100)
 
    if t:
        t.insert()</code></pre>
      <p id="c9941a31-2913-4349-b6bf-69d69f8e9b44" class=""><code>funkce()</code>&nbsp;tentokrÃ¡t obsahuje vÃ½pis informacÃ­ pro primitivnÃ­ benchmark. VÅ¡imnÄ›te si&nbsp;<code>for</code>u, kterÃ½ iteruje skrz&nbsp;<code>10000000</code>&nbsp;poloÅ¾ek. PouÅ¾il jsem ho zÃ¡mÄ›rnÄ› mÃ­sto&nbsp;<code>time.sleep()</code>. ProÄ se dozvÃ­te za okamÅ¾ik.</p>
      <p id="aee61270-f2d2-4f0a-b236-8a5bd30aaf99" class="">while&nbsp;cyklus na konci scriptu obstarÃ¡vÃ¡ veÅ¡kerou prÃ¡ci - z fronty vyjme jeden&nbsp;tasklet, nechÃ¡ ho probÄ›hnout&nbsp;100&nbsp;python instrukcÃ­ a pokud mezi tÃ­m neskonÄil, tak ho vloÅ¾Ã­ na konec fronty.</p>
      <p id="6d435bc9-99fe-46bc-8348-5b4989e607ce" class="">Z vÃ½Å¡e uvedenÃ©ho odstavce plynou dvÄ› vÄ›ci:</p>
      <ol type="1" id="bd6e5e8e-d399-4c7a-9447-2c56c501cc94" class="numbered-list" start="1">
        <li>JednÃ¡ se o&nbsp;<a href="http://cs.wikipedia.org/wiki/Multitasking#Preemptivn.C3.AD_multitasking"><strong>preemptivnÃ­</strong></a>&nbsp;multitasking.
        </li>
      </ol>
      <ol type="1" id="ae60d5a1-c8a2-4ae1-9977-45ee4e869c9f" class="numbered-list" start="2">
        <li>Multitasking se vztahuje na instrukce pythonnÃ­ho bytecode,&nbsp;<strong>ne na volÃ¡nÃ­ C API</strong>.</li>
      </ol>
      <p id="5e2613ad-6fd8-4132-98ce-6db2fd96fff0" class="">NynÃ­ doufÃ¡m chÃ¡pete,&nbsp;<a href="http://www.stackless.com/wiki/Idioms#sleeping">proÄ</a>&nbsp;jsem pouÅ¾il mÃ­sto&nbsp;<code>time.sleep()</code>&nbsp;for&nbsp;smyÄku -&nbsp;<code>time.sleep()</code>&nbsp;je&nbsp;<a href="http://hg.python.org/cpython/file/2d802765d31f/Modules/timemodule.c#l53">callback</a>&nbsp;na C API, coÅ¾ znamenÃ¡, Å¾e se na nÄ›j multitasking nevztahuje. To je dobrÃ© mÃ­t na pamÄ›ti.</p>
      <p id="4ce1abc7-ca2d-4461-b92b-1c6c4d4b596f" class="">ZatÃ­mco&nbsp;<a href="http://cs.wikipedia.org/wiki/Multitasking#Kooperativn.C3.AD_.28nepreemptivn.C3.AD.29_multitasking">kooperativnÃ­ho</a>&nbsp;multitaskingu lze do jistÃ© mÃ­ry dosÃ¡hnout i v obyÄejnÃ©m pythonu pomocÃ­ generÃ¡torÅ¯, preemptivnÃ­ je moÅ¾nÃ© dosÃ¡hnout pouze pomocÃ­ procesÅ¯, threadÅ¯, Äi Stackless pythonem, jehoÅ¾ tasklety jsou nejmÃ©nÄ› nÃ¡roÄnÃ© na prostÅ™edky poÄÃ­taÄe.</p>
      <h3 id="b6dbba75-56ab-4fe6-be6b-62a9eea4b988" class="">VÃ½stup</h3>
      <pre id="226a909c-8972-4580-afc6-eeefd5f0aacc" class="code"><code>$ time stackless stackless.py 
starting prvni 1382985236.72
starting druhy 1382985237.26
starting treti 1382985237.8
ending druhy 1382985243.4 - 6.14155387878
ending prvni 1382985243.67 - 6.95054602623
ending treti 1382985243.92 - 6.12157416344
 
real    0m8.101s
user    0m6.888s
sys 0m1.136s</code></pre>
      <p id="60f831c7-240b-462e-ac22-5ff5446b940e" class="">Pokud nechÃ¡m funkci probÄ›hnout tÅ™ikrÃ¡t lineÃ¡rnÄ› za sebou, dostanu tyto hodnoty:</p>
      <pre id="52484351-0b02-4531-af9b-e29b056f50db" class="code"><code>$ time stackless stackless.py 
starting prvnÃ­ 1382985343.08
ending prvnÃ­ 1382985345.28 - 2.19586610794
starting druhÃ¡ 1382985345.28
ending druhÃ¡ 1382985346.91 - 1.63068413734
starting tÅ™etÃ­ 1382985346.91
ending tÅ™etÃ­ 1382985348.51 - 1.59492611885
 
real    0m5.804s
user    0m5.036s
sys 0m0.568s</code></pre>
      <p id="e6d540d5-b79c-4e0c-898c-e1e62d78a6ae" class="">ParalelnÃ­ bÄ›h tedy trval o 2.3s dÃ©le, neÅ¾ bÄ›h lineÃ¡rnÃ­. To je daÅˆ za pÅ™epÃ­nÃ¡nÃ­&nbsp;taskletÅ¯&nbsp;a hlavnÄ› za jejich spuÅ¡tÄ›nÃ­ a ukonÄenÃ­, coÅ¾ je dle vÃ½pisu pomÄ›rnÄ› ÄasovÄ› nÃ¡roÄnÃ¡ Äinnost trvajÃ­cÃ­ desÃ­tky/stovky milisekund.</p>
      <h2 id="57bb31d8-5b1b-47eb-837b-e7c37c3588ef" class="">RozdÃ­l mezi kooperativnÃ­m a preemptivnÃ­m multitaskingem</h2>
      <p id="d2de57a6-b69d-49c0-b700-ce77e875c54d" class="">MladÅ¡Ã­ roÄnÃ­ky, kterÃ© si nepamatujÃ­ doby DOSu a prvnÃ­ch Windows moÅ¾nÃ¡ nebudou tuÅ¡it, jakÃ½ je rozdÃ­l mezi kooperativnÃ­m a preemptivnÃ­m multitaskingem.</p>
      <p id="9bb4ce49-efc2-49a3-a13f-49c9b770bf15" class="">KooperativnÃ­ multitasking je triviÃ¡lnÄ›jÅ¡Ã­. SpoÄÃ­vÃ¡ v tom, Å¾e funkci (Äi procesu/programu) pÅ™edÃ¡te Å™Ã­zenÃ­ a doufÃ¡te, Å¾e vÃ¡m ho nÄ›kdy vrÃ¡tÃ­, aby jste mohli provÃ©st zase nÄ›co jinÃ©ho. Po dobu bÄ›hu funkce nemÃ¡te nad systÃ©mem Å¾Ã¡dnou kontrolu a musÃ­te doufat, Å¾e se funkce nedostane do stavu, kde se zasekne a celÃ½ systÃ©m zamrzne.</p>
      <p id="579b392e-40cc-4742-b512-756274844fe0" class="">V kooperativnÃ­m multitaskingu mÅ¯Å¾e bÄ›Å¾et vÃ­c procesÅ¯ zÃ¡roveÅˆ, ale je na procesech, aby bÄ›Å¾ely jen zlomky Äasu, po kterÃ©m vÅ¾dy vrÃ¡tÃ­ Å™Ã­zenÃ­ systÃ©mu, kterÃ½ mezi nimi pÅ™epne. Pokud se nÃ¡hodou nÄ›jakÃ½ proces zdrÅ¾Ã­, tak vÅ¡echny bÄ›Å¾Ã­cÃ­ procesy na chvÃ­li zmrznou.</p>
      <p id="00baf8f2-6fdf-45c9-ab68-27bb660a89e9" class="">PreemptivnÃ­ multitasking je chytÅ™ejÅ¡Ã­, i kdyÅ¾ nÃ¡roÄnÄ›jÅ¡Ã­ na implementaci a na bÄ›h. MÃ­sto toho, aby procesu pÅ™edal kompletnÃ­ Å™Ã­zenÃ­ mu pÅ™edÃ¡vÃ¡ Å™Ã­zenÃ­ jen na nÄ›jakÃ½ okamÅ¾ik. MÅ¯Å¾e to bÃ½t tÅ™eba na 1ms, nebo na 1000 instrukcÃ­, to uÅ¾ zÃ¡leÅ¾Ã­ na konkrÃ©tnÃ­ implementaci. VÃ½hoda je v tom, Å¾e pokud se danÃ½ proces/fukce/program zasekne, tak neshodÃ­ celÃ½ systÃ©m a ostatnÃ­ funkce/procesy/.. dÃ¡le bÄ›Å¾Ã­.</p>
      <h3 id="9429939a-1752-4e6e-92b9-e75aa34a46dc" class="">KooperativnÃ­ multitasking v pythonu</h3>
      <p id="7bd81a84-560b-41bf-9850-f90d062b224a" class="">Pokud by nÄ›koho zajÃ­malo, jak by vypadala vÃ½Å¡e uvedenÃ¡ ukÃ¡zka pÅ™epsanÃ¡ do ÄistÃ©ho pythonu v kooperativnÃ­m reÅ¾imu pomocÃ­ generÃ¡torÅ¯:</p>
      <pre id="f9d6e007-0644-4930-a818-3e511da5ebd2" class="code"><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-
import time
 
def funkce(parametr):
    t1 = time.time()
    print "starting", parametr, t1
     
    for i in range(10000000):
        if i % 100 == 0:
            yield
 
    t2 = time.time()
    print "ending", parametr, t2, "-", t2 - t1
 
 
fronta = [
    funkce("prvni"),
    funkce("druhy"),
    funkce("treti"),
]
 
while len(fronta) &gt; 0:
    for f in fronta:
        try:
            f.next()
        except StopIteration:
            fronta.remove(f)</code></pre>
      <p id="34df528d-83b5-44a1-a1ee-a1359791f03c" class="">a zde je vÃ½stup:</p>
      <pre id="398430c5-4434-4b02-86da-95b2a3a7a4eb" class="code"><code>$ time ./yield.py 
starting prvni 1382984400.16
starting druhy 1382984400.6
starting treti 1382984401.04
ending prvni 1382984412.9 - 12.7446539402
ending treti 1382984413.17 - 12.1312551498
ending druhy 1382984413.44 - 12.8393118382
 
real    0m14.347s
user    0m12.757s
sys 0m1.112s</code></pre>
      <p id="a25b08cc-da18-4d4a-b455-1d58125c2e38" class="">Pokud dojde ve&nbsp;<code>for</code>smyÄce, kde je vyhazovÃ¡n&nbsp;<code>yield</code>&nbsp;k chybÄ› (tÅ™eba nÄ›jakÃ½ cyklus, nebo Å¡patnÄ› vyhodnocenÃ¡ podmÃ­nka), celÃ½ kÃ³d se zasekne a nepobÄ›Å¾Ã­ ani jeden ze tÅ™Ã­ generÃ¡torÅ¯.</p>
      <p id="b8bced41-3064-431a-b379-89baa37d2bfe" class="">ZajÃ­mavÃ© je, Å¾e kÃ³d bÄ›Å¾el delÅ¡Ã­ dobu, neÅ¾ v pÅ™Ã­padÄ› Stackless&nbsp;<em>taskletÅ¯</em>. PovÅ¡imnÄ›te si poÅ™adÃ­ ukonÄenÃ­ jednotlivÃ½ch generÃ¡torÅ¯.</p>
      <p id="6730791b-6b2a-48f2-87ab-14801b66ccc8" class="">Pro Ãºplnost dodÃ¡m, Å¾e Stackless takÃ© umoÅ¾Åˆuje kooperativnÃ­ multitasking, jen mÃ­sto&nbsp;yield&nbsp;volÃ¡te&nbsp;<code>stackless.schedule()</code>. JelikoÅ¾ python nabÃ­zÃ­ dost podobnou funkcionalitu v zÃ¡kladu, nebudu se tÃ­m dÃ¡le zabÃ½vat.</p>
      <h1 id="4f86f4a3-08fd-4c00-bc08-78ecbf15a292" class="">Komunikace</h1>
      <p id="a490623b-d5eb-492e-9c08-1959e652707e" class="">JednotlivÃ©&nbsp;tasklety&nbsp;spolu mohou komunikovat pomocÃ­&nbsp;<em>kanÃ¡lÅ¯</em>, coÅ¾ je vlastnost, kterou ÄistÃ© pythonnÃ­ generÃ¡tory aÅ¾ do nedÃ¡vna nemÄ›ly a i v dneÅ¡nÃ­ dobÄ› to nenÃ­ tak pÅ™Ã­moÄarÃ©.</p>
      <p id="b4309427-9bd4-4e43-996b-0fef682cadec" class="">KanÃ¡l&nbsp;je moÅ¾nÃ© vytvoÅ™it pomocÃ­ volÃ¡nÃ­&nbsp;<code>stackless.channel()</code>. Data se odesÃ­lajÃ­ pÅ™es volÃ¡nÃ­&nbsp;<code>ch.send()</code>&nbsp;a pÅ™ijÃ­majÃ­ pÅ™es&nbsp;<code>ch.receive()</code>. Dotaz na poÄet zprÃ¡v v kanÃ¡lu je moÅ¾nÃ© provÃ©st skrz property&nbsp;<code>ch.balance</code>&nbsp;(default <code>0</code>).</p>
      <p id="deeed497-fc0f-4b76-89a0-e2adfdbc57be" class=""><strong>Jak pÅ™Ã­jem, tak odesÃ­lÃ¡nÃ­ dat je blokujÃ­cÃ­ a zasekne celÃ½&nbsp;</strong><strong>tasklet</strong><strong>.</strong>&nbsp;NemÃ¡ cenu to zkouÅ¡et v singleplayeru, pokud nemÃ¡te kÃ³d, kterÃ½ bÄ›Å¾Ã­ paralelnÄ› tak se to prostÄ› zasekne a nic se nedÄ›je.</p>
      <p id="b270b323-de02-4f7d-9c99-74a4a481459c" class="">Zde je ukÃ¡zka posÃ­lÃ¡nÃ­ dat mezi dvÄ›ma funkcemi:</p>
      <pre id="5996c16d-1826-4cea-b353-27cf28017d9f" class="code"><code>#!/usr/bin/env stackless
# -*- coding: utf-8 -*-
import time
import stackless
 
def prvni(ch):
    ch.send("odeslÃ¡no z prvnÃ­")
 
def druha(ch):
    print "druhÃ¡:", ch.receive()
 
 
ch = stackless.channel()
 
stackless.tasklet(prvni)(ch)
stackless.tasklet(druha)(ch)
 
 
while stackless.getruncount() &gt; 1:
    t = stackless.run(100)
 
    if t:
        t.insert()</code></pre>
      <p id="249e5cc0-7b71-426f-b599-5b5c355de501" class="">Odeslat je moÅ¾nÃ© vÅ¡echno moÅ¾nÃ©, nemusÃ­ to bÃ½t string, ale klidnÄ› pole, ÄÃ­slo atp..</p>
      <h3 id="68a0eb3b-7622-4df4-a459-ab8166033cba" class="">VÃ½stup</h3>
      <pre id="9b08262a-1235-43cf-8864-38a9a3d312d5" class="code"><code>$ ./stackless.py 
druhÃ¡: odeslÃ¡no z prvnÃ­</code></pre>
      <h1 id="adf6dce8-9b46-425e-a80a-5bd437ecf386" class="">To je vÅ¡e?</h1>
      <p id="b250b15f-6a4d-456f-a6bb-b636070dbabb" class="">TÃ©mÄ›Å™ vÅ¡e. Dokumentace se jeÅ¡tÄ› zmiÅˆuje o serializaci&nbsp;taskletÅ¯/kanÃ¡lÅ¯, ale protoÅ¾e jsem to zatÃ­m nemÄ›l potÅ™ebu pouÅ¾Ã­t, tak jÃ­ zde nebudu rozmazÃ¡vat - tenhle ÄlÃ¡nek se brutÃ¡lnÄ› zvrhl z osobnÃ­ch poznÃ¡mek k instalaci, protoÅ¾e jsem zapomnÄ›l pÅ™estat psÃ¡t. Berte ho tedy spÃ­Å¡ jako takovÃ© pÅ™edstavenÃ­ Stackless v ÄeÅ¡tinÄ›, ne kompletnÃ­ manuÃ¡l.</p>
      <p id="a64835fa-231c-4956-8a3c-fae0833fa188" class="">Pokud vÃ¡s Stackless zaujal, vÅ™ele doporuÄuji navÅ¡tÃ­vit jeho&nbsp;<a href="http://www.stackless.com/">domovskou strÃ¡nku</a>&nbsp;a pÅ™eÄÃ­st si dokumentaci - jednÃ¡ se jen o pÃ¡r strÃ¡nek.</p>
      <p id="18a80197-224a-4e1b-966a-22eb51aa7bc3" class="">Pokud by mÄ›l nÄ›kdo potÅ™ebu vÄ›tÅ¡Ã­ho tutoriÃ¡lu, tak jeden drobnÄ› zastaralÃ½ (python 2.4) se dÃ¡ najÃ­t zde:&nbsp;<a href="http://www.grant-olson.net/files/why_stackless.html">Introduction to Concurrent Programming with Stackless Python</a>.</p>
      <h2 id="0d7796f8-c364-46a0-a63a-adc96425fe77" class="">Kde Stackless pouÅ¾Ã­vÃ¡m</h2>
      <p id="43521755-d8e0-4d3c-92be-189a12ef6459" class="">Stackless u mÄ› naÅ¡el vyuÅ¾itÃ­ v paralelnÃ­m sÃ­Å¥ovÃ©m kÃ³du, kterÃ½ prochÃ¡zÃ­ webem. JednotlivÃ© navÃ¡zÃ¡nÃ­ spojenÃ­ je totiÅ¾ ÄasovÄ› nÃ¡roÄnÄ›jÅ¡Ã­ operace, neÅ¾ samotnÃ© stahovÃ¡nÃ­. Takhle se neustÃ¡le naÄÃ­tajÃ­ novÃ© a novÃ©&nbsp;tasklety&nbsp;s poÅ¾adavky na webovÃ© strÃ¡nky, takÅ¾e program poÅ™Ã¡d nÄ›co dÄ›lÃ¡, mÃ­sto aby vÅ¾dy Äekal 2 vteÅ™iny na navÃ¡zÃ¡nÃ­ spojenÃ­.</p>
      <p id="763ceb0a-2d92-44a5-b063-1802f587f742" class=""></p>
    </div>
  </article>
  <div class="corner-ribbon top-right red">
    <a href="https://www.patreon.com/bePatron?u=2618881">Become a Patron</a>
  </div><a class="twitter-share-button" id="twitter_button" href="#"><img src="../../tweet_button.svg"></a>
  <div id="sidebar_bottom">
    <span><a href="https://blog.rfox.eu/atom_cz.xml"><img style="width: 3em;" src="../../rss_icon.png"></a> &nbsp; &nbsp; <a href="https://twitter.com/Bystroushaak"><img style="width: 3em;" src="../../twitter_icon.png"></a></span>
    <div id="last_five_bottom">
      <h3>New posts</h3>
      <ul>
        <li>
          <a href="../Povidky/Software.html" title="Software">Software</a>
        </li>
        <li>
          <a href="../Ostatni/Paromobilita_je_budoucnost.html" title="Paromobilita je budoucnost">Paromobilita je budoucnost</a>
        </li>
        <li>
          <a href="../Ostatni/Algoritmus_hledani_programatorske_prace_2021-4.html" title="Algoritmus hledÃ¡nÃ­ programÃ¡torskÃ© prÃ¡ce 2021/4">Algoritmus hledÃ¡nÃ­ programÃ¡torskÃ© prÃ¡ce 2021/4</a>
        </li>
        <li>
          <a href="../3D_tisk/Nastaveni_Blenderu_pro_3D_tisk.html" title="NastavenÃ­ Blenderu pro 3D tisk">NastavenÃ­ Blenderu pro 3D tisk</a>
        </li>
        <li>
          <a href="../3D_modelovani/Geometricky_stred_Prahy.html" title="GeometrickÃ½ stÅ™ed Prahy">GeometrickÃ½ stÅ™ed Prahy</a>
        </li>
        <li>
          <a href="../../Utrzky/Posta_poezie.html" title="PoÅ¡ta (poezie)"><span class="icon">ğŸ—’ï¸</span>PoÅ¡ta (poezie)</a>
        </li>
        <li>
          <a href="../Ostatni/Statni_zklamani.html" title="StÃ¡tnÃ­ zklamÃ¡nÃ­">StÃ¡tnÃ­ zklamÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_TODO_list_1_Drzak_na_sluchatka.html" title="3D TODO list 1; DrÅ¾Ã¡k na sluchÃ¡tka">3D TODO list 1; DrÅ¾Ã¡k na sluchÃ¡tka</a>
        </li>
        <li>
          <a href="../Ostatni/Dva_podvodnici.html" title="Dva podvodnÃ­ci">Dva podvodnÃ­ci</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_tiskarna_Prusa_MK3S_sestaveni_a_prvni_tisk.html" title="3D tiskÃ¡rna PrÅ¯Å¡a MK3S+; sestavenÃ­ a prvnÃ­ tisk">3D tiskÃ¡rna PrÅ¯Å¡a MK3S+; sestavenÃ­ a prvnÃ­ tisk</a>
        </li>
      </ul>& <a href="../../Zmeny.html" title="ZmÄ›ny">more</a>
    </div>
    <div>
      <h3>Tagy</h3>
      <p><a href="../../Tagy/python.html" title="python">python</a>, <a href="../../Tagy/stackless.html" title="stackless">stackless</a></p>
    </div>
    <div>
      <h3>Blog categories</h3>
      <ul class="no_icon">
        <li>
          <a href="../3D_modelovani.html" title="3D modelovÃ¡nÃ­">ğŸ“‚ 3D modelovÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../3D_tisk.html" title="3D tisk">ğŸ“‚ 3D tisk</a>
        </li>
        <li>
          <a href="../Abclinuxu.html" title="Abclinuxu">ğŸ“‚ Abclinuxu</a>
        </li>
        <li>
          <a href="../Crypto.html" title="Crypto">ğŸ“‚ Crypto</a>
        </li>
        <li>
          <a href="../Hardware.html" title="Hardware">ğŸ“‚ Hardware</a>
        </li>
        <li>
          <a href="../Hrbitov.html" title="HÅ™bitov">ğŸ“‚ HÅ™bitov</a>
        </li>
        <li>
          <a href="../Knihy.html" title="Knihy">ğŸ“‚ Knihy</a>
        </li>
        <li>
          <a href="../Ostatni.html" title="OstatnÃ­">ğŸ“‚ OstatnÃ­</a>
        </li>
        <li>
          <a href="../Povidky.html" title="PovÃ­dky">ğŸ“‚ PovÃ­dky</a>
        </li>
        <li>
          <a href="../Predstaveni.html" title="PÅ™edstavenÃ­">ğŸ“‚ PÅ™edstavenÃ­</a>
        </li>
        <li>
          <a href="../Programovani.html" title="ProgramovÃ¡nÃ­">ğŸ“‚ ProgramovÃ¡nÃ­</a>
        </li>
        <li>
          <a href="../index.html" title="Czech section">ğŸ“‚ Czech section</a>
        </li>
      </ul>
    </div>
  </div>
</body>
</html>

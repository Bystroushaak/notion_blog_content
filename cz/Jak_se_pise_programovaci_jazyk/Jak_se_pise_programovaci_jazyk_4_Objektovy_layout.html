<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.2.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Jak se p√≠≈°e programovac√≠ jazyk 4: Objektov√Ω layout</title>
  <link rel="stylesheet" type="text/css" href="../../style.css">
  <link rel="alternate" type="application/atom+xml" href="http://blog.rfox.eu/atom.xml">
  <link rel="shortcut icon" href="http://blog.rfox.eu/favicon.ico"><!-- Global site tag (gtag.js) - Google Analytics -->

  <script src="https://www.googletagmanager.com/gtag/js?id=UA-142545439-1">
  </script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-142545439-1');
  </script>
  <style>
  .hll { background-color: #ffffcc }
  .c { color: #408080; font-style: italic } /* Comment */
  .err { border: 1px solid #FF0000 } /* Error */
  .k { color: #008000; font-weight: bold } /* Keyword */
  .o { color: #666666 } /* Operator */
  .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
  .cm { color: #408080; font-style: italic } /* Comment.Multiline */
  .cp { color: #BC7A00 } /* Comment.Preproc */
  .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
  .c1 { color: #408080; font-style: italic } /* Comment.Single */
  .cs { color: #408080; font-style: italic } /* Comment.Special */
  .gd { color: #A00000 } /* Generic.Deleted */
  .ge { font-style: italic } /* Generic.Emph */
  .gr { color: #FF0000 } /* Generic.Error */
  .gh { color: #000080; font-weight: bold } /* Generic.Heading */
  .gi { color: #00A000 } /* Generic.Inserted */
  .go { color: #888888 } /* Generic.Output */
  .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
  .gs { font-weight: bold } /* Generic.Strong */
  .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
  .gt { color: #0044DD } /* Generic.Traceback */
  .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
  .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
  .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
  .kp { color: #008000 } /* Keyword.Pseudo */
  .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
  .kt { color: #B00040 } /* Keyword.Type */
  .m { color: #666666 } /* Literal.Number */
  .s { color: #BA2121 } /* Literal.String */
  .na { color: #7D9029 } /* Name.Attribute */
  .nb { color: #008000 } /* Name.Builtin */
  .nc { color: #0000FF; font-weight: bold } /* Name.Class */
  .no { color: #880000 } /* Name.Constant */
  .nd { color: #AA22FF } /* Name.Decorator */
  .ni { color: #999999; font-weight: bold } /* Name.Entity */
  .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
  .nf { color: #0000FF } /* Name.Function */
  .nl { color: #A0A000 } /* Name.Label */
  .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
  .nt { color: #008000; font-weight: bold } /* Name.Tag */
  .nv { color: #19177C } /* Name.Variable */
  .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
  .w { color: #bbbbbb } /* Text.Whitespace */
  .mb { color: #666666 } /* Literal.Number.Bin */
  .mf { color: #666666 } /* Literal.Number.Float */
  .mh { color: #666666 } /* Literal.Number.Hex */
  .mi { color: #666666 } /* Literal.Number.Integer */
  .mo { color: #666666 } /* Literal.Number.Oct */
  .sa { color: #BA2121 } /* Literal.String.Affix */
  .sb { color: #BA2121 } /* Literal.String.Backtick */
  .sc { color: #BA2121 } /* Literal.String.Char */
  .dl { color: #BA2121 } /* Literal.String.Delimiter */
  .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
  .s2 { color: #BA2121 } /* Literal.String.Double */
  .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
  .sh { color: #BA2121 } /* Literal.String.Heredoc */
  .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
  .sx { color: #008000 } /* Literal.String.Other */
  .sr { color: #BB6688 } /* Literal.String.Regex */
  .s1 { color: #BA2121 } /* Literal.String.Single */
  .ss { color: #19177C } /* Literal.String.Symbol */
  .bp { color: #008000 } /* Name.Builtin.Pseudo */
  .fm { color: #0000FF } /* Name.Function.Magic */
  .vc { color: #19177C } /* Name.Variable.Class */
  .vg { color: #19177C } /* Name.Variable.Global */
  .vi { color: #19177C } /* Name.Variable.Instance */
  .vm { color: #19177C } /* Name.Variable.Magic */
  .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Bystroushaak">
  <meta name="twitter:creator" content="@Bystroushaak">
  <meta name="twitter:title" content="Jak se p√≠≈°e programovac√≠ jazyk 4: Objektov√Ω layout">
  <meta name="twitter:description" content="Dal≈°√≠m logick√Ωm krokem by mƒõlo b√Ωt vytvo≈ôen√≠ virtu√°ln√≠ho stroje, kter√Ω bude programovac√≠ jazyk interpretovat, a kompil√°toru, kter√Ω pro tento virtu√°ln√≠ stroj zkompiluje zdrojov√Ω k√≥d. P≈ôed t√≠m, ne≈æ se do toho m≈Ø≈æu pustit je v≈°ak t≈ôeba ujasnit si, nejl√©pe formou konkr√©tn√≠ implementace, jak bude vypadat reprezentace a rozlo≈æen√≠ objekt≈Ø v pamƒõti.">
  <meta name="twitter:image" content="http://blog.rfox.eu/cz/Jak_se_pise_programovaci_jazyk/Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_0.png">
  <script src="../../scripts.js">
  </script>
</head>
<body onload="on_body_load();">
  <div id="sidebar_top">
    <div id="last_five_top">
      <h3>New posts:</h3>
      <ul>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment/Pebble_smartwatches.html">Pebble smartwatches</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment.html"><span class="icon">üìÇ</span>The Most Personal Device experiment</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/Unicode_font_subset.html">Unicode font subset</a>
        </li>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-05-25_Work_in_progress_everywhere.html">Lifelog 2020-05-25; Work in progress everywhere</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/Improvements/Vitamins_nootropics_and_other_boosters.html">Vitamins, nootropics and other boosters</a>
        </li>
      </ul>& <a href="../../Changelog.html">more</a>
    </div>
  </div><a class="breadcrumb" href="../../index.html">Bystroushaak's blog</a> / <a class="breadcrumb" href="../index.html">Czech section</a> / <a class="breadcrumb" href="index.html">Jak se p√≠≈°e programovac√≠ jazyk</a> / Jak se p√≠≈°e programovac√≠ jazyk 4: Objektov√Ω layout
  <article id="6f84fd21-f69e-4275-9575-d0c20719bc2c" class="page sans">
    <header>
      <h1 class="page-title">Jak se p√≠≈°e programovac√≠ jazyk 4: Objektov√Ω layout</h1>
    </header>
    <div class="page-body">
      <p id="ff814f60-f037-4789-9846-3bb68ae5d7ce" class=""><time>@2019/03/13</time></p>
      <p id="3c97b191-83e4-49fb-a500-e28593b736d7" class="">Dal≈°√≠m logick√Ωm krokem by mƒõlo b√Ωt vytvo≈ôen√≠ virtu√°ln√≠ho stroje, kter√Ω bude programovac√≠ jazyk interpretovat, a kompil√°toru, kter√Ω pro tento virtu√°ln√≠ stroj zkompiluje zdrojov√Ω k√≥d. P≈ôed t√≠m, ne≈æ se do toho m≈Ø≈æu pustit je v≈°ak t≈ôeba ujasnit si, nejl√©pe formou konkr√©tn√≠ implementace, jak bude vypadat reprezentace a rozlo≈æen√≠ objekt≈Ø v pamƒõti.</p>
      <p id="69dedfef-c946-4724-9bb3-516e368f5a20" class="">Specificky n√°sleduj√≠c√≠ vƒõci;</p>
      <ol id="9155f3b2-42f6-4559-8cbc-f2f93fa5d27d" class="numbered-list" start="1">
        <li>Jak budou objekty reprezentov√°ny.</li>
      </ol>
      <ol id="b97f8cf4-920f-4249-a8a8-cb47438729ef" class="numbered-list" start="2">
        <li>Kde a jak budou um√≠stƒõny.</li>
      </ol>
      <ol id="3e16d8b4-2faa-4729-abfb-9427d888d47e" class="numbered-list" start="3">
        <li>Jak se s t√≠m v≈°√≠m bude pracovat.</li>
      </ol>
      <h2 id="4b4efd67-d705-4425-a5bb-519ad6ae7738" class="">Selfov√© objekty</h2>
      <p id="ec0483e5-557d-4c16-9ab9-f2a2c1a5d30e" class="">P≈ôesto≈æe tento seri√°l je urƒçen p≈ôedev≈°√≠m pro pokroƒçil√© ƒçten√°≈ôe, od kter√Ωch oƒçek√°v√°m alespo≈à z√°kladn√≠ obezn√°men√≠ se Selfem, pro jistotu zde rekapituluji na prototypech zalo≈æen√Ω objektov√Ω model Selfu.</p>
      <p id="1fa9ce87-436a-4db9-b7bd-21c580e5fd6c" class="">Objekty v Selfu se chovaj√≠ jako asociativn√≠ pole, kter√© na <em>konkr√©tn√≠m jm√©nu</em> uchov√°vaj√≠ buƒèto hodnotu, nebo odkaz na jin√© objekty. P√°r <em>jm√©no : hodnota</em> je naz√Ωv√°n slotem. Objekt je kolekc√≠ takov√Ωchto slot≈Ø.</p>
      <pre id="add733ae-d6d7-4ef8-bca4-530e966daaa7" class="code"><code>(| slot = 1. another = 2 |)</code></pre>
      <p id="db60b715-6fc2-4f5d-bd65-82dc99ee5367" class="">Tento objekt na jist√© √∫rovni abstrakce odpov√≠d√° slovn√≠ku <code>{"slot": 1, "another": 2}</code>.</p>
      <p id="3e914551-dd37-48c1-b37b-fd153d3d82fd" class="">Kl√≠ƒçe v asociativn√≠m poli jsou p≈ôelo≈æeny na konkr√©tn√≠ v√Ωsledek aktem <em>posl√°n√≠ zpr√°vy objektu</em>. Zpr√°vy m≈Ø≈æou b√Ωt un√°rn√≠ (jednoduch√Ω string bez mezer), bin√°rn√≠ (oper√°tory jako +-*/ a tak podobnƒõ), ƒçi <em>keyword</em> (slo≈æen√© z jednoho, ƒçi v√≠ce kl√≠ƒçov√Ωch slov n√°sledovan√Ωch dvojteƒçkou).</p>
      <pre id="c7112f8d-5842-429a-99b4-ba53d08a4ea3" class="code"><code>obj unaryMessage.
obj + anotherObj.
obj keyword: anotherObj Message: evenMoreObjs.</code></pre>
      <p id="50565fb8-f379-4d9e-bae0-150abd4c706f" class="">Analogie k pythonu by byla:</p>
      <pre id="b7f4e113-bbea-4c19-9aae-ecf44967316d" class="code"><code>obj.unaryMessage()
obj.+(anotherObj)
obj.keyword:Message:(anotherObj, evenMoreObjs)</code></pre>
      <p id="3237f48e-feee-4440-96d4-216564a85f90" class="">Rozd√≠ly oproti klasick√©mu asociativn√≠mu poli jsou n√°sleduj√≠c√≠:</p>
      <ul id="908de3d7-f12b-4384-a532-86827b550770" class="bulleted-list">
        <li>Pokud je v√Ωsledkem p≈ôelo≈æen√≠ zpr√°vy na slot objekt <em>obsahuj√≠c√≠ k√≥d</em>, je spu≈°tƒõn v kontextu volan√©ho objektu a jsou mu p≈ôed√°ny pat≈ôiƒçn√© parametry.</li>
      </ul>
      <ul id="3ab23c08-d31a-4a67-837a-f1888fedd8cb" class="bulleted-list">
        <li>Pokud nen√≠ slot v objektu nalezen, objekt m√° mo≈ænost na to reagovat.</li>
      </ul>
      <ul id="bfe9c50b-9436-44ba-8389-b7709930ed1e" class="bulleted-list">
        <li>Pokud objekt definuje rodiƒçovsk√Ω slot, je hled√°n√≠ slotu p≈ôi ne√∫spƒõchu p≈ôeneseno do nƒõj. T√≠m je ≈ôe≈°ena delegace ve stylu dƒõdiƒçnosti.</li>
      </ul>
      <p id="fe2a8bb2-8dcb-4283-8e49-f293a13c679d" class="">Objekt je mo≈æn√© internƒõ reprezentovat t≈ô√≠dou zhruba a velmi abstraktnƒõ n√°sleduj√≠c√≠ho typu:</p>
      <pre class="code"><code><span class="k">class</span> <span class="nc">Object</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scope_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primitive_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre>
      <p id="176507ec-31da-40ac-9db7-029b061d5c36" class="">Tedy <code>Objekt</code> m≈Ø≈æe obsahovat sloty jako hashmapu, seznam p≈ôij√≠man√Ωch parametr≈Ø jako pole, slovn√≠k odkaz≈Ø na rodiƒçe a k√≥d, co≈æ je zase jin√Ω objekt, nƒõco jako pole zpr√°v, kter√© se postupnƒõ zas√≠laj√≠.</p>
      <p id="00fd8bd5-e66a-4d14-b5a5-ffe0231bc73d" class="">Od zaƒç√°tku jsem chtƒõl, aby sloty byly ulo≈æeny se zachov√°n√≠m po≈ôad√≠ v <code>OrderedDictu</code>, m√≠sto v klasick√© hashmapƒõ. To nen√≠ tak moc podstatn√©, pro samotn√Ω programovac√≠ jazyk, jako pro jeho vyu≈æit√≠ k ukl√°d√°n√≠ strukturovan√Ωch informac√≠. D√≠ky tomu je mo≈æn√© do stromov√© struktury nap≈ô√≠klad 1:1 konvertovat XML s pomƒõrnƒõ mal√Ωm <em>overheadem</em>.</p>
      <h2 id="a31d5c15-6c70-4d0f-b50b-06fcb0a2f1bf" class="">Reprezentace objekt≈Ø</h2>
      <p id="1f44eda6-641d-48de-bbb1-539867442b28" class="">V na t≈ô√≠d√°ch zalo≈æen√Ωch jazyc√≠ch jsou objekty reprezentov√°ny p≈ôibli≈ænƒõ nƒõjak jako pointer na t≈ô√≠du n√°sledovan√Ω polem s datov√Ωmi sloty udr≈æuj√≠c√≠mi ƒçlensk√© promƒõnn√©. Ve t≈ô√≠dƒõ samotn√© je ulo≈æen popis toho, co se dƒõl√° s datov√Ωmi sloty. T√≠m je ≈°et≈ôena pamƒõ≈•, nebo≈• samotn√° funkcionalita objektu je v n√≠ ulo≈æena jen jednou pro v≈°echny instance.</p>
      <p id="11af0d6d-70f3-4a21-bdb8-df92e5f78096" class="">Self je na prototypech zalo≈æen√Ω jazyk, kde nic jako t≈ô√≠dy nen√≠. Objekty nejsou <em>instancov√°ny</em>, ale <em>klonov√°ny</em> z jin√Ωch objekt≈Ø. P≈ôesto, ƒçi respektive pr√°vƒõ proto, je mo≈æn√© pou≈æ√≠t stejn√Ω trik, jako u jazyk≈Ø s t≈ô√≠dami. P≈ôi klonov√°n√≠ je v pamƒõti vytvo≈ôena takzvan√° <em>mapa</em> a u≈æivateli je vr√°cen objekt, kter√Ω je podobnƒõ jako v p≈ôedchoz√≠m p≈ô√≠padƒõ pouze polem s hodnotami a pointerem na <em>mapu</em>. Pokud u≈æivatel klon struktur√°lnƒõ modifikuje (p≈ôid√° / ubere / p≈ôejmenuje sloty), je pro nƒõj vytvo≈ôena samostatn√° mapa, do t√© doby jsou v≈°ak mapy sd√≠leny.</p>
      <p id="b6f79370-efd7-45b9-a5f1-2a36dce8633d" class="">Rozlo≈æen√≠ v pamƒõti se tedy mƒõn√≠ n√°sledovnƒõ:</p>
      <pre class="code"><code><span class="k">class</span> <span class="nc">Object</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="nb">map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slot_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_slot_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span>
        <span class="n">o</span><span class="o">.</span><span class="n">scope_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_parent</span>
        <span class="n">o</span><span class="o">.</span><span class="n">_slot_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slot_values</span><span class="p">[:]</span>
        <span class="n">o</span><span class="o">.</span><span class="n">_parent_slot_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_slot_values</span><span class="p">[:]</span>

        <span class="k">return</span> <span class="n">o</span>


<span class="k">class</span> <span class="nc">Map</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slots</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_slotss</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">primitive_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre>
      <p id="21741387-2229-43ca-891e-98ed9e53116f" class="">V jak√©msi pseudoUML to vypad√° takto:</p>
      <figure id="88334089-2309-4ad4-a5fc-5014522c6dce" class="image">
        <a href="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_0.png"><img style="width:178px" src="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_0.png"></a>
      </figure>
      <p id="c1e71aef-4661-44fe-abee-2ee157656e6c" class="">Pokud dojde ke klonov√°n√≠ objektu, je vytvo≈ôen nov√Ω objekt obsahuj√≠c√≠ pole s odkazy na hodnoty. V≈°echny ostatn√≠ informace, jako rodiƒçovsk√© sloty, seznam parametr≈Ø a k√≥d objektu jsou pro v≈°echny klony ulo≈æen√© v jedn√© mapƒõ, na kterou si p≈ôed√°vaj√≠ reference. D√≠ky tomu je mo≈æn√© signifikantn√≠m zp≈Øsobem ≈°et≈ôit pamƒõ≈•.</p>
      <figure id="acdd3d53-0803-4da6-a4d8-1dca2f7c4925" class="image">
        <a href="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_1.png"><img style="width:419px" src="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_1.png"></a>
      </figure>
      <p id="df090a8a-2d00-4d66-afe1-55bb871bdb6a" class="">To plat√≠, i kdy≈æ se zmƒõn√≠ hodnota konkr√©tn√≠ho slotu:</p>
      <figure id="e4db1c86-c57b-49d4-b149-5755b676d684" class="image">
        <a href="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_2.png"><img style="width:394px" src="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_2.png"></a>
      </figure>
      <p id="62a8fedc-8c30-4c6f-9cdb-570e26b7ec82" class="">Cel√° implementace se ov≈°em kapku zeslo≈æi≈•uje v p≈ô√≠padƒõ kdy se zmƒõn√≠ struktura, nebo≈• je pot≈ôeba pat≈ôiƒçnƒõ o≈°et≈ôit v≈°echny manipulace objektu tak, aby do≈°lo k vytvo≈ôen√≠ nov√© mapy.</p>
      <figure id="599fe379-e581-48a1-ae32-a2b6baf81822" class="image">
        <a href="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_3.png"><img style="width:417px" src="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/map_3.png"></a>
      </figure>
      <p id="1e7521bd-f5cc-469e-a940-76b0e6b5070d" class="">To jsem osobnƒõ vy≈ôe≈°il spoustou <code>meta_</code> metod. Nap≈ô√≠klad <code>.meta_add_slot()</code>, kter√° do klonu p≈ôid√° nov√Ω slot, p≈ôed t√≠m v≈°ak vytvo≈ô√≠ <em>klon mapy</em>, tak≈æe tento nov√Ω objekt ji≈æ pou≈æ√≠v√° vlastn√≠ mapu, kterou si m≈Ø≈æe upravovat jak chce.</p>
      <p id="3a2a399c-7f46-4faa-ba47-6fe770e63211" class="">P≈ôeklad n√°zvu slotu prob√≠h√° n√°sleduj√≠c√≠m zp≈Øsobem:</p>
      <p id="5c34a614-1d8d-4e4e-93e1-4f91174338e7" class="">Je zavol√°na metoda <code>.get_slot()</code>, kter√° se do <em>mapy</em> pod√≠v√°, jestli obsahuje index pat≈ôiƒçn√©ho slotu v <code>OrderedDictionary</code> property <code>._slots</code>. Pokud ano, vezme tento index a najde pat≈ôiƒçnou hodnotu v poli <code>._slot_values</code>. Tu potom vr√°t√≠.</p>
      <p id="8bed57e4-77ca-41d7-a68f-35c82764fd05" class="">Ulo≈æen√≠ nov√© hodnoty prob√≠h√° podobnƒõ.</p>
      <h3 id="b176c208-7dac-4574-8f70-bf6b24bac446" class="">Meta operace</h3>
      <p id="85acb3ad-4334-43fd-985f-838aede0158d" class="">Meta-operacemi naz√Ωv√°m takov√© operace, kter√© nƒõjak mƒõn√≠ strukturu objektu. Nap≈ô√≠klad p≈ôid√°n√≠ ƒçi odebr√°n√≠ nov√©ho slotu. Vzhledem k tomu ≈æe jsou sloty ulo≈æeny v <code>OrderedDict</code>u, je touto operac√≠ i prohozen√≠ pozice slotu.</p>
      <h3 id="aa82b5b2-311c-4c7b-a5b4-2ab247cb12e9" class="">Kompozice</h3>
      <p id="849d0ac1-3597-40a4-9bc2-57beb4446ce2" class="">Vzhledem k tomu, ≈æe poƒçet ≈ô√°dk≈Ø narostl z p≈Øvodn√≠ nƒõkolika≈ô√°dkov√© my≈°lenky na pƒõkn√Ωch p√°r stovek, rozhodl jsem se Objekt pro lep≈°√≠ ƒçitelnost dekomponovat do nƒõkolika t≈ô√≠d. Tato dekompozice nem√° vliv na bƒõh programu (stejnƒõ je z toho nakonec masivnƒõ <em>inlinovan√©</em> C, kter√© objekty nezn√°), je ƒçistƒõ jen pro lep≈°√≠ strukturovanost zdrojov√©ho k√≥du.</p>
      <p id="16286af8-76fe-4aed-80f2-e0b79521fcde" class="">Zde je UML v√Ωsledn√© podoby <em>objektov√©ho layoutu</em>:</p>
      <figure id="6626d9a6-07b9-489d-9d91-b7b0ad50646e" class="image">
        <a href="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/object_layout.png"><img style="width:887px" src="Jak_se_pise_programovaci_jazyk_4_Objektovy_layout/object_layout.png"></a>
      </figure>
      <p id="6674d19f-8870-4f29-9c75-bab35b56930f" class="">Zdrojov√Ω k√≥d je mo≈æn√© naj√≠t v souboru:</p>
      <ul id="6dd913c3-bca7-40eb-b8ec-d7581c8f7de7" class="bulleted-list">
        <li>
          <a href="https://github.com/Bystroushaak/tinySelf/blob/master/src/tinySelf/vm/object_layout.py">object_layout.py</a>
        </li>
      </ul>
      <p id="e51947a8-c75a-47e0-88bf-deff0def1c1c" class="">Oproti tomu co jsem zat√≠m popsal je mo≈æn√© vidƒõt je≈°tƒõ mezi-t≈ô√≠du <code>_ObjectWithMapEncapsulation</code>, co≈æ je abstrakce nad vƒõt≈°inou properties v mapƒõ, abych nep≈ôistupoval v k√≥du interpretru k intern√≠m z√°le≈æitostem <em>mapy</em> p≈ô√≠mo. Pro k√≥d je mnohem v√Ωhodnƒõj≈°√≠ a ƒçitelnƒõj≈°√≠, kdy≈æ <em>mapa</em> z≈Østane ƒç√≠msi na pozad√≠, optimalizac√≠, kter√° je pro vnƒõj≈°√≠ svƒõt neviditelnou.</p>
      <h2 id="593c6350-b2f6-4ef8-994d-bba228725465" class="">Parent lookup</h2>
      <p id="1008a195-fa66-45ba-b2a5-ee832710b5b7" class="">Jednou z naprosto kl√≠ƒçov√Ωch funkcionalit Selfu, kter√° mu dod√°v√° mnoho elegance, jen≈æ nap≈ô√≠klad postr√°d√° javascript, je delegace na rodiƒçovsk√© sloty.</p>
      <p id="6b21acd2-b363-41d2-9633-b164ea41d126" class=""><code>Object</code> obsahuje kromƒõ metody <code>.get_slot()</code>, jen≈æ pouze hled√° v <em>mapƒõ</em> pat≈ôiƒçn√Ω slot, tak√© metody <code>.parent_lookup()</code> a <code>.slot_lookup()</code>. Druh√° jmenovan√° je t√≠m, co se re√°lnƒõ pou≈æ√≠v√° v≈°ude v interpretru.</p>
      <p id="06397d75-eaf5-4a20-9efa-013a72b85c1a" class="">Metoda <code>.parent_lookup()</code> funguje n√°sledovnƒõ:</p>
      <p id="585de5ed-f8d5-4802-a5de-34bc38f64833" class="">Projde v≈°echny rodiƒçovsk√© sloty a pokud maj√≠ <code>.visited</code> nastaven√© na <code>True</code>, tak je p≈ôeskoƒç√≠. Pokud ne, pod√≠v√° se do jejich <code>.slots</code> (respektive do jejich mapy..) a zkus√≠ v nich naj√≠t jm√©no slotu. Pokud tam nen√≠, postupuje rekurzivnƒõ do hloubky pro rodiƒçovsk√© sloty prvn√≠ho rodiƒçovsk√©ho slotu. V≈°echny objekty, kter√© nav≈°t√≠v√≠, si oznaƒç√≠ pomoc√≠t property <code>.visited</code> a ulo≈æ√≠ pro pozdƒõj≈°√≠ resetov√°n√≠ t√©to property. Pokud je slot nalezen v nƒõkter√©m z rodiƒç≈Ø, ƒçi jeho rodiƒç≈Ø, je vr√°cen. Pokud nen√≠ v≈Øbec nalezen, je vr√°ceno <code>None</code>. V obou p≈ô√≠padech jsou nakonec v≈°echny pro≈°l√© objekty oznaƒçeny jako <code>.visited = False</code>. Prvn√≠m rodiƒçovsk√Ωm slotem, kter√Ω je v≈ædy prohled√°v√°m je speci√°ln√≠ rodiƒçovsk√Ω slot <code>.scope_parent</code>, kter√Ω je pou≈æit k uchov√°v√°n√≠ lok√°ln√≠ch parametr≈Ø a kontextu lok√°ln√≠ch a glob√°ln√≠ch promƒõnn√Ωch.</p>
      <p id="f407e2c8-db30-490b-b29d-3d13ed0ae4ff" class="">Druh√° jmenovan√° metoda <code>.slot_lookup()</code> se prvnƒõ pod√≠v√° do vlastn√≠ho seznamu slot≈Ø pomoc√≠ <code>.get_slot()</code> a pokud tam nic nenajde, pokraƒçuje metodou <code>.parent_lookup()</code>. T√≠m je implementovan√° dƒõdiƒçnost.</p>
      <h1 id="f7036f96-f008-440b-af54-2b457c482db5" class="">Pokraƒçov√°n√≠</h1>
      <p id="129c5c3a-fda8-42ed-b823-39752e2ee7cc" class="">P≈ô√≠≈°tƒõ se pod√≠v√°me na bajtk√≥d a liter√°ly a v jak√© je to cel√© ulo≈æen√© datov√© struktu≈ôe.</p>
      <h1 id="f5e79f19-5c60-4d03-a200-06785c1f0ae2" class="">Relevantn√≠ diskuze</h1>
      <ul id="b56a086b-0194-4c2e-9d11-726e78344e1a" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/bystroushaak/2019/3/13/444907">Jak se p√≠≈°e programovac√≠ jazyk 4: Objektov√Ω layout</a> (abclinuxu)
        </li>
      </ul>
      <p id="24f67f22-0015-4fd5-b796-84ebccd22fd4" class=""></p>
    </div>
  </article>
  <div class="corner-ribbon top-right red">
    <a href="https://www.patreon.com/bePatron?u=2618881">Become a Patron</a>
  </div><a class="twitter-share-button" id="twitter_button" href="#"><img src="../../tweet_button.svg"></a>
  <div id="sidebar_bottom">
    <div id="last_five_bottom">
      <h3>New posts:</h3>
      <ul>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment/Pebble_smartwatches.html">Pebble smartwatches</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment.html"><span class="icon">üìÇ</span>The Most Personal Device experiment</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/Unicode_font_subset.html">Unicode font subset</a>
        </li>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-05-25_Work_in_progress_everywhere.html">Lifelog 2020-05-25; Work in progress everywhere</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/Improvements/Vitamins_nootropics_and_other_boosters.html">Vitamins, nootropics and other boosters</a>
        </li>
      </ul>& <a href="../../Changelog.html">more</a>
    </div>
  </div>
</body>
</html>

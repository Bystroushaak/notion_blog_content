<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.2.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>ProgramÃ¡torova kritika chybÄ›jÃ­cÃ­ struktury operaÄnÃ­ch systÃ©mÅ¯</title>
  <link rel="stylesheet" type="text/css" href="../../style.css">
  <link rel="alternate" type="application/atom+xml" href="http://blog.rfox.eu/atom.xml">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Bystroushaak">
  <meta name="twitter:creator" content="@Bystroushaak">
  <meta name="twitter:title" content="ProgramÃ¡torova kritika chybÄ›jÃ­cÃ­ struktury operaÄnÃ­ch systÃ©mÅ¯">
  <meta name="twitter:description" content="PÅ™ed nÄ›jakou dobou se mi dostalo do rukou zamyÅ¡lenÃ­, zdali je vlastnÄ› zapotÅ™ebÃ­ operaÄnÃ­ systÃ©m, Äi ne. SÃ¡m na toto tÃ©ma provÃ¡dÃ­m jakÃ½si â€prÅ¯zkumâ€œ uÅ¾ pÅ™ibliÅ¾nÄ› dva roky. Rozhodl jsem se tedy, Å¾e bych mohl sepsat nosnÃ© myÅ¡lenky spolu s odkazy na nÄ›kterÃ© relevantnÃ­ zdroje informacÃ­.">
  <meta name="twitter:image" content="http://blog.rfox.eu/en/Programmers_critique_of_missing_structure_of_operating_systems/fs_metaphor.png">
  <script src="../../scripts.js">
  </script>
  <meta name="description" content="PÅ™ed nÄ›jakou dobou se mi dostalo do rukou zamyÅ¡lenÃ­, zdali je vlastnÄ› zapotÅ™ebÃ­ operaÄnÃ­ systÃ©m, Äi ne. SÃ¡m na toto tÃ©ma provÃ¡dÃ­m jakÃ½si â€prÅ¯zkumâ€œ uÅ¾ pÅ™ibliÅ¾nÄ› dva roky. Rozhodl jsem se tedy, Å¾e bych mohl sepsat nosnÃ© myÅ¡lenky spolu s odkazy na nÄ›kterÃ© relevantnÃ­ zdroje informacÃ­."><!-- Global site tag (gtag.js) - Google Analytics -->

  <script src="https://www.googletagmanager.com/gtag/js?id=UA-142545439-1">
  </script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-142545439-1');
  </script>
  <script data-ad-client="ca-pub-8322439660353685" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async>
  </script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
</head>
<body onload="on_body_load();">
  <div id="sidebar_top">
    <div id="last_five_top">
      <h3>New posts:</h3>
      <ul>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-06-15_Todo_in_motion.html" title="Lifelog 2020-06-15; Todo in motion">Lifelog 2020-06-15; Todo in motion</a>
        </li>
        <li>
          <a href="../../en/My_Greenspuns_counter.html" title="My Greenspun's counter">My Greenspun's counter</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/What_do_I_mean_by_node.html" title="What do I mean by node?">What do I mean by node?</a>
        </li>
        <li>
          <a href="../../en/Explorations/Trying_Ansible_alternatives_in_python.html" title="Trying Ansible alternatives in python">Trying Ansible alternatives in python</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment/Pebble_smartwatches.html" title="Pebble smartwatches">Pebble smartwatches</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment.html" title="The Most Personal Device experiment"><span class="icon">ğŸ“‚</span>The Most Personal Device experiment</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/Unicode_font_subset.html" title="Unicode font subset">Unicode font subset</a>
        </li>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-05-25_Work_in_progress_everywhere.html" title="Lifelog 2020-05-25; Work in progress everywhere">Lifelog 2020-05-25; Work in progress everywhere</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/Improvements/Vitamins_nootropics_and_other_boosters.html">Vitamins, nootropics and other boosters</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/objWiki/Transaction_support_for_simple_in_memory_database.html">Transaction support for simple in-memory database</a>
        </li>
      </ul>& <a href="../../Changelog.html" title="Changelog">more</a>
    </div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8322439660353685" data-ad-slot="8589969791" data-ad-format="auto" data-full-width-responsive="true"></ins> 
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div><a class="breadcrumb" href="../../index.html" title="Bystroushaak's blog">Bystroushaak's blog</a> / <a class="breadcrumb" href="../index.html" title="Czech section">Czech section</a> / ProgramÃ¡torova kritika chybÄ›jÃ­cÃ­ struktury operaÄnÃ­ch systÃ©mÅ¯
  <article id="ae480376-4afa-4e02-907a-3228370dc745" class="page sans">
    <header>
      <h1 class="page-title">ProgramÃ¡torova kritika chybÄ›jÃ­cÃ­ struktury operaÄnÃ­ch systÃ©mÅ¯</h1>
    </header>
    <div class="page-body">
      <div id="7b47a3e3-89a8-4e56-a9b8-525a23967117" class="column-list">
        <div id="dc7889f4-b661-4820-99a2-9447368365b3" style="width:18.75%" class="column">
          <p id="1c1695ec-f31f-44c4-8889-cec5cb9f706b" class=""><time>@2018/12/10</time></p>
        </div>
        <div id="d997e0e2-736c-48ac-955c-00acbbeaf2cf" style="width:81.25%" class="column">
          <p id="7c220dcf-aad5-4a26-b981-3e7e287eb5ed" class="">Available also in English: <a href="../../en/Programmers_critique_of_missing_structure_of_operating_systems.html" title="Programmer's critique of missing structure of operating systems">Programmer's critique of missing structure of operating systems</a></p>
        </div>
      </div>
      <p id="0dff7aaf-d828-4946-a76f-8d5cc7dc6c74" class="">PÅ™ed nÄ›jakou dobou se mi dostalo do rukou <a href="https://www.cl.cam.ac.uk/~srk31/research/papers/kell13operating.pdf">zamyÅ¡lenÃ­</a>, zdali je vlastnÄ› zapotÅ™ebÃ­ operaÄnÃ­ systÃ©m, Äi ne. SÃ¡m na toto tÃ©ma provÃ¡dÃ­m jakÃ½si <em>â€prÅ¯zkumâ€œ</em> uÅ¾ pÅ™ibliÅ¾nÄ› dva roky. Rozhodl jsem se tedy, Å¾e bych mohl sepsat nosnÃ© myÅ¡lenky spolu s odkazy na nÄ›kterÃ© relevantnÃ­ zdroje informacÃ­.</p>
      <h2 id="1d8e9806-af91-4536-ac27-51883664e296" class="">BuÄte varovÃ¡ni</h2>
      <p id="1df80904-a94b-4094-b78f-df85248fcac4" class="">Pozor, tento zÃ¡pisek obsahuje mnoÅ¾stvÃ­ textu. Pokud vÃ¡s text urÃ¡Å¾Ã­, zvaÅ¾te, zda se vÅ¯bec chcete pustit do diskuze.</p>
      <h2 id="ccb7aabf-3f07-4eb0-9dd6-1d604c29b940" class=""><code>&lt;moÅ¾nÃ© pÅ™eskoÄit&gt;</code></h2>
      <p id="66ab035d-cc2c-4690-b6ac-2475a194593e" class="">PÅ™ednÄ› bych rÃ¡d deklaroval, Å¾e tu mluvÃ­m sÃ¡m o sobÄ›. KdyÅ¾ budu psÃ¡t, Å¾e <em>â€je nÄ›co zapotÅ™ebÃ­â€œ</em>, <em>â€moÅ¾nÃ©â€œ</em>, nebo <em>â€schÅ¯dnÃ©â€œ</em>, myslÃ­m tÃ­m <em>â€zapotÅ™ebÃ­ pro mÄ›â€œ</em>, <em>â€moÅ¾nÃ© pro mÄ›â€œ</em>, nebo <em>â€schÅ¯dnÃ© pro mÄ›â€œ</em>.</p>
      <p id="75381acd-8267-4d45-afa6-1f0aadc30185" class="">ZaÅ¾il jsem aÅ¾ pÅ™Ã­liÅ¡ diskuzÃ­ na internetu, kterÃ© byly zpÅ¯sobeny ÄtenÃ­m mezi Å™Ã¡dky a vztahovÃ¡nÃ­m ÄtenÃ¡Å™ovo nÃ¡zorÅ¯ a pÅ™edsudkÅ¯ na osobu autora. VÃ­m, Å¾e tohle upozornÄ›nÃ­ pravdÄ›podobnÄ› nepomÅ¯Å¾e, ale zkuste se nad prezentovanÃ½mi myÅ¡lenkami zamyslet s otevÅ™enou myslÃ­.</p>
      <p id="10f458d5-1fa0-4722-8163-1ee3b4fb9dbb" class="">Pokud vÃ¡m nÄ›kterÃ© moje nÃ¡pady pÅ™ijdou kontroverznÃ­, nesmyslnÃ©, Äi pokud budete mÃ­t dokonce pocit, Å¾e VÃ¡s pobuÅ™ujÃ­ svou donebevolajÃ­cÃ­ blbostÃ­ - uklidnÄ›te se. VzpomeÅˆte si na vÃ½Å¡e uvedenou deklaraci. UvÄ›domte si, Å¾e vÅ¯bec nemluvÃ­m o vÃ¡s, nemÃ¡m potÅ™ebu a chuÅ¥ vÃ¡m nÄ›co vnucovat, mÄ›nit vÃ¡m workflow, nebo pomlouvat VÃ¡Å¡ systÃ©m. Berte to jako mojÃ­ podivnost, jako moÅ¾nÃ½ smÄ›r, kterÃ½ to chce vyzkouÅ¡et a nevztahujte to o Äem tu mluvÃ­m na sebe.</p>
      <p id="8ee77a2d-97b6-416e-b793-939a52baefaf" class="">Pokud ho nechcete, Äi nemÅ¯Å¾ete vloÅ¾it do diskuze, poÅ¡lete mi ho emailem na <code>bystrousak[]kitakitsune.org</code>, s nÄ›jakÃ½m smysluplnÃ½m pÅ™edmÄ›tem. MoÅ¾nÃ¡ VÃ¡s to pÅ™ekvapÃ­, ale napsal jsem docela hodnÄ› ÄlÃ¡nkÅ¯ s podobnÃ½m upozornÄ›nÃ­m a dodneÅ¡ka diskutuji s lidmi co je Äetli, i kdyÅ¾ je to tÅ™eba 7 let od vydÃ¡nÃ­. O vÃ¡Å¡ nÃ¡zor stojÃ­m.</p>
      <h2 id="3c38ef22-82fb-4b5d-ae1e-7296f988a7eb" class=""><code>&lt;/moÅ¾nÃ© pÅ™eskoÄit&gt;</code></h2>
      <h2 id="43b0313d-a94f-4729-8cb2-0e4f868f7718" class="">ProÄ?</h2>
      <p id="78abf4bb-cf4a-4bc7-a665-18af92fa5bf6" class="">V poslednÃ­ch letech jsem pracoval pro nÄ›kolik firem vytvÃ¡Å™ejÃ­cÃ­ch software. V nÄ›kterÃ½ch pÅ™Ã­padech jsem se zapojil do jiÅ¾ existujÃ­cÃ­ch tÃ½mÅ¯, v ostatnÃ­ch jsem zaÄÃ­nal spolu s nÄ›kolika dalÅ¡Ã­mi programÃ¡tory â€na zelenÃ© louceâ€œ. ÄŒasto jsem se pÅ™Ã­mo podÃ­lel na nÃ¡vrhu architektury, pokud jsem jÃ­ rovnou nevymÃ½Å¡lel sÃ¡m.</p>
      <p id="c948253c-29e9-4f24-8f63-7da27923a506" class="">Pracuji jako <em>â€backendovÃ½ programÃ¡torâ€œ</em>. MÃ½m popisem prÃ¡ce je typicky vytvÃ¡Å™et systÃ©my, kterÃ© naÄÃ­tajÃ­, zpracovÃ¡vajÃ­ a uklÃ¡dajÃ­ rÅ¯znÃ¡ data, parsujÃ­ vÅ¡emoÅ¾nÃ© formÃ¡ty, volajÃ­ rÅ¯znÃ© programy, Äi interagujÃ­ s ostatnÃ­mi systÃ©my a zaÅ™Ã­zenÃ­mi.</p>
      <p id="27321867-ab44-419e-abea-7fbe45cd8300" class="">V <em>NÃ¡rodnÃ­ knihovnÄ›</em> jsem v tÅ™Ã­ÄlennÃ©m tÃ½mu dÄ›lal na systÃ©mu pro zpracovÃ¡nÃ­ elektronickÃ½ch publikacÃ­. VytvoÅ™il jsem tam prakticky veÅ¡kerÃ½ backendovÃ½ kÃ³d, od uklÃ¡dÃ¡nÃ­ dat, po komunikaci s ostatnÃ­mi systÃ©my, mezi kterÃ© patÅ™Ã­ napÅ™Ã­klad Aleph, Kramerius, nebo LTP (dlouhodobÃ½ archiv digitÃ¡lnÃ­ch dat). Pro uklÃ¡dÃ¡nÃ­ byl pouÅ¾it linuxovÃ½ filesystÃ©m ext4 na CentOSu a objektovÃ¡ databÃ¡ze <a href="https://en.wikipedia.org/wiki/Zope_Object_Database">ZODB</a> vynucenÃ¡ <a href="https://plone.org/">Plonem</a>, ve kterÃ©m byla frontendovÃ¡ ÄÃ¡st. Pro komunikaci pak vÅ¡echno moÅ¾nÃ©, od volÃ¡nÃ­ API pÅ™es <a href="https://www.zdrojak.cz/clanky/rest-architektura-pro-webove-api/">REST</a>, nahrÃ¡vÃ¡nÃ­ XML souborÅ¯ na FTP, aÅ¾ po balenÃ­ vÄ›cÃ­ do ZIPu a kopÃ­rovÃ¡nÃ­ na sambu. InternÃ­ komponenty mezi sebou pouÅ¾Ã­valy <a href="https://en.wikipedia.org/wiki/RabbitMQ">RabbitMQ</a>.</p>
      <p id="09d72696-9016-4876-beec-62ff0c506cbc" class="">V jistÃ© nejmenovanÃ© spoleÄnosti jsem pracoval na systÃ©mu k ochranÄ› proti DDoS ÃºtokÅ¯m. KvÅ¯li NDA nemÅ¯Å¾u rozebÃ­rat podrobnosti nad rÃ¡mec popisu tehdejÅ¡Ã­ch pracovnÃ­ch inzerÃ¡tÅ¯. Ty ukazujÃ­, Å¾e byl takÃ© pouÅ¾it linux, python, SQL i NoSQL databÃ¡ze, spousta rÅ¯znÃ½ch existujÃ­cÃ­ch opensource programÅ¯ a na komunikaci RabbitMQ. Na velkÃ© ÄÃ¡sti z toho komunikaÄnÃ­ho kÃ³du jsem dÄ›lal pÅ™Ã­mo jÃ¡.</p>
      <p id="ecd5c781-8c3d-4b2f-94df-ccb86fa34ec4" class="">Pro <em>Nubium development</em>, vytvÃ¡Å™ejÃ­cÃ­ asi nejznÃ¡mÄ›jÅ¡Ã­ ÄeskÃ½ filehostingovÃ½ web <em>uloÅ¾.to</em>, jsem dÄ›lal na backendu. Zrefaktoroval jsem a ÄÃ¡steÄnÄ› navrhl kusy software, kterÃ© se starajÃ­ o uklÃ¡dÃ¡nÃ­ a redistribuci souborÅ¯ napÅ™Ã­Ä rÅ¯znÃ½mi servery, ale i o zpracovÃ¡nÃ­ uÅ¾ivatelskÃ½ch dat. NapÅ™Ã­klad ikonky, kterÃ© se zobrazujÃ­ u nÃ¡hledÅ¯ archivÅ¯ a videÃ­, jsou moje prÃ¡ce, kromÄ› spousty dalÅ¡Ã­ch vÄ›cÃ­, kterÃ© nikde neuvidÃ­te.</p>
      <p id="9eb33bfb-8a8f-48cb-a73e-ff5e57bfd4ed" class="">Pro pÃ¡r dalÅ¡Ã­ch firem jsem dÄ›lal rÅ¯znÃ© weby a RESTovÃ© sluÅ¾by. SÃ¡hl jsem si ovÅ¡em i na exotiÄtÄ›jÅ¡Ã­ vÄ›cÃ­, napÅ™Ã­klad na systÃ©m pro rozpoznÃ¡nÃ­ a automatickÃ© vyhodnocovÃ¡nÃ­ zÃ¡bÄ›rÅ¯ z kamer v rÅ¯znÃ½ch tunelech a k tomu pÅ™idruÅ¾enÃ½ <em>machine learning</em>.</p>
      <p id="fc604cae-f9e7-4af9-ac3f-b4abef286969" class="">VÅ¡ude kde jsem dÄ›lal se pouÅ¾Ã­val linux, databÃ¡ze, a vÄ›tÅ¡inou i nÄ›jakÃ¡ forma <em>message queue</em> pÅ™edÃ¡vajÃ­cÃ­ strukturovanÃ¡ data. NÄ›kdy Å¡lo o SQL tabulky, jindy o JSON poslanÃ½ pÅ™es RabbitMQ.</p>
      <p id="9b2855a3-b9b4-4a6e-b891-cd7644fcfd9a" class="">V kaÅ¾dÃ© z jmenovanÃ½ch firem jsem vidÄ›l ten samÃ½ vzor - nezÃ¡visle na sobÄ› vytvoÅ™enÃ½, pÅ™ibliÅ¾nÄ› podobnÃ½ kus software, kterÃ½ pÅ™irozenÄ› vyplynul z nÄ›kolika poÅ¾adavkÅ¯:</p>
      <ul id="79d55add-6089-4638-bef0-9aedfb743583" class="bulleted-list">
        <li>SpolehlivÃ© uklÃ¡dÃ¡nÃ­ velkÃ©ho poÄtu malÃ½ch souborÅ¯ (miliony souborÅ¯, s prÅ¯mÄ›rnÄ› megabajty aÅ¾ gigabajty na soubor), Äi menÅ¡Ã­ho poÄtu velkÃ½ch souborÅ¯ (terabajty / soubor).</li>
      </ul>
      <ul id="a4c5fa5a-2d50-47aa-8a67-435ce1eabadd" class="bulleted-list">
        <li>NaÄÃ­tÃ¡nÃ­ a zÃ¡pis konfigurace ve strukturovanÃ©m formÃ¡tu (INI, JSON, XML, YAML, ..).</li>
      </ul>
      <ul id="5590c10c-cbc2-4dc5-b98c-b400bd007d66" class="bulleted-list">
        <li>StrukturovanÃ¡ komunikace mezi vlastnÃ­mi, ale i s cizÃ­mi programy.</li>
      </ul>
      <ul id="4df40d75-6e25-4e4b-89e4-0c1995a67599" class="bulleted-list">
        <li>DistribuovanÃ¡ architektura zahrnujÃ­cÃ­ vÃ­cero fyzickÃ½ch strojÅ¯, umoÅ¾ÅˆujÃ­cÃ­ snadnÃ© Å¡kÃ¡lovÃ¡nÃ­.</li>
      </ul>
      <p id="d68709dd-fabd-46c1-a005-ee809b65c2bf" class="">Pokud programujete, pravdÄ›podobnÄ› vÃ­te, kam tÃ­m mÃ­Å™Ã­m. JestliÅ¾e spousta programÃ¡torÅ¯ vytvÃ¡Å™Ã­ nad danou knihovnou stÃ¡le stejnÃ½ vzor, nejednÃ¡ se o chybu programÃ¡torÅ¯, ale o Å¡patnÄ› navrÅ¾enou knihovnu.</p>
      <p id="32f496b3-4600-402a-987a-822c378a4c83" class="">PostupnÄ›, jak jsem nad tÃ­m tak pÅ™emÃ½Å¡lel, jsem dospÄ›l k nÃ¡zoru, Å¾e je Å¡patnÄ› samotnÃ¡ <em>architektura</em> operaÄnÃ­ho systÃ©mu. To co nÃ¡m nabÃ­zÃ­ a co umoÅ¾Åˆuje nepovÃ­dÃ¡ tomu co po nÄ›m chceme a co od nÄ›j oÄekÃ¡vÃ¡me. PÅ™edevÅ¡Ã­m z hlediska â€<em>programÃ¡torskÃ©ho uÅ¾ivatelskÃ©ho interface</em>â€œ, tedy toho, s ÄÃ­m jako programÃ¡tor pracuji.</p>
      <h2 id="e83313bc-c048-44c0-8b9b-faf10ad54f5b" class="">OperaÄnÃ­ systÃ©m</h2>
      <p id="0c3d055e-2441-469c-b2e7-fb4727172e91" class="">KdyÅ¾ jsem byl mladÅ¡Ã­, mÄ›l jsem pomÄ›rnÄ› jasnou pÅ™edstavu o tom, co je to operaÄnÃ­ systÃ©m: <em>Windows pÅ™ece</em>. To je ta vÄ›c, co majÃ­ vÅ¡ichni na poÄÃ­taÄi, vlevo dole to mÃ¡ tlaÄÃ­tko start, a kdyÅ¾ nenabÄ›hne a zobrazÃ­ se jen ÄernÃ¡ obrazovka, je zapotÅ™ebÃ­ napsat <code>win</code>.</p>
      <p id="9258da41-3d98-4176-a62e-1575b5287a2c" class="">Na stÅ™ednÃ­ Å¡kole mÄ› nauÄili definici, podle kterÃ© je operaÄnÃ­ systÃ©m <em>â€programovÃ© vybavenÃ­ poÄÃ­taÄe zpÅ™Ã­stupÅˆujÃ­cÃ­ vstupnÄ›-vÃ½stupnÃ­ zaÅ™Ã­zenÃ­â€œ</em>.</p>
      <p id="6933623b-c15d-47a2-ba2f-a3f25ed8271b" class="">PozdÄ›ji jsem zjistil, Å¾e operaÄnÃ­ch systÃ©mÅ¯ existuje hodnÄ› a v podstatÄ› vÅ¡echny dÄ›lajÃ­ to samÃ©; vytvÃ¡Å™ejÃ­ Â± jednotnou abstrakci nad hardwarem poÄÃ­taÄe, umoÅ¾ÅˆujÃ­ pouÅ¡tÄ›t rÅ¯znÃ© programy, nabÃ­zÃ­ vÃ­ce, Äi mÃ©nÄ› propracovanÃ½ filesystÃ©m, spravujÃ­ pamÄ›Å¥, Å™eÅ¡Ã­ multitasking a uÅ¾ivatelskÃ¡ prÃ¡va.</p>
      <p id="ebd8683e-18ff-43ee-b6ef-78f990578471" class="">V dneÅ¡nÃ­ dobÄ› je operaÄnÃ­ systÃ©m pro vÄ›tÅ¡inu lidÃ­ <em>to</em>, ÄÃ­m pouÅ¡tÃ­ svÃ© prohlÃ­Å¾eÄe, ve kterÃ½ch koukajÃ­ na <em>youtuby</em> a na <em>facebooky</em> a taky skrz <em>to</em> posÃ­lajÃ­ emaily. ObÄas <em>to</em> umÃ­ pouÅ¡tÄ›t hry a pracovat se vÅ¡Ã­m moÅ¾nÃ½m, od CD-ROMky po klÃ¡vesnici.</p>
      <p id="0fb4f06d-8123-45b7-afd0-7d356ded2c7f" class="">Pro pokroÄilÃ© uÅ¾ivatele je to pak urÄitÃ¡ forma databÃ¡ze a API, kterÃ¡ umoÅ¾Åˆuje spouÅ¡tÄ›t jejich programy a takÃ© nabÃ­zÃ­ standardizovanÃ½ pÅ™Ã­stup ke konkrÃ©tnÃ­m Äinnostem. NapÅ™Ã­klad vÃ½pis znaku, uloÅ¾enÃ­ souboru, navÃ¡zÃ¡nÃ­ spojenÃ­ po internetu a tak podobnÄ›.</p>
      <p id="93944212-085e-45cc-ba9d-9ddde458282a" class="">VÄ›tÅ¡inou mÃ¡me tendenci vnÃ­mat operaÄnÃ­ systÃ©m jako nÄ›co nemÄ›nnÃ©ho, co si vybereme z relativnÄ› malÃ© nabÃ­dky diktovÃ¡nÃ© svatou trojicÃ­ (Windows, Mac, Linux), okolo kterÃ© se zmatenÄ› krÄÃ­ nÄ›kolik prakticky nepouÅ¾Ã­vanÃ½ch (0.03% celkem) alternativ (*BSD, Plan9, BeOS, ..).</p>
      <p id="795770d0-fab0-42ce-8b4f-89f1bf8389b8" class="">Z nÄ›jakÃ©ho dÅ¯vodu jsou vÅ¡echny skuteÄnÄ› pouÅ¾Ã­vanÃ© systÃ©my aÅ¾ na vÃ½jimky hodnÄ› podobnÃ©. RÃ¡d bych se zamyslel, jestli je to skuteÄnÄ› Å¾Ã¡danÃ¡ vlastnost, nebo nÃ¡hodnÃ½ historickÃ½ vÃ½voj.</p>
      <h2 id="8a5d1b51-5292-4174-985a-03d38d7fe752" class="">KrÃ¡tkÃ¡ historie operaÄnÃ­ch systÃ©mÅ¯</h2>
      <p id="3152d01e-ec3b-49e7-b282-3b7f4d8868f9" class="">PrvnÃ­ poÄÃ­taÄe nemÄ›ly operaÄnÃ­ systÃ©m a byly uÅ¾ivatelsky velmi nepÅ™Ã­jemnÃ©. Daly se programovat pouze pÅ™Ã­mou zmÄ›nou hardwarovÃ©ho propojenÃ­.</p>
      <p id="0ef4ec0b-e952-4bd8-a00d-e6d800825019" class="">Pak pÅ™iÅ¡ly dÄ›rnoÅ¡tÃ­tkovÃ© a dÄ›rnopÃ¡skovÃ© stroje. Na nich operÃ¡tor <a href="https://youtu.be/XV-7J5y1TQc?t=242">nacvakal</a> sÃ©riÃ­ pÅ™epÃ­naÄÅ¯ pÅ™Ã­mo do pamÄ›ti binÃ¡rnÄ› â€zavadÄ›Äâ€œ, jenÅ¾ mu umoÅ¾nil naÄÃ­st dÄ›rnÃ© Å¡tÃ­tky, Äi dÄ›rnÃ½ pÃ¡sek. Ten obsahoval sekvence instrukcÃ­ a data.</p>
      <p id="1c15d380-a914-400b-9ee9-3da0066f3428" class="">SystÃ©m pracoval v takzvanÃ½ch dÃ¡vkÃ¡ch. ProgramÃ¡tor dodal mÃ©dium s dÃ¡vkou dat, operÃ¡tor je naÄetl do poÄÃ­taÄe a spustil. Po dokonÄenÃ­ bÄ›hu vrÃ¡til programÃ¡torovi vÃ½sledky, Äi chybovou hlÃ¡Å¡ku, pokud doÅ¡lo k chybÄ›.</p>
      <p id="0b716439-2513-4dce-8fa4-47a0bfd55729" class="">JelikoÅ¾ se jednalo o hodnÄ› manuÃ¡lnÃ­ Äinnosti, Äasem vznikly knihovny pomocnÃ½ch funkcÃ­ a rÅ¯znÃ© uÅ¾iteÄnÃ© nÃ¡stroje. NapÅ™Ã­klad zavadÄ›Ä, kterÃ½ se zavede automaticky po startu poÄÃ­taÄe a umoÅ¾nÃ­ naÄtenÃ­ programÃ¡torova programu pouhÃ½m stisknutÃ­m patÅ™iÄnÃ©ho tlaÄÃ­tka. Nebo <em>subrutina</em>, kterÃ¡ pÅ™i pÃ¡du programu vypÃ­Å¡e obsah pamÄ›ti. TÄ›mto programÅ¯m se Å™Ã­kalo <em>monitory</em>.</p>
      <p id="c3f3cb33-8290-4bc0-bfdf-82c1ff0f3358" class="">ProtoÅ¾e tehdejÅ¡Ã­ poÄÃ­taÄe byly velmi, velmi drahÃ©, vznikl tlak na jejich pouÅ¾itÃ­ vÃ­cero uÅ¾ivateli zÃ¡roveÅˆ. S tÃ­m pÅ™iÅ¡ly prvnÃ­ operaÄnÃ­ systÃ©my, kterÃ© slouÄily funkcionalitu <em>monitoru</em>, pÅ™idaly podporu bÄ›hu vÃ­cero programÅ¯ zÃ¡roveÅˆ a takÃ© nabÃ­dly sprÃ¡vu a paralelnÃ­ pÅ™Ã­stup vÃ­cero uÅ¾ivatelÅ¯.</p>
      <p id="efe3d91c-f310-42f4-b404-260fc89e6382" class="">StÃ¡le komplikovanÄ›jÅ¡Ã­ hardware a komplexita jeho pÅ™Ã­mÃ©ho ovlÃ¡dÃ¡nÃ­ zpÅ¯sobila narÅ¯stajÃ­cÃ­ tlak na univerzÃ¡lnost kÃ³du mezi rÅ¯znÃ½mi stroji a jejich verzemi. OperaÄnÃ­ systÃ©my zaÄaly nabÃ­zet podporu typicky pouÅ¾Ã­vanÃ½ch zaÅ™Ã­zenÃ­. NadÃ¡le jiÅ¾ nebylo tÅ™eba zadÃ¡vat adresu pamÄ›ti na disku, staÄilo uloÅ¾it data do pojmenovanÃ©ho umÃ­stÄ›nÃ­, a pozdÄ›ji i do sloÅ¾ek. Vznikly prvnÃ­ souborovÃ© systÃ©my. S podporou vÃ­cero uÅ¾ivatelÅ¯ zÃ¡roveÅˆ vyvstala takÃ© snaha oddÄ›lit jejich programy, aby si navzÃ¡jem nemohly pÅ™episovat a ÄÃ­st data. TakÃ© vznikly plÃ¡novaÄe a virtuÃ¡lnÃ­ pamÄ›Å¥ a multitasking.</p>
      <p id="2ed42f88-0c61-4691-b573-ee4977b97b3c" class="">OperaÄnÃ­ systÃ©my se staly vrstvou, kterÃ¡ stojÃ­ mezi uÅ¾ivatelem, jenÅ¾ nadÃ¡le nemusÃ­ bÃ½t programÃ¡torem, a poskytuje mu standardnÃ­ zpÅ¯soby uloÅ¾enÃ­ dat, vÃ½pisu znaku na obrazovku, prÃ¡ci s klÃ¡vesnicÃ­, tisku na tiskÃ¡rnu a spuÅ¡tÄ›nÃ­ jeho dÃ¡vky / programu.</p>
      <p id="410e919c-2586-451d-b3ac-aaad07f99370" class="">PozdÄ›ji k tomu pÅ™ibylo jeÅ¡tÄ› grafickÃ© rozhranÃ­ a sÃ­Å¥ovÃ¡nÃ­. OsobnÃ­ poÄÃ­taÄe nabÃ­dly plejÃ¡du zaÅ™Ã­zenÃ­, z nichÅ¾ vÅ¡echny musel operaÄnÃ­ systÃ©m umÄ›t pouÅ¾Ã­vat a podporovat. AÅ¾ na pÃ¡r vÃ½jimek, kterÃ½m se budu vÄ›novat dÃ¡le, Å¡lo o iterativnÃ­ vÃ½voj, kterÃ½ nepÅ™inesl nic zÃ¡sadnÄ› revoluÄnÃ­ho. VÅ¡echno se zlepÅ¡ovalo, zefektivÅˆovalo, samotnÃ© paradigma se vÅ¡ak moc nezmÄ›nilo.</p>
      <h1 id="e696a1d6-3fa0-43b2-8561-8de8da0aee3b" class="">Kritika operaÄnÃ­ho systÃ©mu</h1>
      <p id="0e6eb48f-f905-4b10-943a-24353585f5fb" class="">NemÃ¡m nejmenÅ¡Ã­ problÃ©m s konceptem operaÄnÃ­ho systÃ©mu jako hardwarovÃ© abstrakce. Naopak! MÃ¡m problÃ©m s konceptem OS jako uÅ¾ivatelskÃ©ho rozhranÃ­. TÃ­m nemyslÃ­m grafiku, ale zbytek vÅ¡eho s ÄÃ­m interagujete, a co mÃ¡ nÄ›jakÃ½ tvar;</p>
      <h2 id="4e9389cf-c9c6-4367-8ec9-7dfc5f5cbb51" class="">Koncept souborovÃ©ho systÃ©mu</h2>
      <p id="5f4fdf98-d70c-499a-86c4-c9f3ca933f5d" class="">SchvÃ¡lnÄ› se zkuste zamyslet, co to vlastnÄ› je. Vyjde vÃ¡m, Å¾e je to omezenÃ¡ hierarchickÃ¡ <em>key-value</em> databÃ¡ze.</p>
      <p id="d21255db-ec66-4e04-924f-e01af4b1b72e" class="">OmezenÃ¡, protoÅ¾e omezuje nejen velikost a subset klÃ­Äe, kterÃ½ je v lepÅ¡Ã­m pÅ™Ã­padÄ› v UTF, ale i samotnou uloÅ¾enou <em>hodnotu</em> na proud bajtÅ¯. To se zdÃ¡ rozumnÃ© jen do chvÃ­le, kdy si uvÄ›domÃ­te, Å¾e je to stromovÃ¡ databÃ¡ze, kterÃ¡ vÃ¡m nedovoluje pÅ™Ã­mo uklÃ¡dat strukturovanÃ¡ data. PoÄet inodÅ¯ (vÄ›tvÃ­ struktury) je navÃ­c omezen na ÄÃ­slo, jenÅ¾ se v horÅ¡Ã­ch pÅ™Ã­padech pohybuje v Å™Ã¡du desÃ­tek aÅ¾ stovek tisÃ­c, maximÃ¡lnÄ› vÅ¡ak pÃ¡r milionÅ¯ prvkÅ¯ v jednom <em>adresÃ¡Å™i</em>.</p>
      <figure id="46e9a00c-962d-4125-b443-be480047210d" class="image">
        <a href="../../en/Programmers_critique_of_missing_structure_of_operating_systems/fs_metaphor.png" title="fs_metaphor.png"><img style="width:600px" src="../../en/Programmers_critique_of_missing_structure_of_operating_systems/fs_metaphor.png"></a>
      </figure>
      <p id="e9c57347-247f-4717-973a-25243c9219bc" class="">Ve dvou z mÃ½ch pÅ™edchozÃ­ch zamÄ›stnÃ¡nÃ­ch jsme museli obchÃ¡zet omezenÃ½ poÄet inodÅ¯ na sloÅ¾ku retardacÃ­ jako <a href="http://balanceddiscstorage.readthedocs.io/">BalancedDiscStorage</a>, Äi uklÃ¡dÃ¡nÃ­m souborÅ¯ do tÅ™Ã­ podsloÅ¾ek sloÅ¾enÃ½ch z prvnÃ­ch tÅ™Ã­ pÃ­smen MD5 hashe souboru.</p>
      <p id="82d57a3e-9676-4fb1-950a-341acf3dd065" class="">K tomu pro vÄ›tÅ¡inu operacÃ­ chybÃ­ atomicita, a transakce nejsou podporovÃ¡ny vÅ¯bec. ParalelnÃ­ zÃ¡pisy a ÄtenÃ­ fungujÃ­ v rÅ¯znÃ½ch operaÄnÃ­ch systÃ©mech rÅ¯znÄ›, a ve skuteÄnosti nenÃ­ garantovÃ¡no naprosto nic. SchvÃ¡lnÄ› si to srovnejte se svÄ›tem databÃ¡zÃ­, kde se <a href="https://cs.wikipedia.org/wiki/Datab%C3%A1zov%C3%A1_transakce#Vlastnosti">ACID</a> povaÅ¾uje za samozÅ™ejmost.</p>
      <p id="f97c792f-00a4-4410-8cec-a2a4cdd80e14" class="">FilesystÃ©m je specificky omezenÃ¡ databÃ¡ze. KaÅ¾dÃ½ koho znÃ¡m, kdo se kdy pokusil filesystÃ©m pouÅ¾Ã­t pro cokoliv netriviÃ¡lnÃ­ho, dÅ™Ã­v nebo pozdÄ›ji tvrdÄ› narazil. AÅ¥ uÅ¾ je to programÃ¡tor, kterÃ½ si Å™ekne, Å¾e si ty data prostÄ› a jednoduÅ¡e bude uklÃ¡dat do souborÅ¯, nebo uÅ¾ivatel, kterÃ½ se v bordelu na filesystÃ©mu nemÅ¯Å¾e vyznat a musÃ­ pouÅ¾Ã­vat rÅ¯znÃ© divnÃ© vyhledÃ¡vÃ¡nÃ­ a indexovÃ¡nÃ­. VÃ½kÅ™ikem techniky je, kdyÅ¾ dokÃ¡Å¾e poznat, Å¾e mÃ¡ poÅ¡kozenÃ¡ data a dopoÄÃ­tat je zpÄ›tnÄ› ze samo-opravnÃ½ch kÃ³dÅ¯, pokud mÃ¡te disky v RAIDu.</p>
      <p id="a44fcbc0-cc30-45ac-9530-fcc438b7b7a4" class="">SamozÅ™ejmÄ› chÃ¡pu, Å¾e pointou je nÄ›co jinÃ©ho. Å˜eÅ¡Ã­ se tu sektory na disku a Å¾urnÃ¡lovÃ¡nÃ­, plotny a oddÃ­ly a RAIDy a celÃ© je to super pokrok oproti pÅ¯vodnÃ­m primitivnÃ­m systÃ©mÅ¯m uklÃ¡dÃ¡nÃ­ dat. <em>Ale</em> â€” nenÃ­ to nÃ¡hodou pokrok Å¡patnÃ½m smÄ›rem?</p>
      <figure id="a437aec1-4202-4a66-8997-f8d7ba41240d" class="image">
        <a href="../../en/Programmers_critique_of_missing_structure_of_operating_systems/150401-erma-mark1-file-system.png" title="150401-erma-mark1-file-system.png"><img style="width:624px" src="../../en/Programmers_critique_of_missing_structure_of_operating_systems/150401-erma-mark1-file-system_thumb.jpg"></a>
      </figure>
      <p id="62665ba8-d070-40f6-9441-059cea617da4" class="">PÅ¯vodnÃ­ filesystÃ©my byly metafora. Metafora pro uklÃ¡dÃ¡nÃ­ souborÅ¯ do sloÅ¾ek, tak jako se strkajÃ­ papÃ­ry do Å¡anonÅ¯ a Å¡uplÃ­kÅ¯. KromÄ› mnoha technickÃ½ch omezenÃ­, danÃ½ch stavem tehdejÅ¡Ã­ vÃ½poÄetnÃ­ techniky, trpÄ›ly a trpÃ­ i omezenÃ­m z podstaty tÃ©to metafory. PÅ™emÃ½Å¡lÃ­m, jestli by jsme si mÃ­sto otÃ¡zky <em>â€jak trochu vylepÅ¡it padesÃ¡t let starou metaforuâ€œ</em> (tÅ™eba pomocÃ­ tagÅ¯) nemÄ›li klÃ¡st spÃ­Å¡ otÃ¡zku <em>â€je to vÃ¡Å¾nÄ› ta sprÃ¡vnÃ¡ metafora pro uklÃ¡dÃ¡nÃ­ dat?â€œ</em></p>
      <h2 id="7b504fe9-c770-4c40-844d-b5e5cc85b960" class="">Programy</h2>
      <p id="e63909b6-a3aa-4317-8400-3ad4bb6a5d5f" class="">ÄŒistÄ› fyzicky, programy jako takovÃ© nejsou nic jinÃ©ho, neÅ¾ jen sekvence uloÅ¾enÃ½ch bajtÅ¯. V podstatÄ› ani pro operaÄnÃ­ systÃ©m nemÅ¯Å¾ou bÃ½t nic jinÃ©ho, neboÅ¥ souborovÃ¡ databÃ¡ze operaÄnÃ­ho systÃ©mu s niÄÃ­m jinÃ½m pracovat ani neumÃ­.</p>
      <p id="5914bc60-cd9b-4518-bb3c-369ec281274d" class="">Programy se prvnÄ› napÃ­Å¡ou ve zdrojovÃ©m kÃ³du pÅ™Ã­sluÅ¡nÃ©ho jazyka, kterÃ½ se potom zkompiluje a slinkuje do jednoho bloku. Ten je nÃ¡slednÄ› vydÄ›rovÃ¡n na dÄ›rnÃ© Å¡tÃ­tky (binÃ¡rnÃ­ data) a zastrÄen do patÅ™iÄnÃ© krabice (souboru) ve sprÃ¡vnÃ© sekci kartotÃ©ky (filesystÃ©mu).</p>
      <p id="8e53a751-a28f-4066-961f-b46f224c7c7b" class="">KdyÅ¾ chce uÅ¾ivatel program pustit, napÃ­Å¡e jeho jmÃ©no na pÅ™Ã­kazovÃ©m Å™Ã¡dku, nebo nÄ›kde klepne na ikonu. PosklÃ¡danÃ© dÄ›rnÃ© Å¡tÃ­tky jsou nÃ¡slednÄ› vyndÃ¡ny z kartotÃ©ky a nacpÃ¡ny do pamÄ›ti, kterÃ¡ se pro program tvÃ¡Å™Ã­, jako kdyby byl v celÃ©m operaÄnÃ­m systÃ©mu sÃ¡m. KÃ³d je potÃ© provÃ¡dÄ›n od poÄÃ¡teÄnÃ­ch dÄ›rnÃ½ch Å¡tÃ­tkÅ¯ k tÄ›m koncovÃ½m, s tÃ­m Å¾e program mÅ¯Å¾e podmÃ­nÄ›nÄ› pÅ™eskoÄit na konkrÃ©tnÃ­ dÄ›rnÃ½ Å¡tÃ­tek v krabici, kterÃ¡ ho tvoÅ™Ã­.</p>
      <figure id="53420a0f-08ae-497f-af2b-dfbdac6ae07b" class="image">
        <a href="../../en/Programmers_critique_of_missing_structure_of_operating_systems/pe_structure.jpg" title="pe_structure.jpg"><img style="width:2653px" src="../../en/Programmers_critique_of_missing_structure_of_operating_systems/pe_structure_thumb.jpg"></a>
      </figure>
      <p id="a19641cd-eced-4efb-9e6a-d9ff137cd221" class="">Programy taky mÅ¯Å¾ou ÄÃ­st parametry pÅ™Ã­kazovÃ©ho Å™Ã¡dku, pouÅ¾Ã­vat sdÃ­lenÃ© knihovny, volat API operaÄnÃ­ho systÃ©mu, pracovat s filesystÃ©mem, posÃ­lat (ÄÃ­selnÃ©) signÃ¡ly rÅ¯znÃ½m jinÃ½m programÅ¯m, reagovat na nÄ›, vracet nÃ¡vratovÃ© hodnoty, nebo otevÃ­rat sockety.</p>
      <p id="c2fca4db-7b97-4985-a16c-ddbab02a88d3" class="">Co je na tom Å¡patnÄ›?</p>
      <p id="4448bdc8-3238-4cef-a1c5-96e977dff3c1" class="">Nechci Å™Ã­ct, Å¾e je koncept Å¡patnÃ½ jako takovÃ½. ALE. OpÄ›t je to stejnÃ¡ starÃ¡ metafora, iterativnÃ­m vÃ½vojem posunutÃ¡ o pÃ¡r krokÅ¯ dÃ¡l. VÅ¡echno mi pÅ™ijde hroznÄ› <em>nÃ­zkoÃºrovÅˆovÃ©</em>. CelÃ½ ten systÃ©m se za poslednÃ­ch 40 let zmÄ›nil jen minimÃ¡lnÄ› a nemÅ¯Å¾u se zbavit myÅ¡lenky, Å¾e neÅ¾ Å¾e by jsme dorazili k naprostÃ© dokonalosti, spÃ­Å¡ jsme nÄ›kde uvÃ¡zli v zÃ¡krutÄ› lokÃ¡lnÃ­ho maxima.</p>
      <p id="72817ab9-90f9-4d89-bf25-de9dd2a423ef" class=""><a href="https://en.wikipedia.org/wiki/Lisp_machine">LispovskÃ© stroje</a>, <a href="http://toastytech.com/guis/alto3.html">SmalltalkovskÃ©</a> a <a href="http://www.selflanguage.org/">SelfovÃ© prostÅ™edÃ­</a> mÄ› nauÄily, Å¾e se to dÃ¡ dÄ›lat i jinak. Å½e programy nutnÄ› nemusÃ­ bÃ½t kolekce bajtÅ¯, ale mÅ¯Å¾ou to bÃ½t malÃ© samostatnÃ© objekty, kterÃ© jsou (metaforou posÃ­lÃ¡nÃ­ zprÃ¡v) zavolatelnÃ© z ostatnÃ­ch ÄÃ¡stÃ­ systÃ©mu, a kterÃ© se dynamicky kompilujÃ­ podle potÅ™eby.</p>
      <p id="a9d97f94-dc39-46a8-8506-4ddad0909efe" class="">ZnÃ¡te takovou tu <a href="https://cs.wikipedia.org/wiki/Filosofie_Unixu">unixovou filosofii</a>, Å¾e je dobrÃ© pouÅ¾Ã­vat malÃ© programy, kterÃ© dÄ›lajÃ­ jednu vÄ›c, na tu se zamÄ›Å™ujÃ­ a dÄ›lajÃ­ jÃ­ dobÅ™e? ProÄ tu myÅ¡lenku nedotÃ¡hnout do konce a neudÄ›lat malÃ© programy z kaÅ¾dÃ© funkce a metody vaÅ¡eho programu? Ta by naoplÃ¡tku mohla komunikovat s metodami a funkcemi ostatnÃ­ch programÅ¯.</p>
      <p id="e58ec4d7-997e-41bc-9f15-f8966a3d0d20" class="">Ve Smalltalku to tak funguje, dokonce nenÃ­ problÃ©m to verzovat, specifikovat zÃ¡vislosti, mÃ­t nad tÃ­m package manager, oÅ¡etÅ™enÃ­ chyb, nÃ¡povÄ›du a kdo vÃ­ co dalÅ¡Ã­ho. VÃ¡Å¾nÄ› by to neÅ¡lo dÄ›lat s programy obecnÄ›?</p>
      <h2 id="b2c870a8-3b25-424c-b7d1-73faf12da40d" class="">Data bez struktury, nazÃ½vanÃ¡ soubory</h2>
      <blockquote id="f06ded2d-219b-4652-9ae4-ea11b4655f08" class="">
        The whole UNIX ethos has been a huge drag on industry progress. UNIX's pitch is essentially: how about a system of small functions each doing discrete individual things... but functions must all have the signature char *function(const char *)? Structured data is for fools, we'll just reductively do everything as text. What we had in 1972 is fine. Let's stick with that.
      </blockquote>
      <p id="6ce79471-c805-429c-8d5b-257d4b9297bb" class=""><em>(Zdroj:</em> <em><a href="http://www.righto.com/2017/10/the-xerox-alto-smalltalk-and-rewriting.html?showComment=1508781022450#c7613952874348706529">http://www.righto.com/2017/10/the-xerox-alto-smalltalk-and-rewriting.html?showComment=1508781022450#c7613952874348706529</a></em><em>)</em></p>
      <p id="0f248c9c-d36c-4ee8-ab30-1af162f41096" class="">A jsme zase u tÄ›ch binÃ¡rnÃ­ch dat. Na prvnÃ­ pohled geniÃ¡lnÃ­ myÅ¡lenka, protoÅ¾e nic nemÅ¯Å¾e bÃ½t vÃ­c univerzÃ¡lnÃ­. Na dalÅ¡Ã­ pohled uÅ¾ tak ne.</p>
      <p id="c64cf61b-8e6d-4280-baf0-476feaada41f" class="">V Äem je problÃ©m?</p>
      <p id="70bbbcc3-0a67-4696-9ad3-09944bfbe637" class="">Prakticky vÅ¡echna data majÃ­ svou strukturu. Kdykoliv, kdy programÃ¡toÅ™i v programovacÃ­m jazyku pracujÃ­ s daty, a nejednÃ¡ se jen o jejich pÅ™esunutÃ­, tak se jim snaÅ¾Ã­ dÃ¡t strukturu. NamapujÃ­ je na rÅ¯znÃ© <code>struct</code> konstrukty. VytvoÅ™Ã­ z nich strom objektÅ¯. I u <em>streamovanÃ½ch</em> vÄ›cÃ­, jako je tÅ™eba zÃ¡znam zvuku ve formÃ¡tu <a href="https://cs.wikipedia.org/wiki/WAV">WAV</a>, se iteruje skrz jednotlivÃ© <em>chunky</em>.</p>
      <figure id="2a27a936-5835-4114-87a8-148a61d948a2" class="image">
        <a href="wav101.png" title="wav101.png"><img style="width:1488px" src="wav101_thumb.jpg"></a>
      </figure>
      <p id="a86bb881-298c-4310-8926-35b5018288f2" class=""><em>(Struktura WAV souboru. Zdroj:</em> <a href="https://github.com/corkami/pics/"><em>https://github.com/corkami/pics/</em></a><em>.)</em></p>
      <p id="0641ece5-4d5d-4035-8769-172f3690e01c" class="">ProÄ tedy proboha kaÅ¾dÃ½ program vezme data, dÃ¡ jim strukturu, nÄ›co nad nÃ­ udÄ›lÃ¡ a tu strukturu zahodÃ­ a zkolabuje zpÄ›t na nestrukturovanÃ¡, <em>surovÃ¡</em> binÃ¡rnÃ­ data?</p>
      <p id="27e550aa-2ab2-495c-a027-be88946a1264" class="">SouÄasnÃ¡ poÄÃ­taÄovÃ¡ kultura je posedlÃ¡ parsery a externÃ­mi popisy dat, jenÅ¾ by vÅ¡ak mohly nÃ©st strukturu samy o sobÄ›. KaÅ¾dÃ½ den jsou nesmÃ­rnÃ¡ kvanta vÃ½poÄetnÃ­ch cyklÅ¯ zcela nesmyslnÄ› plÃ½tvÃ¡na na konverzi <em>surovÃ½ch</em> bajtÅ¯ na struktury a zase zpÄ›t. A kaÅ¾dÃ½ program to dÄ›lÃ¡ jinak, dokonce i v rÅ¯znÃ½ch verzÃ­ch. NemalÃ¡ ÄÃ¡st mÃ© prÃ¡ce jako programÃ¡tora je jen o parsovÃ¡nÃ­ a pÅ™evodech dat, jenÅ¾ kdyby mÄ›la strukturu, tak by byla upravitelnÃ¡ jednoduchou transformacÃ­. Tady vem kus stromu a pÅ™esuÅˆ ho sem. K tÃ©hle ÄÃ¡sti grafu pÅ™idej tohle, jinde nÄ›co uber.</p>
      <p id="5dd9eb48-0746-4d1b-b26a-57576aa086e2" class="">SouÄasnÃ¡ situace je analogickÃ¡ k situaci, kde kdybych posÃ­lal poÅ¡tou hrad z lega, tak bych ho rozloÅ¾il na jednotlivÃ© kostky a k balÃ­ku pÅ™ibalil referenci na nÃ¡vod, jak si hrad sloÅ¾it. PÅ™Ã­jemce by si pak nÃ¡vod musel <em>nÄ›kde</em> sehnat a hrad pracnÄ› sklÃ¡dat. Absurdita je zÅ™ejmÄ›jÅ¡Ã­, kdyÅ¾ si uvÄ›domÃ­me, Å¾e se to netÃ½kÃ¡ jen kostek lega, ale ÃºplnÄ› vÅ¡eho. I kdybych chtÄ›l nÄ›komu podat sklenici, tak bych jÃ­ podal jako hrst pÃ­sku a pÅ™Ã­jemce by si musel sklenici vyrobit sÃ¡m. Je mi jasnÃ©, Å¾e na konci se vÅ¾dy musÃ­ posÃ­lat bajty, stejnÄ› jako se musÃ­ posÃ­lat kostky lega. Ale proÄ je neposlat uÅ¾ sloÅ¾enÃ©?</p>
      <p id="522a68bc-9e5a-4f5d-9b27-cf251ee81efe" class="">Nejde jen o nesmyslnost toho vÅ¡eho. Jde o to, Å¾e zÃ¡roveÅˆ s tÃ­m je to i <em>horÅ¡Ã­</em>. HorÅ¡Ã­ pro uÅ¾ivatele, a horÅ¡Ã­ pro programÃ¡tory. Data se kterÃ½mi pracujete by mohla bÃ½t sebe-popisnÃ¡, ale nejsou. JednotlivÃ© poloÅ¾ky by mohly obsahovat datovÃ© typy, ale i dokumentaci. A nemajÃ­. ProÄ? ProtoÅ¾e je v mÃ³dÄ› mÃ­t zvlÃ¡Å¡Å¥ hromadu binÃ¡rnÃ­ch dat, a zvlÃ¡Å¡Å¥ jejich externÃ­ popis. VÃ¡Å¾nÄ› to tak chceme, vÃ¡Å¾nÄ› to mÃ¡ nÄ›jakÃ© vÃ½hody?</p>
      <p id="077c4a77-97b8-4ebf-8f84-cad0cf5e82b4" class="">V minulÃ©m desetiletÃ­ bylo moÅ¾nÃ© vidÄ›t masivnÃ­ nÃ¡rÅ¯st pouÅ¾Ã­vÃ¡nÃ­ formÃ¡tÅ¯ jako XML, JSON a YAML. UrÄitÄ› lepÅ¡Ã­ neÅ¾ drÃ¡tem do oka, ale to stÃ¡le nenÃ­ to o Äem tu mluvÃ­m. Nejde mi o konkrÃ©tnÃ­ formÃ¡t, jde mi o strukturu samotnou. ProÄ nemÃ­t strukturovanÄ› vÅ¡echna data?</p>
      <p id="dbd65f7d-d163-48f1-8501-83bd0c73e714" class="">NemluvÃ­m tady o parsovÃ¡nÃ­ XML parserem, mluvÃ­m tu o pÅ™Ã­mÃ©m naÄtenÃ­ do pamÄ›ti, ve stylu <a href="https://msgpack.org/">message packu</a>, <a href="https://github.com/real-logic/simple-binary-encoding">SBE</a>, nebo <a href="https://google.github.io/flatbuffers/">FlatBuffers</a>, Äi <a href="https://capnproto.org/">Capâ€™n Proto</a>. Bez toho aniÅ¾ by bylo tÅ™eba vyhodnocovat text a Å™eÅ¡it escape sekvence a formÃ¡t unicode. O tom Å¾e na strukturovanÃ¡ data o <em>Frantovi PutÅ¡Ã¡lkovi</em> v kolekci lidÃ­ pÅ™istoupÃ­m pomocÃ­ <code>people[0].name</code>, mÃ­sto toho abych v jednom formÃ¡tu dÄ›lal <code>doc.getElementByTagName("person")[0].name.value</code> a v druhÃ©m <code>doc["people"][0]["name"]</code>. O tom Å¾e si mÅ¯Å¾u k atributu pÅ™eÄÃ­st nÃ¡povÄ›du pouhÃ½m <code>help(people)</code>, mÃ­sto abych hledal dokumentaci.</p>
      <p id="ade204bd-6479-4393-b794-abd21b1d2e15" class="">MluvÃ­m tu o tom Å¾e se neparsuji s WAVem, ale prostÄ› iteruji pÅ™es jednotlivÃ© <em>chunky</em>, kterÃ© tam jsou. O tom Å¾e data popisujÃ­ sebe sama pÅ™Ã­mo svou strukturou, ne externÃ­m popisem. MluvÃ­m o pÅ™Ã­mÃ© serializaci objektÅ¯, o jednotnÃ©m systÃ©mu podporovanÃ©m vÅ¡emi jazyky, i kdyÅ¾ nemajÃ­ objekty.</p>
      <p id="0f68ee67-3a40-4996-9708-9ce45d88a1f3" class="">VÃ¡Å¾nÄ› by to bylo tak nemoÅ¾nÃ©? ProÄ?</p>
      <h2 id="18bd338e-ed8f-40dd-a92d-a4623eb79b77" class="">StrukturovanÃ¡ komunikace</h2>
      <p id="a2b3f13b-f85b-454e-bce7-5e7a387c4a40" class="">VÅ¡Ã­mÃ¡te si toho vzoru v mÃ© kritice, hnÄ›vu a vÃ¡Å¡ni? Je jÃ­m tÃ©ma <em>neuvÄ›domÄ›lÃ© struktury</em>.</p>
      <p id="673181fe-3c57-45ab-b653-69b7233bdc5e" class="">SouborovÃ© systÃ©my nevnÃ­mÃ¡me jako databÃ¡ze. NedochÃ¡zÃ­ nÃ¡m, Å¾e jejich struktura jsou hierarchickÃ¡ <em>key-value</em> data. Programy bereme jako binÃ¡rnÃ­ bloby, mÃ­sto klubka propojenÃ½ch funkcÃ­ a struktur a objektÅ¯ majÃ­cÃ­ch potÅ™ebu komunikovat se sebou, ale i s okolnÃ­m svÄ›tem. Data chÃ¡peme jako mrtvÃ© sÃ©rie surovÃ½ch bajtÅ¯, mÃ­sto stromovÃ½ch a grafovÃ½ch struktur.</p>
      <p id="76dadcbc-6cd4-4c72-8abd-271b0fa5f97d" class="">Co dalÅ¡Ã­ho mÃ¡ strukturu, o Äem jsem zatÃ­m nepsal? SamozÅ™ejmÄ› komunikace. S operaÄnÃ­m systÃ©mem. S programy. Mezi programy.</p>
      <h2 id="395cc842-969e-4c7e-b591-314940601a32" class="">/sys</h2>
      <p id="fd3855b2-d2ec-4d8e-9ecf-5eca4d6b013a" class=""><a href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs">Plan9</a> byl ÃºÅ¾asnÃ½m krokem tÃ­mhle smÄ›rem. PotÃ© co jsem ho prozkoumal jsem vÅ¡ak dospÄ›l k nÃ¡zoru, Å¾e tvÅ¯rci sice mÄ›li obecnÃ© povÄ›domÃ­ o tom co dÄ›lajÃ­, ale nedoÅ¡lo jim to v celÃ© Ãºplnosti. MoÅ¾nÃ¡ ÄÃ¡steÄnÄ› proto, Å¾e byli stÃ¡le hodnÄ› ovlivnÄ›ni unixem a komunikacÃ­ v proudech bajtÅ¯.</p>
      <p id="b195441a-23b8-4287-b4b7-f8b03d577d2e" class="">Na Plan9 je ÃºÅ¾asnÃ©, jak mÅ¯Å¾ete interagovat se systÃ©mem pomocÃ­ zÃ¡pisu a ÄtenÃ­ z rÅ¯znÃ½ch speciÃ¡lnÃ­ch souborÅ¯. FantastickÃ©! RevoluÄnÃ­! Tak ÃºÅ¾asnÃ©, Å¾e to linux pÅ™evzal napÅ™Ã­klad v podobÄ› <code>/sys</code> subsystÃ©mu a <a href="https://cs.wikipedia.org/wiki/Filesystem_in_Userspace">FUSE</a>.</p>
      <p id="e280df65-30ca-4d9d-a8a3-04e154966539" class="">VÃ­te co tomu chybÃ­? Reflexe a struktura dat. Pokud si nepÅ™eÄtete manuÃ¡l, tak naprosto netuÅ¡Ã­te co kam zapsat.</p>
      <p id="b8630633-ccaa-456a-991c-6a9c29919b25" class="">Zde je kÃ³d pro blikÃ¡nÃ­ diodou na raspberry pi:</p>
      <pre id="a5ef88b7-602b-4cf5-95b8-a2f269467470" class="code"><code>echo 27 &gt; /sys/class/gpio/export
echo out &gt; /sys/class/gpio/export/gpio27/direction
echo 1 &gt; /sys/class/gpio/export/gpio27/value</code></pre>
      <p id="d0ba90fe-6b4b-4b27-b244-ff713f557719" class="">Jak jsou Å™eÅ¡eny chyby? Co kdyÅ¾ do <code>/sys/class/gpio/export/gpio27/value</code> zapÃ­Å¡u string â€vÃ¡noÄkaâ€œ? Dostanu zpÄ›t error kÃ³d z echa? Nebo se v nÄ›jakÃ©m jinÃ©m souboru nÄ›co objevÃ­? Jak jsou zvlÃ¡dÃ¡ny paralelnÃ­ zÃ¡pisy? A co ÄtenÃ­, kde je popsÃ¡no co mÅ¯Å¾u dostat za hodnoty, kdyÅ¾ do <code>/sys/class/gpio/export/gpio27/direction</code> zapÃ­Å¡u <code>â€inâ€œ</code> mÃ­sto <code>â€outâ€œ</code>?</p>
      <p id="aa3c4ca0-b3f1-4316-8cca-d3ddc3da18a3" class="">ProstÄ› jak si to kterÃ½ modul udÄ›lÃ¡, tak to bude. DatovÃ© typy se neÅ™eÅ¡Ã­. PojÄme postavit komunikaci se systÃ©mem na databÃ¡zi, kterÃ¡ si neuvÄ›domuje Å¾e je databÃ¡ze!</p>
      <p id="9c22d59c-3137-4656-bd20-6e03bb948e85" class="">Tohle je asi nejvÄ›tÅ¡Ã­ neuvÄ›domÄ›lÃ¡ snaha o zavedenÃ­ Äehosi jako objektÅ¯, jakou jsem kdy vidÄ›l. Ta struktura jsou objekty. Jen ten rozdÃ­l mezi <code>sys.class.gpio.diode</code> a sloÅ¾kou na podobnÃ©m umÃ­stÄ›nÃ­ je Å¾e sloÅ¾ka je nepopsanÃ¡ <em>key-value</em> poloÅ¾ka, podobnÄ› jako JSON, kterÃ¡ nemÃ¡ jasnÄ› danÃ© properties, formÃ¡t dat, nÃ¡povÄ›du, nebo tÅ™eba formÃ¡t a zpÅ¯sob vyvolÃ¡vÃ¡nÃ­ vÃ½jimek.</p>
      <h2 id="95b7b52c-146c-4e99-8e53-0e120c1aeeb4" class="">Sockety</h2>
      <p id="f7dea464-97a7-4e04-a419-d3febdaf99a5" class="">JÃ¡ chÃ¡pu, proÄ vznikly. VÃ¡Å¾nÄ›. Ve svÃ© dobÄ› to bylo naprosto racionÃ¡lnÃ­ a nebylo nic lepÅ¡Ã­ho. Ale proÄ proboha pouÅ¾Ã­vat nestrukturovanÃ½ formÃ¡t pÅ™enosu binÃ¡rnÃ­ch dat i dneska, kdyÅ¾ veÅ¡kerÃ¡ komunikace je strukturovanÃ¡, coÅ¾ platÃ­ i pro zdÃ¡nlivÃ© proudy bajtÅ¯, jako streamovanÃ© audio.</p>
      <p id="3c7399e9-a345-431b-b863-7f6ad846523d" class="">Vemte si, jak to vypadÃ¡, kdyÅ¾ pÃ­Å¡ete IRC bota. NavÃ¡Å¾ete spojenÃ­. Super. SamozÅ™ejmÄ› pouÅ¾ijete <code>select</code>, aby jste nevytÄ›Å¾ovali procesor. Data Ätete v blocÃ­ch, napÅ™Ã­klad 4096 bajtÅ¯. V pamÄ›ti je pÅ™evÃ¡dÃ­te na stringy a hledÃ¡te v nich novÃ© â€<code>\r\nâ€œ</code>. MusÃ­te bufferovat a zpracovÃ¡vat Å™Ã¡dky vÅ¾dy aÅ¾ kdyÅ¾ dorazÃ­ celÃ©. Pak parsujete textovou strukturu a sklÃ¡dÃ¡te z nÃ­ zprÃ¡vy o jednom Å™Ã¡dku. A rÅ¯znÃ© zprÃ¡vy majÃ­ rÅ¯znÃ© formÃ¡ty a je tÅ™eba je parsovat rÅ¯znÄ›. HroznÃ¡ zÃ¡bava s reimplementacÃ­ <a href="https://tools.ietf.org/html/rfc1459">specifikace</a> po miliontÃ© jinak. PÅ™itom zprÃ¡vy by mohly mÃ­t strukturu samy o sobÄ›, stejnou jako zbytek vÅ¡eho ostatnÃ­ho.</p>
      <p id="1a6e2ca2-c871-43ba-a6af-ad901d218e97" class="">Nebo tÅ™eba HTTP. To pÅ™ece pÅ™enÃ¡Å¡Ã­ strukturovanÃ¡ HTML data, ne? MÃ¡te jasnÄ› danÃ½ jazyk a jeho popis a zpÅ¯sob parsovÃ¡nÃ­. Super! Co vÃ­c si pÅ™Ã¡t. MyslÃ­te ale, Å¾e HTTP pouÅ¾Ã­vÃ¡ na Ãºrovni pÅ™enosovÃ©ho protokolu jako datovÃ½ formÃ¡t (HT/X)ML? Ani nÃ¡hodou, samozÅ™ejmÄ›, Å¾e si specifikuje vlastnÃ­ protokol, kterÃ½ <a href="https://cs.wikipedia.org/wiki/Hypertext_Transfer_Protocol">vypadÃ¡</a> ÃºplnÄ› jinak (<em>key-value</em> data hlaviÄek a pak zpÅ¯sob posÃ­lÃ¡nÃ­ <em>chunkÅ¯</em> dat).</p>
      <p id="a66c4d90-504b-4667-a860-dc030271075a" class="">Email? Ani mÄ› nenechte zaÄÃ­t na tÃ©ma zkaÅ¾enosti emailu, jeho protokolu a formÃ¡tu, kde se nejasnÄ› definovanÃ¡ struktura v asi pÄ›ti standardech mÃ­sÃ­ mezi sebou a kaÅ¾dÃ½ vÃ½robce si to implementuje po svÃ©m. Pokud jste nÄ›kdy zkouÅ¡eli zpracovÃ¡vat emailovÃ© hlaviÄky z nÄ›jakÃ© konference, tak urÄitÄ› vÃ­te. Pokud ne, zkuste si to. Garantuji, Å¾e vÃ¡m to zmÄ›nÃ­ pohled na svÄ›t.</p>
      <p id="35bfb443-7769-4032-bf19-5b6418b963ac" class="">A tak je to se vÅ¡Ã­m. Skoro nikdy nepotÅ™ebujete proud bajtÅ¯, ale posÃ­lat zprÃ¡vy, kterÃ© jsou prakticky vÅ¾dy hierarchie <em>key-val</em> dat, nebo pole. ProÄ tedy skoro 50 let po vynÃ¡lezu socketu stÃ¡le pÅ™enÃ¡Å¡Ã­me data ve streamech a neustÃ¡le si vymÃ½Å¡lÃ­me vlastnÃ­ textovÃ© protokoly? NenÃ­ Äas na nÄ›co lepÅ¡Ã­ho?</p>
      <p id="2a71989c-9c19-4460-b356-60ecbe8c81df" class="">VytvoÅ™Ã­me strukturu tady, pak jÃ­ serializujeme na surovÃ© bajty, nacpeme do socketu a poÅ¡leme systÃ©mu, kterÃ½ musÃ­ provÃ©st deserializaci a rekonstrukci na zÃ¡kladÄ› externÃ­ho popisu dat, kterÃ½ je s trochou Å¡tÄ›stÃ­ podobnÃ½ tomu naÅ¡emu. ProÄ? ProÄ neposÃ­lat rovnou struktury?</p>
      <p id="17294a3a-2797-453f-b868-ddd5983bc458" class=""><a href="https://en.wikipedia.org/wiki/ZeroMQ">ZeroMQ</a> byla podle mÃ©ho nÃ¡zoru krok sprÃ¡vnÃ½m smÄ›rem, ale zatÃ­m mi pÅ™ijde, Å¾e se nedoÄkala moc vÅ™elÃ©ho pÅ™ijetÃ­.</p>
      <h2 id="8ba0a8da-0173-41f8-a5b5-0c31c15a5538" class="">Parametry pÅ™Ã­kazovÃ© Å™Ã¡dky</h2>
      <p id="876ef2e0-7ef3-44d8-84f9-38db45225510" class="">MÃ¡te program na disku, kterÃ½ nÄ›co dÄ›lÃ¡. KdyÅ¾ vynechÃ¡m kliknutÃ­ a nÃ¡slednÃ© â€ruÄnÃ­â€œ zadÃ¡nÃ­ dat, tak argumenty pÅ™Ã­kazovÃ© Å™Ã¡dky jsou jeden z nejÄastÄ›jÅ¡Ã­ch zpÅ¯sobÅ¯, jak programu Å™Ã­ct, co po nÄ›m chcete. A kaÅ¾dÃ½ druhÃ½ program si je parsuje vlastnÃ­m zpÅ¯sobem.</p>
      <p id="56df36f1-76c6-4b59-8e41-7911eafe6279" class="">ReÃ¡lnÄ› neexistuje Å¾Ã¡dnÃ½ standard formÃ¡tu argumentÅ¯ na pÅ™Ã­kazovÃ© Å™Ã¡dce. NÄ›kterÃ© programy pouÅ¾Ã­vajÃ­ <code>--param</code>. JinÃ© <code>-param</code>. DalÅ¡Ã­ jen <code>param</code>. NÄ›kdy se seznamy oddÄ›lujÃ­ mezerami, jindy ÄÃ¡rkami. UÅ¾ jsem dokonce zaÅ¾il i JSON parametry mixovanÃ© s tÄ›mi normÃ¡lnÃ­mi.</p>
      <p id="dd348a21-faac-4c78-80c9-e7efc81dedae" class="">Pokud program volÃ¡te z nÄ›jakÃ©ho pÅ™Ã­kazovÃ©ho Å™Ã¡dku, tak se vÃ¡m do toho navÃ­c mixuje jeho scriptovacÃ­ jazyk a jeho zpÅ¯sob definice stringÅ¯, promÄ›nnÃ½ch a bÅ¯h vÃ­ Äeho dalÅ¡Ã­ho (z hlavy mÄ› napadajÃ­ escape sekvence, jmÃ©na funkcÃ­, eval sekvence, wildcards znaky, <code>--</code> pro ukonÄenÃ­ wildcardÅ¯ a tak podobnÄ›). CelÃ© je to jeden velkÃ½, gigantickÃ½ bordel, kterÃ½ si kaÅ¾dÃ½ patlÃ¡ a parsuje, jak se mu zrovna chce.</p>
      <p id="ccab9253-900f-4bf6-a672-b53af4eab8d3" class="">A co volÃ¡nÃ­ ostatnÃ­ch programÅ¯ z <em>jinÃ½ch programÅ¯</em>? Ani nechci vzpomÃ­nat, kolikrÃ¡t jsem vidÄ›l, Äi psal kÃ³d ve stylu:</p>
      <pre id="056d636d-391c-4bba-801f-110b77b863a5" class="code"><code>import subprocess

sp = subprocess.Popen(
  ['7z', 'a', 'Test.7z', 'Test', '-mx9'],
  stderr=subprocess.STDOUT,
  stdout=subprocess.PIPE
)
stdout, stderr = sp.communicate()</code></pre>
      <p id="78c5403e-984a-4a0b-8dfc-6075db67e1c5" class="">Naposledy nedÃ¡vno, i s celou plejÃ¡dou parsovÃ¡nÃ­ free-form vÃ½stupu. A uÅ¾ mÄ› to vÃ¡Å¾nÄ› nebavÃ­.</p>
      <p id="a7603159-d3cc-4326-a7ab-1c9c0f88e79d" class="">Pokud jsou argumenty sloÅ¾itÄ›jÅ¡Ã­, stane se z toho rychle onanie sklÃ¡dÃ¡nÃ­ stringÅ¯, kde si navÃ­c nemÅ¯Å¾ete bÃ½t jisti bezpeÄnostÃ­, nemÃ¡te garanci podporovanÃ© znakovÃ© sady, musÃ­te sanitizovat uÅ¾ivatelskÃ½ vstup a volanÃ© podprogramy navÃ­c stÃ¡le mÅ¯Å¾ou vykazovat chovÃ¡nÃ­, kterÃ© je vÅ¡echno, jen ne triviÃ¡lnÃ­. NapÅ™Ã­klad vÃ¡m <a href="https://thraxil.org/users/anders/posts/2008/03/13/Subprocess-Hanging-PIPE-is-your-enemy/">zatuhne buffer</a> pÅ™i vÄ›tÅ¡Ã­m vÃ½stupu. Nebo program reaguje jinak v neinteraktivnÃ­m reÅ¾imu, neÅ¾ v interaktivnÃ­m a nenÃ­ Å¾Ã¡dnÃ½ zpÅ¯sob, jak ho pÅ™esvÄ›dÄit o opaku. PÅ™Ã­padnÄ› vÃ¡m cpe escape sekvence a <code>tty</code> formÃ¡tovÃ¡nÃ­, kam by jste nechtÄ›li. A jak asi pÅ™enesete strukturovanÃ¡ data tam a zpÄ›t?</p>
      <p id="7b442dbe-f15e-4149-b2e6-b4dcc5d518d5" class="">PÅ™itom parametry pÅ™Ã­kazovÃ© Å™Ã¡dky jsou vÄ›tÅ¡inou nÄ›jakÃ½m seznamem, nebo slovnÃ­kem s vnoÅ™enÃ½mi strukturami. Chce to jednotnÃ½ a na zÃ¡pis jednoduchÃ½ jazyk. NÄ›co lehÄÃ­ho na zÃ¡pis, neÅ¾ JSON, ale zÃ¡roveÅˆ vÃ­c expresivnÃ­ho.</p>
      <p id="75050485-f595-4240-8e51-af502fa4d6ec" class="">ÃšplnÄ› pak vynechÃ¡vÃ¡m, Å¾e nutnost parametrÅ¯ pÅ™Ã­kazovÃ© Å™Ã¡dky se ÃºplnÄ› vytratÃ­, kdyÅ¾ mÅ¯Å¾ete posÃ­lat programu strukturovanÃ© zprÃ¡vy podobnÄ› jako volat funkci v programovacÃ­m jazyku. VÅ¾dyÅ¥ nejde o nic jinÃ©ho, neÅ¾ o zavolÃ¡nÃ­ patÅ™iÄnÃ© funkce / metody s konkrÃ©tnÃ­mi parametry, tak proÄ to dÄ›lat takhle divnÄ› a nepÅ™Ã­mo?</p>
      <h2 id="df47658d-13ac-4c15-8f53-3e387c471903" class="">Env promÄ›nnÃ©</h2>
      <p id="d85b942d-5d40-40db-90a3-5c54ac476cfc" class=""><em>Env</em> promÄ›nnÃ© jsou slovnÃ­k. Doslova se tak mapujÃ­ a chovajÃ­. JenÅ¾e dÃ­ky <em>chybÄ›jÃ­cÃ­ struktuÅ™e</em> jsou jen jednorozmÄ›rnÃ½m slovnÃ­kem s klÃ­Äi a hodnotami v podobÄ› stringÅ¯. V D by se zapsaly jako <code>string[string] env;</code>. To Äasto nestaÄÃ­, protoÅ¾e potÅ™ebujete pÅ™enÃ©st vnoÅ™enÃ© struktury.</p>
      <p id="0d06065a-e64f-43d3-a68c-55c4c0ce8d1e" class="">MÃ¡ duÅ¡e kÅ™iÄÃ­, terorizovÃ¡na hlÃ¡Å¡kami jako â€<em>potÅ™ebujeÅ¡ pÅ™edat sloÅ¾itÄ›jÅ¡Ã­ data do</em> <code>env</code> <em>promÄ›nnÃ©? tak tam zapiÅ¡ JSON, nebo odkaz na soubor!</em>â€œ ProÄ proboha jako civilizace nezvlÃ¡dneme jednotnÃ½ zpÅ¯sob pÅ™edÃ¡vÃ¡nÃ­ a uklÃ¡dÃ¡nÃ­ dat, Å¾e musÃ­me mÃ­chat syntaxi <code>env</code> promÄ›nnÃ½ch v bashi s JSONem?</p>
      <h2 id="c2f9c5b8-3af2-4592-aaa8-2188aa62725c" class="">KonfiguraÄnÃ­ soubory</h2>
      <p id="31c3e76d-d622-4a87-9663-95a282ee4b81" class="">AÅ¥ uÅ¾ si to uvÄ›domujete, nebo ne, prakticky kaÅ¾dÃ½ netriviÃ¡lnÃ­ program ve vaÅ¡em poÄÃ­taÄi potÅ™ebuje nÄ›jakou konfiguraci. Tu si zpravidla bere z konfiguraÄnÃ­ho souboru. VÃ­te, kde je ten soubor umÃ­stÄ›nÃ½? V Linuxu bÃ½vÃ¡ standardem je umisÅ¥ovat do <code>/etc</code>, ale klidnÄ› mÅ¯Å¾ou bÃ½t taky ve vaÅ¡em <code>$HOME</code>, nebo v <code>$HOME/.config</code>, nebo v libovolnÃ© podsloÅ¾ce (tÅ™eba <code>$HOME/.thunderbird/</code>).</p>
      <p id="a6459b8f-651f-4f8f-a6fa-7a4c4746158e" class="">A co formÃ¡t? HÃ¡dÃ¡te sprÃ¡vnÄ›. MÅ¯Å¾e bÃ½t libovolnÃ½; <em>(pseudo)</em>INI, XML, JSON, YAML. Nebo Lua. Nebo taky hybrid vlastnÃ­ho programovacÃ­ho jazyka (viz postfix). Co koho zrovna napadne, to se pouÅ¾Ã­vÃ¡.</p>
      <p id="a4b6d487-eb96-4cca-9808-97a7451095cb" class="">Existuje vtip, Å¾e komplexita kaÅ¾dÃ©ho konfiguraÄnÃ­ho souborÅ¯ s Äasem roste, dokud v nÄ›m nÄ›kdo vytvoÅ™Ã­ Å¡patnÄ› implementovanou pÅ¯lku lispu. MÃ½m oblÃ­benÃ½m pÅ™Ã­kladem je <a href="https://www.ansible.com/">Ansible</a> a jeho nedotaÅ¾enÃ¡, nekompletnÃ­ parodie na <a href="http://docs.ansible.com/ansible/latest/playbooks_conditionals.html">programovacÃ­ jazyk postavenÃ½ nad YAMLem</a>.</p>
      <p id="0add76b8-b9c4-42b7-afc6-ce60379e6240" class="">ChÃ¡pu, kde se to bere. Taky jsem touhle cestou Å¡el. ProÄ to ale nemÅ¯Å¾e bÃ½t standardizovanÃ© a stejnÃ© napÅ™Ã­Ä celÃ½m systÃ©mem? IdeÃ¡lnÄ› ten samÃ½ datovÃ½ formÃ¡t, kterÃ½ je zÃ¡roveÅˆ jazykem, napÅ™Ã­Ä vÅ¡Ã­m. ProÄ nemÅ¯Å¾ou bÃ½t konfiguracÃ­ samotnÃ© objekty uloÅ¾enÃ© v patÅ™iÄnÃ©m umÃ­stÄ›nÃ­?</p>
      <h2 id="5f512a7e-5d07-4acc-8cfe-786f846de856" class="">Logy</h2>
      <p id="d1253cb7-362d-4b72-9812-b278fddd7b91" class="">U logovÃ¡nÃ­ je typicky nutno Å™eÅ¡it nÃ¡sledujÃ­cÃ­ problÃ©my:</p>
      <ol id="a939be18-0bbc-4908-9830-43cb18a5a509" class="numbered-list" start="1">
        <li>StrukturovanÃ© logovÃ¡nÃ­. UklÃ¡dÃ¡nÃ­ ve formÃ¡tu, jenÅ¾ je moÅ¾nÃ© nÃ¡slednÄ› zpracovÃ¡vat, provÃ¡dÄ›t nad nÃ­m dotazy a tak podobnÄ›.</li>
      </ol>
      <ol id="29d28618-d717-4c08-9beb-82e5bd88216e" class="numbered-list" start="2">
        <li>ParalelnÃ­ pÅ™Ã­stup, aby mohlo logovat vÃ­cero aplikacÃ­ do jednoho logu a jednotlivÃ© zÃ¡znamy se â€nekÅ™Ã­Å¾ilyâ€œ.</li>
      </ol>
      <ol id="070fcb27-88d8-4442-baa3-68b5afb4b281" class="numbered-list" start="3">
        <li>RotovÃ¡nÃ­ logÅ¯. StarÃ© logy se postupnÄ› pÅ™ejmenovÃ¡vÃ¡vajÃ­, jsou komprimovÃ¡ny a po Äase ÃºplnÄ› smazÃ¡ny.</li>
      </ol>
      <ol id="99b6a242-d43b-453b-8bee-8eef0b8e5c7b" class="numbered-list" start="4">
        <li>ZpÅ¯sob logovÃ¡nÃ­. Aplikace musÃ­ logy nÄ›jak dopravit do cÃ­lovÃ©ho ÃºloÅ¾iÅ¡tÄ›.</li>
      </ol>
      <p id="e80f15c2-0dc1-4e4d-a4a6-432da386a016" class="">SouÄasnÃ¡ Å™eÅ¡enÃ­ jsou opÄ›t typicky zcela rÅ¯znÃ¡, tak jak koho zrovna co napadlo:</p>
      <ol id="f40a947f-8d21-4d33-93ac-9f9b52d89562" class="numbered-list" start="1">
        <li>Struktura logÅ¯ je nahodilÃ¡. Prakticky vÅ¡ichni pouÅ¾Ã­vajÃ­ nÄ›jakÃ½ vÃ­ce/mÃ©nÄ› parsovatelnÃ½ formÃ¡t, ale jeho tvar je Äasto rÅ¯znÃ½. MÃ¡lokdy je definovÃ¡no napÅ™Ã­klad jak jsou uloÅ¾eny a â€escapovÃ¡nyâ€œ vÃ­ceÅ™Ã¡dkovÃ© logy. ParsovÃ¡nÃ­ probÃ­hÃ¡ ve velkÃ© ÄÃ¡sti pÅ™es regexpy a prakticky vÅ¾dy je kÅ™ehkÃ© a rozbitelnÃ©. S urÄitou pÃ½chou vÅ¾dy ukazuji kolegÅ¯m Å¾e jejich logy dokÃ¡Å¾u rozbÃ­t obejitÃ­m jejich regexpu a snaÅ¾Ã­m se je pÅ™esvÄ›dÄit o pouÅ¾itÃ­ nÄ›Äeho nerozbitnÃ©ho.</li>
      </ol>
      <ol id="4608d3e3-5f06-4a3b-b1ae-eeaba021c4f5" class="numbered-list" start="2">
        <li>ParalelnÃ­ logovÃ¡nÃ­ je Å™eÅ¡eno separÃ¡tnÃ­ logovacÃ­ aplikacÃ­. FilesystÃ©m, na rozdÃ­l od vÄ›tÅ¡iny ostatnÃ­ch databÃ¡zÃ­, neumÃ­ atomickÃ½ pÅ™Ã­stup, ani nic jako triggery, takÅ¾e pokud tahle aplikace spadne, je po lozÃ­ch.</li>
      </ol>
      <ol id="a75c7eb9-5c6a-4eff-8829-209ff6cc684f" class="numbered-list" start="3">
        <li>RotovÃ¡nÃ­ je takÃ© Å™eÅ¡eno externÃ­ aplikacÃ­, a prakticky vÅ¾dycky se jednÃ¡ o zÃ¡leÅ¾itost periodicky pouÅ¡tÄ›nou <em>cronem</em>. JeÅ¡tÄ› jsem nevidÄ›l chytrÃ© logovÃ¡nÃ­, kterÃ© by zvlÃ¡dlo odrotovat log, kdyÅ¾ hrozÃ­, Å¾e na disku kvÅ¯li nÄ›mu nezbude mÃ­sto, zato jsem vidÄ›l pÃ¡r sluÅ¾eb v produkci, jenÅ¾ to poloÅ¾ilo. DalÅ¡Ã­ problÃ©m je, Å¾e aplikace typicky majÃ­ otevÅ™enÃ½ soubor s logem a pokud je jim â€odrotovÃ¡nâ€œ pod rukama, tak se to celÃ© rozbije. Å˜eÅ¡Ã­ se to naprosto ne-elegantnÄ› posÃ­lÃ¡nÃ­m signÃ¡lÅ¯, na kterÃ© musÃ­ umÄ›t asynchronnÄ› reagovat. NedÃ¡vno jsem se hroznÄ› vysmÃ¡l, kdyÅ¾ kolega chtÄ›l logovat jen na <em>stdout</em> a tak zmÄ›nil cestu k souborovÃ©mu logu na <code>/dev/null</code>. CelÃ© to krÃ¡snÄ› fungovalo jen do tÃ© doby, neÅ¾ se pythonnÃ­ <a href="https://docs.python.org/3/library/logging.handlers.html#rotatingfilehandler">RotatingFileHandler</a> rozhodl soubor odrotovat a celÃ¡ aplikace spadla.
        </li>
      </ol>
      <ol id="76e7327c-75e0-421d-a1f7-8479b9640d8c" class="numbered-list" start="4">
        <li>Co se zpÅ¯sobu tÃ½Äe, tak nÄ›kterÃ© aplikace prostÄ› otevÅ™ou soubor a logujÃ­ do nÄ›j. JinÃ© posÃ­lajÃ­ data na UDP (syslog). DalÅ¡Ã­ zas posÃ­lajÃ­ zprÃ¡vy v JSONu do Sentry. Co koho napadne a co je zrovna populÃ¡rnÃ­, tak to bude.</li>
      </ol>
      <p id="a159816a-ec9c-4ff7-a1b3-a7150b9acab2" class="">LogovÃ¡nÃ­ mi pÅ™ijde jako krÃ¡snÃ¡ ukÃ¡zka programÃ¡torskÃ© struktury, kterou je nucen Å™eÅ¡it prakticky kaÅ¾dÃ½ a kterou operaÄnÃ­ systÃ©m v celÃ© komplexitÄ› podporuje skoro vÅ¯bec, nebo jen mÃ¡lo. Je to takÃ© krÃ¡snÃ¡ ukÃ¡zka konceptu, kterÃ½ by si zaslouÅ¾il pÅ™evÃ©st na posÃ­lÃ¡nÃ­ strukturovanÃ½ch zprÃ¡v;</p>
      <p id="973f1f97-27f9-4d4f-9883-93759a96d4d0" class="">ZprÃ¡vy jsou objeky. MajÃ­ svÃ© datum odeslÃ¡nÃ­, majÃ­ krÃ¡tkÃ½ text a vÄ›tÅ¡inou i dlouhÃ½ text a takÃ© â€ÃºroveÅˆâ€œ (v pythonu typicky <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>). Pokud s logy pracujete, skoro nikdy nechcete pracovat na Ãºrovni textu. Chcete napÅ™Ã­klad omezit datum - jak to udÄ›lÃ¡te, kdyÅ¾ se jednÃ¡ o text? Nebo ÃºroveÅˆ - pokud chcete vÅ¡echny zprÃ¡vy ÃºrovnÄ› <code>ERROR</code>, nechcete to <em>grepovat</em> textovÄ›, protoÅ¾e slovo â€ERRORâ€œ mÅ¯Å¾e bÃ½t pouÅ¾ito i v tÄ›lÄ› zprÃ¡vy v rÅ¯znÃ½ch kontextech. NapÅ™Ã­klad â€NO_ERRORâ€œ.</p>
      <p id="f5b18444-a334-4164-a54f-35777afcd97b" class="">Aplikace, do kterÃ© se loguje by mÄ›la pÅ™ijÃ­mat zprÃ¡vy, kterÃ© bude uchovÃ¡vat v datovÃ© struktuÅ™e <a href="https://cs.wikipedia.org/wiki/Fronta_(datov%C3%A1_struktura)">fronta</a>. TÃ­m by nikdy nemohlo dojÃ­t mÃ­sto na disku. StarÅ¡Ã­ struktury by bylo moÅ¾nÃ© automaticky komprimovat, ale pro uÅ¾ivatele by to mÄ›lo bÃ½t transparentnÃ­ - pokud chce vyhledÃ¡vat nad komprimovanÃ½mi zprÃ¡vami, ani by o tom nemÄ›l vÄ›dÄ›t.</p>
      <p id="d2f9446d-e771-44b2-9424-1790cedb6b38" class="">NemÄ›lo by existovat padesÃ¡t zpÅ¯sobÅ¯ logovÃ¡nÃ­ - pro uÅ¾ivatele by to mÄ›la bÃ½t zÃ¡leÅ¾itost instancovÃ¡nÃ­ systÃ©movÃ©ho loggeru a jeho nÃ¡slednÃ© pouÅ¾Ã­vÃ¡nÃ­, po krÃ¡tkÃ© konfiguraci, kde si zvolÃ­ politiku rotace. Pak uÅ¾ jen loguje standardnÃ­m poslÃ¡nÃ­m zprÃ¡vy, aÅ¥ uÅ¾ lokÃ¡lnÄ›, nebo vzdÃ¡lenÄ› z internetu.</p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-8322439660353685" data-ad-slot="8927869381"></ins> 
      <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <h1 id="9f98a34d-96de-4009-a1b3-575caabb3fe6" class="">UkÃ¡zkovÃ¡ studie: Docker</h1>
      <p id="4e414c48-a135-46bc-855d-ab591b696f0e" class=""><a href="https://en.wikipedia.org/wiki/Docker_(software)">Docker</a> je virtualizaÄnÃ­ nÃ¡stroj umoÅ¾ÅˆujÃ­cÃ­ vÃ¡m sestavovat, spravovat a spouÅ¡tÄ›t kontejnery virtuÃ¡lnÃ­ch poÄÃ­taÄÅ¯, ve kterÃ½ch je specifickÃ© programovÃ© vybavenÃ­.</p>
      <p id="0e849bae-170e-4b38-b326-184d03329df2" class="">OsobnÄ› mÃ¡m Docker docela rÃ¡d a obÄas ho pouÅ¾Ã­vÃ¡m k sestavovÃ¡nÃ­ balÃ­ÄkÅ¯ pro cÃ­lovÃ© distribuce (napÅ™Ã­klad <code>.deb</code> pro Debian a <code>.rpm</code> pro RHEL).</p>
      <p id="8b7b3eb5-eddd-4d84-8e69-1c349f87475c" class="">ParametrÅ¯ Dockeru je nepÅ™ebernÄ›: <a href="https://docs.docker.com/engine/reference/run/">https://docs.docker.com/engine/reference/run/</a>. MojÃ­ oblÃ­benou ÄÃ¡stÃ­ jsou volumes, tedy sloÅ¾ky, jenÅ¾ jsou mountovÃ¡ny dovnitÅ™ kontejneru z vnÄ›jÅ¡Ã­ho hosta.</p>
      <p id="e47a4f81-a1df-4bc0-bce9-b2ef592ee6af" class="">Syntaxe je pÅ™ibliÅ¾nÄ› <code>-v local_path:/docs:rw</code>. Jako dobrÃ¡ ukÃ¡zka mi to pÅ™ijde, protoÅ¾e se do jednoho parametru cpou tÅ™i rÅ¯znÃ© hodnoty: cesta v poÄÃ­taÄi na kterÃ©m pÅ™Ã­kaz pouÅ¡tÃ­te (kterÃ¡ navÃ­c musÃ­ bÃ½t absolutnÃ­!), cesta uvnitÅ™ kontejneru (kterÃ¡ navÃ­c musÃ­ bÃ½t v <code>Dockerfile</code> oznaÄenÃ¡ pomocÃ­ <code>VOLUME</code>) a prÃ¡va k zÃ¡pisu.</p>
      <p id="36f24185-65d9-449b-806c-5e5b93a683ab" class="">K naprostÃ© dokonalosti to bylo dovedeno <a href="https://docs.docker.com/storage/volumes">novÃ½m</a> parametrem <code>--mount</code>, kterÃ½ dÄ›lÃ¡ to samÃ©, ale zavÃ¡dÃ­ pro to ÃºplnÄ› novou syntaxi, jenÅ¾ pÅ™inÃ¡Å¡Ã­ ÃºplnÄ› jinÃ¡ pravidla parsovÃ¡nÃ­:</p>
      <pre id="f9414646-6932-412a-bf69-68b9761536b7" class="code"><code>--mount source=local_path,target=/docs</code></pre>
      <p id="7e4ad365-23bd-4b37-ad08-3f02415695d1" class="">KomplexnÄ›jÅ¡Ã­ ukÃ¡zka mÅ¯Å¾e vypadat napÅ™Ã­klad takto:</p>
      <pre id="ef2b3cea-bc5f-4c70-ba0d-0bb91c95f3f7" class="code"><code>--mount 'type=volume,src=&lt;VOLUME-NAME&gt;,dst=&lt;CONTAINER-PATH&gt;,volume-driver=local,volume-opt=type=nfs,volume-opt=device=&lt;nfs-server&gt;:&lt;nfs-path&gt;,"volume-opt=o=addr=&lt;nfs-address&gt;,vers=4,soft,timeo=180,bg,tcp,rw"'</code></pre>
      <p id="f28a5e6a-ca04-4465-aab6-48030692e9b9" class="">a zahrnuje ukÃ¡zky escapovÃ¡nÃ­ CSV parseru (!).</p>
      <p id="8415b297-4c3a-4df1-a99b-59d71a63e032" class="">Z hodnot oddÄ›lenÃ½ch dvojteÄkami se stÃ¡vÃ¡ ÃºplnÄ› novÃ½ formÃ¡t hodnot oddÄ›lenÃ½ch ÄÃ¡rkami, definujÃ­cÃ­ key-value hodnoty pomocÃ­ <em>rovnÃ­tka</em> (=), ale zÃ¡roveÅˆ hodnoty jako list, protoÅ¾e mÃ­sty tam Å¾Ã¡dnÃ© <em>rovnÃ­tko</em> nenÃ­, a je moÅ¾nÃ© pouÅ¾Ã­vat uvozovky a celkovÄ› .. co to sakra je?</p>
      <p id="a22280f3-e82a-4022-ac1d-7b22ec3a4972" class="">To ani nemluvÃ­m o tom jak se rÅ¯znÄ› chovÃ¡nÃ­ mÄ›nÃ­, podle toho co zrovna pouÅ¾ijete, protoÅ¾e to nenÃ­ pÅ™edmÄ›tem diskuze.</p>
      <p id="17251893-b5a5-42cd-8d03-e80d2d36866f" class="">Pointou je, Å¾e mÃ­sto aby se jednalo o nÄ›jak jasnÄ› definovanÃ½ objekt, kterÃ©mu mÅ¯Å¾ete poslat zprÃ¡vu, tak je to systÃ©m hned nÄ›kolika konvencÃ­ sklÃ¡dÃ¡nÃ­ stringÅ¯ na pÅ™Ã­kazovÃ© Å™Ã¡dce, kterÃ½ je peklo snaÅ¾it se nÄ›jak obalit do vaÅ¡eho programu, protoÅ¾e se chovÃ¡ nekonzistentnÄ› a nepÅ™edvÃ­datelnÄ›.</p>
      <p id="1daa0fd1-6d64-4c02-8ba0-6ef67f9ff14a" class="">A to nenÃ­ vÅ¡echno, poÅ™Ã¡d je tady jeÅ¡tÄ› Dockerfile, protoÅ¾e to je samozÅ™ejmÄ› dalÅ¡Ã­ se vÅ¡Ã­m ostatnÃ­m nekompatibilnÃ­ formÃ¡t bez debuggeru a jasnÃ© vize a logiky.</p>
      <h2 id="25a6e9bd-90a4-46b5-bf9b-4332162dc12c" class="">Dockerfile</h2>
      <p id="8093b101-03c8-4c6a-9083-1147c8d9660c" class="">PÅ¯vodnÃ­ myÅ¡lenka Dockerfile byla hÃ¡dÃ¡m podobnÃ¡, jako u makefile. PustÃ­me na to docker a on provede jednotlivÃ© direktivy krok za krokem a sestavÃ­ nÃ¡m â€projektâ€œ.</p>
      <p id="aff4d917-c9a7-41cd-bc41-047409be979f" class="">PÅ¯vodnÃ­ idea byla jednoduchÃ¡ - prostÄ› soubor <code>KEY value</code> definic, kterÃ© se budou postupnÄ› vykonÃ¡vat. MÅ¯Å¾e to vypadat napÅ™Ã­klad takto:</p>
      <pre id="d0b63989-482f-4272-bd7d-d20e2465c1f1" class="code"><code>FROM microsoft/nanoserver
COPY testfile.txt c:\\
RUN dir c:\</code></pre>
      <p id="48422307-25c1-4679-99ad-95014e24c1bf" class="">FROM urÄuje co se mÃ¡ pouÅ¾Ã­t za pÅ¯vodnÃ­ kontejner, ze kterÃ©ho se bude vychÃ¡zet, COPY zkopÃ­ruje soubor z poÄÃ­taÄe, na kterÃ©m je kontejner sestavovÃ¡n a RUN provede nÄ›jakÃ½ pÅ™Ã­kaz.</p>
      <p id="9ba0b759-ace9-4d54-be09-8dc29a86dfc7" class="">KaÅ¾dÃ½ kdo znÃ¡ <a href="https://en.wikipedia.org/wiki/Greenspun%27s_tenth_rule">Greenspunovo desÃ¡tÃ© pravidlo</a> asi tuÅ¡Ã­, jak se to vyvÃ­jelo dÃ¡l. PÅ™iÅ¡la definice ENV promÄ›nnÃ½ch a jejich nahrazovÃ¡nÃ­ pomocÃ­ Å¡ablonovÃ¡nÃ­. Definice escape znakÅ¯, <code>.dockerignore</code> soubor. PÅ™Ã­kazy jako tÅ™eba CMD zÃ­skaly alternativnÃ­ syntaxi, takÅ¾e to nemusÃ­ bÃ½t jen <code>CMD program parametr</code>, ale i <code>CMD ["program", "parametr"]</code>.</p>
      <p id="55c98cb2-c925-4940-bda2-fbcff7d36ac0" class="">VÄ›ci jako LABEL umoÅ¾nily definovat dalÅ¡Ã­ <code>key=value</code> struktury. SamozÅ™ejmÄ›, SAMOZÅ˜EJMÄš, Å¾e nÄ›kdo potÅ™eboval podmÃ­nÄ›nÃ½ build, tak vznikly hacky jak ho obejÃ­t pÅ™es templatovÃ¡nÃ­ a nastavovÃ¡nÃ­ key value hodnot z vnÄ›jÅ¡ku: <a href="https://stackoverflow.com/questions/37057468/conditional-env-in-dockerfile">https://stackoverflow.com/questions/37057468/conditional-env-in-dockerfile</a></p>
      <p id="4aa90a0c-4b91-40ca-9c85-1ac320b73a92" class="">Je jen otÃ¡zkou Äasu, neÅ¾ tam nÄ›kdo pÅ™idÃ¡ plnohodnotnÃ© podmÃ­nky a funkce a udÄ›lÃ¡ z toho svÅ¯j vlastnÃ­ zprasenÃ½ programovacÃ­ jazyk. Bez debuggeru, bez profileru, bez pÄ›knÃ½ch tracebackÅ¯.</p>
      <p id="42d6e1ad-a732-4b34-83fb-5ae9fdc9aab7" class="">ProÄ? ProtoÅ¾e neexistuje Å¾Ã¡dnÃ½ standard a operaÄnÃ­ systÃ©m neposkytuje nic po Äem by se dalo sÃ¡hnout. Fragmentace tak pokraÄuje.</p>
      <h1 id="43e02ae6-a57b-493a-8c0d-4667276f819a" class="">UkÃ¡zkovÃ¡ studie: OpenShift</h1>
      <p id="3aabd673-40e8-4541-9b8b-1a242ef40e99" class="">NedÃ¡vno jsem v prÃ¡ci byl nucenÃ½ pracovat s OpenShiftem. MusÃ­m Å™Ã­ct, Å¾e se mi docela lÃ­bil a myslÃ­m si, Å¾e mÃ¡ zÃ¡Å™nou budoucnost. UmoÅ¾Åˆuje vytvÃ¡Å™et pÄ›knou hardwarovou abstrakci nad clustery poÄÃ­taÄÅ¯, provÃ¡dÄ›t relativnÄ› bezbolestnÃ½ deployment aplikacÃ­ na vlastnÃ­m firemnÃ­m cloudu.</p>
      <p id="ef85363e-c040-4a1f-8fa0-793426a2237e" class="">PÅ™esto jsem bÄ›hem procesu portovÃ¡nÃ­ nÄ›kolika balÃ­ÄkÅ¯ ze starÃ©ho RHEL 6 formÃ¡tu, kterÃ½ bÄ›Å¾el na fyzickÃ½ch serverech do novÃ©ho RHEL 7 spec formÃ¡tu, kterÃ½ mÃ¡ bÄ›Å¾et uvnitÅ™ OpenShiftu neustÃ¡le kroutil hlavou ohlednÄ› specifik nastavovÃ¡nÃ­ a konfigurace.</p>
      <p id="df51cfc0-493d-4a01-a01d-2230bd06bc10" class="">Abyste tomu rozumÄ›li, tvÅ¯rci OpenShiftu ho umoÅ¾ÅˆujÃ­ konfigurovat pÅ™es webovÃ© rozhranÃ­ prostÄ› jen klikÃ¡nÃ­m. K tomu navÃ­c nabÃ­zejÃ­ REST API a takÃ© utilitu pÅ™Ã­kazovÃ© Å™Ã¡dky <code>oc</code>, kterou je moÅ¾nÃ© provÃ¡dÄ›t to samÃ© co z ostatnÃ­ch dvou rozhranÃ­.</p>
      <p id="fff9433f-0840-450c-a319-9a504e58b9cd" class="">Kroutil jsem hlavou, protoÅ¾e jak v pÅ™Ã­padÄ› Webu, REST API Äi <code>oc</code> se jednÃ¡ o konfiguraci nahrÃ¡vÃ¡nÃ­m a upravovÃ¡nÃ­m <em>objektÅ¯</em> popsanÃ½ch pomocÃ­ YAMLu Äi JSONu (formÃ¡ty je moÅ¾nÃ© zamÄ›Åˆovat).</p>
      <p id="62a1fbb8-dce1-4a11-9f50-ede6089f54b3" class="">Tyto <em>objekty</em> je moÅ¾nÃ© definovat v takzvanÃ© <em>template</em>, kterÃ¡ funguje jako svÃ©ho druhu <a href="https://en.wikipedia.org/wiki/Makefile">Makefile</a>, postupnÄ› vykonÃ¡vÃ¡ jednotlivÃ© bloky a na konci by mÄ›l bÃ½t vÃ½sledkem bÄ›Å¾Ã­cÃ­ systÃ©m. V rÃ¡mci <em>template</em> je moÅ¾nÃ© pouÅ¾Ã­vat Å¡ablonovacÃ­ systÃ©m, kterÃ½ umoÅ¾Åˆuje definovat a expandovat promÄ›nnÃ©.</p>
      <p id="9395618a-83f6-45f7-a029-031fa6740ff6" class="">Tohle vÅ¡echno je postavenÃ© nad YAMLem, coÅ¾ je ponÄ›kud mÃ©nÄ› ukecanÃ½ bratr JSONu. UkÃ¡zka template mÅ¯Å¾e vypadat napÅ™Ã­klad takto:</p>
      <pre id="5a49bc94-1e36-417c-97e8-b8fbadb1eca2" class="code"><code>apiVersion: v1
kind: Template
metadata:
  name: redis-template
  annotations:
    description: "Description"
    iconClass: "icon-redis"
    tags: "database,nosql"
objects:
- apiVersion: v1
  kind: Pod
  metadata:
    name: redis-master
  spec:
    containers:
    - env:
      - name: REDIS_PASSWORD
        value: ${REDIS_PASSWORD}
      image: dockerfile/redis
      name: master
      ports:
      - containerPort: 6379
        protocol: TCP
parameters:
- description: Password used for Redis authentication
  from: '[A-Z0-9]{8}'
  generate: expression
  name: REDIS_PASSWORD
labels:
  redis: master</code></pre>
      <p id="2f886b0d-a55e-427e-87ad-84bf51d71932" class="">Expanze promÄ›nnÃ½ch probÃ­hajÃ­ zvenÄÃ­ pÅ™es parametry pÅ™Ã­kazovÃ© Å™Ã¡dky.</p>
      <p id="39609cbd-5474-4b8b-b794-8cb3c08573e8" class="">Dosud dobrÃ©. JenÅ¾e jak by se dalo tuÅ¡it, mÃ¡m k tomu spoustu vÃ½hrad:</p>
      <p id="431c5d3f-8599-47f9-9eed-b65a3a96aa3e" class="">Naprosto zde chybÄ›jÃ­ podmÃ­nky. Aby ÄlovÄ›k mohl napÅ™Ã­klad podmÃ­nÄ›nÄ› vykonat nÄ›jakou ÄÃ¡st kÃ³du, musÃ­ pouÅ¾Ã­t Å¡ablonovacÃ­ systÃ©m (<a href="http://jinja.pocoo.org/">Jinja2</a> tÅ™eba) nad tÃ­mhle Å¡ablonovacÃ­m systÃ©mem.</p>
      <p id="e4d27070-71d4-4dc3-bf67-a350c82290ed" class="">ChybÃ­ tam taky samozÅ™ejmÄ› definice funkcÃ­ (Äasto opakovanÃ½ch blokÅ¯) a cyklÅ¯. Kdyby se jednalo o cokoliv jinÃ©ho, tak bych to asi odpustil, ale pÅ™edstavte si ÃºplnÄ› ukÃ¡zkovÃ© pouÅ¾itÃ­. U nÃ¡s ve firmÄ› pouÅ¾Ã­vÃ¡me pro kaÅ¾dou jazykovou mutaci naÅ¡eho produktu ÄtyÅ™i prostÅ™edÃ­: <code>dev</code>, <code>test</code>, <code>stage</code> a <code>prod</code>. PrvnÄ› si vÃ½vojÃ¡Å™i testujÃ­ nasazenÃ­ na <code>dev</code>u, potom testeÅ™i na <code>test</code>u, businnesÃ¡ci potÃ© na <code>stage</code> a zÃ¡kaznÃ­ci nakonec pouÅ¾Ã­vajÃ­ prostÅ™edÃ­ na <code>prod</code>u.</p>
      <p id="46701935-46be-4662-9fed-f62f37953699" class="">KdyÅ¾ nasadÃ­m novou verzi programu, musÃ­ postupnÄ› projÃ­t pÅ™es vÅ¡echny tyto prostÅ™edÃ­. TudÃ­Å¾ by bylo dobrÃ© mÃ­t nÄ›jakou moÅ¾nost napÅ™Ã­klad provÃ©st spuÅ¡tÄ›nÃ­ virtuÃ¡lnÃ­ho stroje v rÃ¡mci OpenShiftu tak, Å¾e prostÄ› Å™eknu â€pusÅ¥ toto ÄtyÅ™ikrÃ¡tâ€œ. JenÅ¾e OpenShift samozÅ™ejmÄ› nic takovÃ©ho neumÃ­ a je tÅ™eba to dÄ›lat manuÃ¡lnÄ›. To zaÄne bÃ½t velmi rychle velmi velkÃ½ opruz, protoÅ¾e prostÅ™edÃ­ se od sebe moc nelÃ­Å¡Ã­, kromÄ› trochy konfigurace, kterÃ¡ je to jedinÃ© co by bylo tÅ™eba dynamicky upravit.</p>
      <p id="ece741c7-d605-4097-b361-7a186588a081" class="">VzpomÃ­nÃ¡te si, Å¾e jsem pÅ¯vodnÄ› psal o rÅ¯znÃ½ch jazykovÃ½ch mutacÃ­ch? ProtoÅ¾e to jsou ÄtyÅ™i instance per jazyk a jazykovÃ© mutace mÃ¡me momentÃ¡lnÄ› taky ÄtyÅ™i, coÅ¾ dÃ¡vÃ¡ dohromady Å¡esnÃ¡ct instancÃ­. A to mÃ¡me projekty, kde je to deset instancÃ­ per vÃ½vojovÃ© prostÅ™edÃ­, per jazyk. Tedy dohromady musÃ­ bÄ›Å¾et 160 instancÃ­.</p>
      <p id="96ac06f1-5d9f-4011-bef4-c01e451f510f" class="">Je asi jasnÃ©, Å¾e tohle nejde a tak jsme byli nuceni si nad tÃ­m postavit vlastnÃ­ sprÃ¡vu v podobÄ› python scriptÅ¯ a shellscriptÅ¯ a ansible. NemÃ¡m z toho radost. A to jsem se nakonec rozhodl nepitvat, Å¾e OpenShift pouÅ¾Ã­vÃ¡ docker a je v nÄ›m nutnÃ© zÃ¡roveÅˆ s jeho YAML formÃ¡tem Å™eÅ¡it i Dockerfile formÃ¡t a argumenty pÅ™Ã­kazovÃ© Å™Ã¡dky.</p>
      <p id="046e21d7-9833-47e7-828c-e9cd00597890" class="">To vÅ¡e proto, Å¾e neexistuje jednotnÃ½ Å¡iroce pÅ™ijÃ­manÃ½ formÃ¡t konfiguraÄnÃ­ho jazyka, kterÃ½ by byl zÃ¡roveÅˆ jazykem scriptovacÃ­m. NÄ›co jako lisp.</p>
      <h1 id="bd0421bc-8530-4f79-a64c-7c5428b0e8c7" class="">UkÃ¡zkovÃ¡ studie: Ansible</h1>
      <p id="fa885297-5202-4d6d-9ce1-b55dfa5616fa" class="">AnsiblÃ©Ã©Ã© je krÃ¡snou ukÃ¡zkou jak to dopadne, kdyÅ¾ se nÄ›kdo jen tak ad-hoc pokusÃ­ podobnÃ½ jazyk uvaÅ™it, aniÅ¾ by nad tÃ­m nÄ›jak moc pÅ™emÃ½Å¡lel, nebo mÄ›l za sebou teorii programovacÃ­ch jazykÅ¯.</p>
      <p id="6f6881f4-8b23-4a9a-8576-ba66bdddb7a5" class="">PÅ¯vodnÄ› zaÄal jako na YAMLu zaloÅ¾enÃ½ deklaraÄnÃ­ konfiguraÄnÃ­ jazyk popisujÃ­cÃ­ co se mÃ¡ jak dÄ›lat. Zde je napÅ™Ã­klad ukÃ¡zka deklarace instalace nginxu:</p>
      <pre id="1ca3fb5c-43d9-4943-8fb0-ec1509f0b105" class="code"><code>- name: Install nginx
  hosts: host.name.ip
  become: true
  tasks:
  - name: Add epel-release repo
    yum:
      name: epel-release
      state: present
  - name: Install nginx
    yum:
      name: nginx
      state: present
  - name: Insert Index Page
    template:
      src: index.html
      dest: /usr/share/nginx/html/index.html
  - name: Start NGiNX
    service:
      name: nginx
      state: started</code></pre>
      <p id="356b12c2-6dfb-4b5a-9846-3cd6176667cc" class="">CelÃ© je to pomÄ›rnÄ› jednoduÅ¡e ÄitelnÃ¡ YAML key-value struktura. SamozÅ™ejmÄ›, SAMOZÅ˜EJMÄš Å¾e nemohlo zÅ¯stat jen u tohohle a tak nÄ›koho napadlo pÅ™idat podmÃ­nky a cykly. SamozÅ™ejmÄ› jako YAML:</p>
      <ul id="a45b5337-e985-490f-a02f-b7ed094effff" class="bulleted-list">
        <li>
          <a href="https://docs.ansible.com/ansible/2.5/user_guide/playbooks_conditionals.html">https://docs.ansible.com/ansible/2.5/user_guide/playbooks_conditionals.html</a>
        </li>
      </ul>
      <ul id="ac6bfc05-4636-4aba-a6f2-258065b2ab9c" class="bulleted-list">
        <li>
          <a href="https://docs.ansible.com/ansible/2.5/user_guide/playbooks_blocks.html">https://docs.ansible.com/ansible/2.5/user_guide/playbooks_blocks.html</a>
        </li>
      </ul>
      <pre id="f6ed94b8-9e34-4f11-b40c-0f3fff28782a" class="code"><code>tasks:
    - command: echo {{ item }}
      loop: [ 0, 2, 4, 6, 8, 10 ]
      when: item &gt; 5</code></pre>
      <p id="4c4f9a9e-c946-4edb-aa05-d84be1ad00ee" class="">SamozÅ™ejmÄ›, Å¾e tÃ­m vznikl programovacÃ­ jazyk bez jakÃ©koliv konzistence, vnitÅ™nÃ­ logiky a smyslu. Jazyk kterÃ½ byl nucenÃ½ jÃ­t dÃ¡l a dÃ¡l a nadefinovat si bloky a vÃ½jimky a oÅ¡etÅ™ovÃ¡nÃ­ chyb a funkce a to celÃ© postavenÃ© nad YAMLem. To celÃ© bez debuggeru, IDE, toolingu, smysluplnnÃ½ch <em>stacktrace</em> a s naprostou ignoracÃ­ Å¡edesÃ¡ti let vÃ½voje uÅ¾ivatelskÃ©ho rozhranÃ­ programovacÃ­ch jazykÅ¯.</p>
      <p id="6bc83a92-d9ec-4b4a-b344-c51b05fa49e6" class="">Ten tenkÃ½ vysokÃ½ zvuk znÄ›jÃ­cÃ­ jako piÅ¡tÄ›nÃ­ na vysokÃ© frekvenci, jenÅ¾ mÅ¯Å¾ete slyÅ¡et v dokonalÃ©m tichu tÅ™eba chvÃ­li pÅ™ed spanÃ­m jsou andÄ›lÃ© Å™voucÃ­ frustracÃ­. Je to Å™ev mojÃ­ duÅ¡e nad vÅ¡Ã­ lidskou demencÃ­, kterÃ¡ se vrÅ¡Ã­ a vrÅ¡Ã­ nad sebe.</p>
      <p id="65139f32-550e-4e22-bb3d-04b557b34ed7" class="">NemÅ¯Å¾eme se prostÄ› domluvit nad nÄ›ÄÃ­m co by pro jednou dÃ¡valo smysl?</p>
      <h1 id="9a4e1a8c-937c-43f4-acea-aaf0a728b447" class="">ObecnÃ½ princip</h1>
      <p id="61c4a272-80b0-48c5-91f8-924e65f225ce" class="">Co takhle vzÃ­t vÅ¡ude tam, kde se dneska pouÅ¾Ã­vÃ¡ nÄ›jakÃ½ podivnÃ½ stringovÃ½ formÃ¡t, aÅ¥ uÅ¾ je to pÅ™edÃ¡vÃ¡nÃ­ parametrÅ¯ programÅ¯m, nebo komunikace mezi nimi, a nahradit to nÄ›jakÃ½m ÃºspornÃ½m, jednoduÅ¡e zapisovatelnÃ½m jazykem pro definici struktur? Jazykem, kterÃ½ by byl zÃ¡roveÅˆ popisnÃ½m formÃ¡tem, jenÅ¾ by chÃ¡pal datovÃ© typy jako <code>dict</code>, <code>list</code>, <code>int</code> a <code>string</code> a delegaci (dÄ›diÄnost). Tak aby pro ÄlovÄ›ka i program odpadla vÄ›tÅ¡ina parsovÃ¡nÃ­ a dohad nad strukturou, a druhÃ½ jmenovanÃ½ je dostal uÅ¾ rovnou ve svÃ©m nativnÃ­m formÃ¡tu.</p>
      <p id="081ff0ce-f01c-4c31-a0b8-16bc11326310" class="">Tolik tedy ke kritice. PojÄme se podÃ­vat na nÃ¡pady, jak se posunout nÄ›kam dÃ¡l.</p>
      <h2 id="b5426a3b-d226-47d5-a82b-917e9d8bcf9a" class="">OhlednÄ› objektÅ¯</h2>
      <p id="7b3a741b-e00d-433f-b13b-fb5f396ceeb4" class="">KdyÅ¾ mluvÃ­m o objektech, nemÃ¡m na mysli co znÃ¡te z programovacÃ­ch jazykÅ¯ jako tÅ™eba C++, nebo Java. Spousta lidÃ­ na to mÃ¡ poslednÃ­ dobou alergii.</p>
      <p id="b42f8745-85cf-4159-8f92-c571b44be966" class="">MyslÃ­m tÃ­m obecnÃ½ koncept grupovÃ¡nÃ­ funkcÃ­ s daty, nad kterÃ½mi operujÃ­. K tomu nenÃ­ tÅ™eba <em>class based pÅ™Ã­stup</em> (= nemusÃ­te psÃ¡t tÅ™Ã­dy). NenÃ­ k tomu tÅ™eba ani dÄ›diÄnost, i kdyÅ¾ nÄ›jakÃ¡ forma delegace se hodÃ­.</p>
      <p id="7fd130a1-d930-4fbc-a532-640f7315ed63" class="">GPIO podsloÅ¾ka filesystÃ©mu <code>/sys</code> obsahujÃ­cÃ­ kontrolnÃ­ soubor, jenÅ¾ udÃ¡vÃ¡ smÄ›r zÃ¡pisu dat na LED diodu, a datovÃ½ soubor, kterÃ½m data mÅ¯Å¾ete zapsat Äi ÄÃ­st, je objekt. MÃ¡ metodu (ovlÃ¡dacÃ­ soubor) i data, nad kterÃ½mi se operuje. SamozÅ™ejmÄ›, Å¾e ideÃ¡lnÄ› by bylo moÅ¾nÃ© podobnÃ½ objekt i kopÃ­rovat a instancovat standardnÃ­m zpÅ¯sobem, pÅ™edÃ¡vat ho dalÅ¡Ã­m objektÅ¯m a metodÃ¡m a provÃ¡dÄ›t jeho introspekci. Ale i tak je to primitivnÃ­ objektovÃ½ systÃ©m, kde objektem je sloÅ¾ka, daty jsou soubory, a metodami kontrolnÃ­ soubory a operace nad nimi.</p>
      <p id="7e833b6e-665b-4fc6-9c53-2daf427285fe" class="">SamotnÃ© objekty jsou na nejniÅ¾Å¡Ã­ Ãºrovni <em>key-value</em> data. KlÃ­Ä zpÅ¯sobÃ­ provedenÃ­ kÃ³du v pÅ™Ã­padÄ› Å¾e jde o jmÃ©no metody, nebo vrÃ¡cenÃ­ dat, v pÅ™Ã­padÄ› Å¾e jsou v nÄ›m uloÅ¾eny data. RozdÃ­l mezi objekty a <em>key-value</em> zÃ¡znamem v databÃ¡zi je pomÄ›rnÄ› minimÃ¡lnÃ­, a spoÄÃ­vÃ¡ pÅ™edevÅ¡Ã­m v moÅ¾nosti uloÅ¾it kÃ³d, a takÃ© v delegaci, kde kdyÅ¾ se nenajde danÃ½ klÃ­Ä v potomkovi, tak se pÅ™esune hledÃ¡nÃ­ do konkrÃ©tnÃ­ho rodiÄe.</p>
      <p id="4dbf8915-857a-4808-ad08-998d9016fd75" class="">Pokud tedy mluvÃ­m o objektech, mÃ¡m na mysli obecnÃ© <em>key-value</em> struktury umoÅ¾ÅˆujÃ­cÃ­ delegaci, referencovÃ¡nÃ­ dalÅ¡Ã­ch (objektovÃ½ch) <em>key-value</em> struktur, reflexi a ideÃ¡lnÄ› i nÄ›jakou formu homoikonicity.</p>
      <p id="855a5b5d-045a-4512-a08a-e100181ecda1" class="">ZÃ¡mÄ›rnÄ› nemÃ¡m na mysli konkrÃ©tnÃ­ jazyk, ale zcela a vÅ¯bec nemÃ¡m na mysli imperativnÃ­, objektovÄ› orientovanÃ© a na strukturÃ¡ch zaloÅ¾enÃ© jazyky, jako jsou C++, C#, Java a dalÅ¡Ã­ podobnÃ©.</p>
      <h2 id="2d7c7deb-cca0-4611-965c-ef14b2446f30" class="">OhlednÄ› zprÃ¡v</h2>
      <p id="a4139973-1e44-45c3-bdaa-468608478e27" class="">Je pro mÄ› fascinujÃ­cÃ­, Å¾e na nejniÅ¾Å¡Ã­ch ÃºrovnÃ­ch internetovÃ½ch protokolÅ¯ nenÃ­ problÃ©m se domluvit na strukturovanÃ©m formÃ¡tu zprÃ¡v. KaÅ¾dÃ½ TCP/IP packet mÃ¡ jasnÄ› danou hlaviÄku, jasnÄ› danÃ© adresovÃ¡nÃ­ a celÃ© to funguje v naprosto masivnÃ­m, celosvÄ›tovÃ©m mÄ›Å™Ã­tku. ProÄ by to tedy nemohlo fungovat na poÄÃ­taÄi, Äi mezi nimi i na vyÅ¡Å¡Ã­ Ãºrovni?</p>
      <p id="317461a2-638a-447c-b55b-5a64ba6ad794" class="">Opravdu by neÅ¡lo adresovat jednotlivÃ© metody objektÅ¯, Äi objekty samotnÃ©, jak v rÃ¡mci jednoho poÄÃ­taÄe, tak po internetu?</p>
      <h1 id="41e87b89-e4bc-4331-ae69-3500af367807" class="">Idea</h1>
      <p id="2a9d55cc-72dd-412e-9fc0-9049d318d023" class="">Nebudu popisovat nÄ›jakÃ½ konkrÃ©tnÃ­ systÃ©m. Sice jsem na tohle tÃ©ma provedl pÃ¡r experimentÅ¯, ale v zÃ¡sadÄ› nemÃ¡m konkrÃ©tnÃ­ data a zkuÅ¡enosti. Shrnu pouze to co jsem napsal pÅ™edtÃ­m. TÃ­m by postupnÃ½m zhuÅ¡Å¥ovÃ¡nÃ­m a krystalizacÃ­ jiÅ¾ jednou rozebranÃ½ch myÅ¡lenek mohlo vzniknout cosi jako dostateÄnÄ› komprimovanÃ½ popis poÅ¾adavkÅ¯, aby to bylo moÅ¾no brÃ¡t jako <em>nekonkrÃ©tnÃ­</em> definici <em>konkrÃ©tnÃ­ho</em> produktu.</p>
      <h2 id="ba3be080-d4e2-4eba-a5c0-82ecdd116875" class="">DatabÃ¡ze mÃ­sto filesystÃ©mu</h2>
      <p id="6ddf6f28-0f9d-4126-b78a-c1ad90b07ca5" class="">PÅ™emÃ½Å¡lel jsem nad tÃ­m, a nevyhnutelnÃ½m krokem je podle mÃ©ho nÃ¡zoru zahodit filesystÃ©m a nahradit ho databÃ¡zÃ­. KdyÅ¾ mluvÃ­m o databÃ¡zi, nemÃ¡m tÃ­m na mysli konkrÃ©tnÃ­ SQL databÃ¡zi, ani <em>key-value</em> â€no-SQLâ€œ databÃ¡ze. MluvÃ­m tu o obecnÃ©m strukturovanÃ©m systÃ©mu uchovÃ¡vÃ¡nÃ­ dat na zÃ¡znamovÃ½ch mÃ©diÃ­ch, kterÃ½ podporuje datovÃ© typy, atomicitu, indexovÃ¡nÃ­, transakce, Å¾urnÃ¡ly a uklÃ¡dÃ¡nÃ­ libovolnÄ› strukturovanÃ½ch dat, vÄetnÄ› velkÃ½ch blokÅ¯ ÄistÄ› binÃ¡rnÃ­ch dat.</p>
      <p id="da2e4f88-d597-44c3-b60f-cdf7df64e072" class="">NÄ›co kam mÅ¯Å¾ete prostÄ› hodit nÄ›jakou strukturu a ono se to postarÃ¡ o jejÃ­ uloÅ¾enÃ­ <strong>bez zbyteÄnÃ© serializace a deserializace</strong>. JÃ¡ vÃ­m, Å¾e na konci jsou to vÅ¾dycky jen bajty, ale prÃ¡vÄ› proto nevidÃ­m moc dÅ¯vodÅ¯, proÄ dÄ›lat signifikantnÃ­ rozdÃ­l mezi tÃ­m co je v pamÄ›ti a co je na disku.</p>
      <p id="96c3bef0-e254-49b8-874e-288ad7897937" class="">Nechci aby to vypadalo, jako Å¾e mÃ¡m nÄ›co proti tradiÄnÃ­m souborovÃ½m systÃ©mÅ¯m. Jsem jejich uÅ¾ivatelem stejnÄ› jako vÅ¡ichni ostatnÃ­, ale myslÃ­m, si, Å¾e bez tohohle se nenÃ­ moÅ¾nÃ© posunout nÄ›kam signifikantnÄ› jinam. KdyÅ¾ nejste schopni vynutit strukturu na Ãºrovni uloÅ¾enÃ½ch dat, bez neustÃ¡lÃ©ho pÅ™evÃ¡dÄ›nÃ­ sem a tam, z formÃ¡tu do formÃ¡tu a reprezentacÃ­ v pamÄ›ti, je to jako stavÄ›t barÃ¡k v baÅ¾inÄ›, na zÃ¡kladech, kterÃ© se neustÃ¡le hÃ½bou.</p>
      <h2 id="20ed2693-11c4-447f-8488-28f1122d430d" class="">Programy jako kolekce adresovatelnÃ½ch blokÅ¯ kÃ³du v databÃ¡zi</h2>
      <p id="5a459059-3fd4-4937-8c4b-7bb9530f3213" class="">Jakmile mÃ¡te filesystÃ©m, kterÃ½ vÃ¡m umoÅ¾Åˆuje nativnÄ› uchovÃ¡vat strukturovanÃ© informace, nedÃ¡vÃ¡ smysl mÃ­t programy jako jednu velkou sÃ©rii bajtÅ¯, kterÃ¡ se uzavÃ­rÃ¡ pÅ™ed svÄ›tem. Naopak dÃ¡vÃ¡ smysl z toho postavit nÄ›co podobnÃ©ho architektuÅ™e <em>microservices</em>.</p>
      <p id="4a05077e-18a3-4628-9b21-dcdc9ed52b3c" class="">Pokud se nad tÃ­m zamyslÃ­te dostateÄnÄ› abstraktnÄ›, program je objekt. Je to kolekce dat, nad kterÃ½mi operujÃ­ v nÄ›m obsaÅ¾enÃ© funkce. CelÃ© je to zapouzdÅ™enÃ© a komunikuje to jen pomocÃ­ nÄ›jakÃ½ch standardnÃ­ch zpÅ¯sobÅ¯ (stdin/out/err, socket, signÃ¡ly, env, error kÃ³dy, zÃ¡pisy do souborÅ¯..). KdyÅ¾ mÃ¡te filesystÃ©m umoÅ¾ÅˆujÃ­cÃ­ tyhle objekty uchovÃ¡vat nativnÄ›, nevidÃ­m dÅ¯vod, proÄ potom nezpÅ™Ã­stupnit jednotlivÃ© <em>metody</em> tohoto objektu i z venÄÃ­.</p>
      <p id="a3b49a8a-127e-4328-859d-d558f3a6fc12" class="">Jakmile je zveÅ™ejnÃ­te, nepotÅ™ebujete komunikovat starÃ½mi streamovÃ½mi zpÅ¯soby (socket, soubor, ..), staÄÃ­ vÃ¡m prostÄ› vracet strukturovanÃ¡ data.</p>
      <p id="7f37cc45-ac0c-4cc2-beab-59be8c3ad778" class="">KÃ³d se mÅ¯Å¾e stÃ¡le kompilovat, stÃ¡le je moÅ¾nÃ© pouÅ¾Ã­vat rÅ¯znÃ© programovacÃ­ jazyky. LiÅ¡Ã­ se to vÅ¡ak vÃ½sledkem, jenÅ¾ z toho vypadne. MÃ­sto binÃ¡rnÃ­ho blobu, posÃ­lanÃ©ho pÅ™Ã­mo do procesoru, jenÅ¾ je izolovÃ¡n od ostatnÃ­ch procesÅ¯ a zbytku systÃ©mu, mÃ¡te v podstatÄ› definici API a reakcÃ­ na nÄ›. NÄ›co jako sdÃ­lenou knihovnu, aÅ¾ na to Å¾e tohle je nativnÃ­ prvek systÃ©mu a jeho finÃ¡lnÃ­ podoba.</p>
      <h2 id="30f9a582-60af-45e4-a780-33477e907f9c" class="">Smrt konfiguraÄnÃ­ch formÃ¡tÅ¯ a parsovÃ¡nÃ­ textu</h2>
      <p id="9ee0ef34-db75-49df-bae5-02c907a26940" class="">KonfiguraÄnÃ­ soubory a rÅ¯znÃ© jejich formÃ¡ty existujÃ­, protoÅ¾e filesystÃ©m neumÃ­ uloÅ¾it strukturu. Kdyby to umÄ›l, mÅ¯Å¾ete prostÄ› uloÅ¾it danÃ½ slovnÃ­k s danÃ½mi klÃ­Äi a hodnotami, a pÅ™Ã­Å¡tÄ› po nich sÃ¡hnout. NemusÃ­te zapisovat <code>RUN=1</code> do sekce <code>[configuration]</code> a pak to parsovat a serializovat a deserializovat. MÅ¯Å¾ete prostÄ› uloÅ¾it samotnÃ½ fakt <code>"RUN": True</code> na umÃ­stÄ›nÃ­ <code>configuration</code> pÅ™Ã­mo na disku.</p>
      <p id="af1d9819-bd9e-4e8b-aeae-79ecc26671bb" class="">NepotÅ™ebujete Å™eÅ¡it, jestli je to JSON, nebo CSV, protoÅ¾e v tom pro vÃ¡s nenÃ­ rozdÃ­l z hlediska formÃ¡tu, ale jen struktury dat (JSON typicky <em>dict</em>, CSV pole polÃ­).</p>
      <p id="6acc72f1-2a13-4c92-a4b1-e5ffaf733504" class="">Parametry pÅ™Ã­kazovÃ© Å™Ã¡dky, env promÄ›nnÃ©, ale i vÅ¡echno ostatnÃ­ pÃ­Å¡ete jako datovÃ© typy zachovÃ¡vajÃ­cÃ­ si strukturu. Programem nejsou parsovÃ¡ny jako text, o to se starÃ¡ uÅ¾ systÃ©m ve chvÃ­li kdy to uÅ¾ivatel dopÃ­Å¡e. DatovÃ½ formÃ¡t je jednoduchÃ½ na textovÃ½ zÃ¡pis. KdyÅ¾ posÃ­lÃ¡ data program programu, nikde mezi nimi se neserializuje do textu, zprÃ¡vy se neposÃ­lajÃ­ jako stream bajtÅ¯, ale jako zprÃ¡vy (ve stylu <a href="https://en.wikipedia.org/wiki/ZeroMQ">zeromq</a>).</p>
      <h2 id="e65b0c96-5f9d-44b4-8600-2b849db6c106" class="">KomplexnÃ­ redukce</h2>
      <p id="57b44fcf-9b6b-45d2-80aa-670924265b77" class="">PÅ™edchozÃ­ popis je poÅ™Ã¡d moc dlouhÃ½, pojÄme ho proto jeÅ¡tÄ› trochu vÃ­c zredukovat, tak jak se redukujÃ­ tÅ™eba matematickÃ© vÃ½razy do jednoho vzorce:</p>
      <blockquote id="e542b650-0fec-4b3a-bebf-ca35286b1131" class="">
        MÃ­sto filesystÃ©mu strukturovanÃ¡ hierarchickÃ¡ databÃ¡ze zachovÃ¡vajÃ­cÃ­ datovÃ© typy. V nÃ­ jak programy, uloÅ¾enÃ© jako kolekce navzÃ¡jem se volajÃ­cÃ­ch, ale i z venku zavolatelnÃ½ch funkcÃ­, tak konfiguraÄnÃ­ soubory a uÅ¾ivatelskÃ¡ data. To vÅ¡e formou pÅ™Ã­stupnÃ½ch a adresovatelnÃ½ch struktur. Na zÃ¡pis a ÄtenÃ­ jednoduchÃ½, <strong>lehkÃ½</strong> textovÃ½ formÃ¡t, pouÅ¾Ã­vanÃ½ vÅ¡ude kde je strukturovanÃ½ uÅ¾ivatelskÃ½ vstup. Programy kterÃ© ke komunikaci nepouÅ¾Ã­vajÃ­ textovÃ© protokoly, ale pÅ™edÃ¡vajÃ­ si pÅ™Ã­mo struktury.
      </blockquote>
      <p id="4dc938ad-4609-476d-8605-dbdcfe3f622f" class="">Dost bylo iterativnÃ­ho vylepÅ¡ovÃ¡nÃ­ padesÃ¡t let starÃ½ch myÅ¡lenek. MyslÃ­m, Å¾e je Äas na nÄ›co novÃ©ho.</p>
      <h2 id="c6cff942-406f-41e8-bbcb-ea3dd84d9784" class="">Inspirace a kontext</h2>
      <p id="6371efdd-cbe7-4264-9ff9-899d39cfb2e6" class="">Pokud si myslÃ­te, Å¾e jsou to vÅ¡echno naivnÃ­ blbosti, zkuste si pÅ™eÄÃ­st nÄ›co na tÃ©ma <a href="https://en.wikipedia.org/wiki/Genera_(operating_system)">Genery</a>:</p>
      <ul id="426708ad-231c-4bca-81ae-5350b281f09f" class="bulleted-list">
        <li>
          <a href="http://bitsavers.trailing-edge.com/pdf/symbolics/software/genera_8/Genera_Concepts.pdf">http://bitsavers.trailing-edge.com/pdf/symbolics/software/genera_8/Genera_Concepts.pdf</a>
        </li>
      </ul>
      <p id="4afa70a3-7a1c-43e9-9a9a-16ec82131da2" class="">ZjistÃ­te, Å¾e pÅ™ed desÃ­tkami let existoval grafickÃ½ systÃ©m splÅˆujÃ­cÃ­ velkou ÄÃ¡st vÅ¡eho, o Äem jsem psal. SystÃ©m tak dobrÃ½, Å¾e dodnes kolem sebe spojuje skupiny nadÅ¡encÅ¯.</p>
      <p id="2bd53aaa-a0bb-4ee4-952a-28d1248e3d83" class="">DÃ¡le pak na podobnÃ¡ tÃ©mata:</p>
      <ul id="1135e172-fb7d-4bc8-83a1-193268cdce0d" class="bulleted-list">
        <li>
          <a href="https://tekkie.wordpress.com/2007/07/19/squeak-is-like-an-operating-system/">Squeak is like an operating system</a>
        </li>
      </ul>
      <ul id="d82fbc27-079a-4f98-9c59-e2a5f1e3f6d1" class="bulleted-list">
        <li>
          <a href="https://www.reddit.com/r/programming/comments/54z7hd/the_operating_system_should_there_be_one/">The Operating System: Should There Be One?</a> (article + reddit discussion)
        </li>
      </ul>
      <ul id="15d7faf6-77ef-460f-ad87-b066a0cb80e7" class="bulleted-list">
        <li>
          <a href="https://shalabh.com/programmable-systems/systems-not-programs.html">Systems, not Programs</a>
        </li>
      </ul>
      <ul id="56670107-29d8-434d-bcd8-3ba179c3c346" class="bulleted-list">
        <li>
          <a href="https://rcrowley.org/2010/01/06/things-unix-can-do-atomically.html">Things UNIX can do atomically</a>
        </li>
      </ul>
      <ul id="75321a23-687f-4ee1-b595-090c8fefce8d" class="bulleted-list">
        <li>
          <a href="http://www.pixelbeat.org/programming/stdio_buffering/">buffering in standard streams</a>
        </li>
      </ul>
      <ul id="80ebc3c7-066f-47b8-9c69-327fa3c5cc7d" class="bulleted-list">
        <li>
          <a href="http://okmij.org/ftp/papers/DreamOSPaper.html">A dream of an ultimate OS</a>
        </li>
      </ul>
      <ul id="802241fb-2c61-4123-9123-b11f19f772de" class="bulleted-list">
        <li>
          <a href="https://kaitai.io/">Kaitai struct</a>
        </li>
      </ul>
      <ul id="912d2f1b-53e7-4dad-aa42-101a8bd71dc4" class="bulleted-list">
        <li>
          <a href="https://treenotation.org/">Tree notation</a>
        </li>
      </ul>
      <ul id="a3e56504-a976-4bc5-9b30-0ca669dc2637" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/bystroushaak/2011/2/proc-pouzivam-unix-linux">ProÄ pouÅ¾Ã­vÃ¡m Unix/Linux</a>
        </li>
      </ul>
      <ul id="c944e264-55d3-4dd7-a0a5-eae812900b10" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/bystroushaak/2017/7/jak-se-stat-programatorem#493">http://www.abclinuxu.cz/blog/bystroushaak/2017/7/jak-se-stat-programatorem#493</a>
        </li>
      </ul>
      <h1 id="64cb21b6-3fab-4c37-8bcf-59675e4573a1" class="">RelevantnÃ­ diskuze</h1>
      <ul id="3852fb5c-47c1-4fac-8618-7fb02c4e2771" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/bystroushaak/2018/12/programatorova-kritika-chybejici-struktury-os/diskuse">Velmi plodnÃ¡ diskuze na abclinuxu</a>
        </li>
      </ul>
      <ul id="24a6a6bf-b0c7-4b6d-a0c3-a802b96af38d" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/foobar/2018/12/structuros-simulator-bystroushaakovho-nezmyslu">StructurOS - simulÃ¡tor bystroushaakovho nezmyslu</a>
        </li>
      </ul>
      <ul id="785f9524-32ac-4c58-be5e-47ce7726f01b" class="bulleted-list">
        <li>
          <a href="http://www.abclinuxu.cz/blog/Linux_nieje_jadro_ale_komunita/2018/12/simulator-bystroushaakovho-nezmyslu-2-tentokrat-s-videom">SimulÃ¡tor bystroushaakovho nezmyslu 2, tentokrÃ¡t s videom.</a>
        </li>
      </ul>
      <h1 id="8e02d43a-f0d3-4c41-afdb-01536ca661e2" class="">Edit <time>@2020/02/18</time></h1>
      <p id="e099fadb-3d61-44cc-8d64-c4c0b45331e4" class="">Od doby co jsem tento ÄlÃ¡nek publikoval se objevilo nÄ›kolik zajÃ­mavÃ½ch ÄlÃ¡nkÅ¯ na tohle tÃ©ma:</p>
      <ul id="3565f250-2dd0-452c-b674-b18f46dd73a1" class="bulleted-list">
        <li>
          <a href="https://shalabh.com/programmable-systems/files-and-file-formats.html">Files, Formats and Byte Arrays</a>
        </li>
      </ul>
      <ul id="a74ddb44-0c04-457a-9935-030e2387227d" class="bulleted-list">
        <li>
          <a href="https://djrobstep.com/posts/programs-are-a-prison">Programs are a prison: Rethinking the fundamental building blocks of computing interfaces</a>
        </li>
      </ul>
      <ul id="88f7a91c-40fb-4f43-90df-694ba8a8a971" class="bulleted-list">
        <li>
          <a href="https://lobste.rs/s/fw5ubn/unix_plan_9_lurking_smalltalk">Unix, Plan 9, and Lurking Smalltalk</a>
        </li>
      </ul>
      <ul id="3e118587-787b-4307-9436-6dbe77e1f74c" class="bulleted-list">
        <li>
          <a href="https://www.youtube.com/watch?v=wN6IwNriwHc">Database as Filesystem</a>
        </li>
      </ul>
      <ul id="9be44191-3ce3-4390-933d-272d0e4e98a9" class="bulleted-list">
        <li>
          <a href="https://apenwarr.ca/log/20190216">The log/event processing pipeline you can't have</a>
        </li>
      </ul>
      <p id="27dfa73c-57cc-43bd-a817-bc2894015093" class=""></p>
    </div>
  </article>
  <div class="corner-ribbon top-right red">
    <a href="https://www.patreon.com/bePatron?u=2618881">Become a Patron</a>
  </div><a class="twitter-share-button" id="twitter_button" href="#"><img src="../../tweet_button.svg"></a>
  <div id="sidebar_bottom">
    <div id="last_five_bottom">
      <h3>New posts:</h3>
      <ul>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-06-15_Todo_in_motion.html" title="Lifelog 2020-06-15; Todo in motion">Lifelog 2020-06-15; Todo in motion</a>
        </li>
        <li>
          <a href="../../en/My_Greenspuns_counter.html" title="My Greenspun's counter">My Greenspun's counter</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/What_do_I_mean_by_node.html" title="What do I mean by node?">What do I mean by node?</a>
        </li>
        <li>
          <a href="../../en/Explorations/Trying_Ansible_alternatives_in_python.html" title="Trying Ansible alternatives in python">Trying Ansible alternatives in python</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment/Pebble_smartwatches.html" title="Pebble smartwatches">Pebble smartwatches</a>
        </li>
        <li>
          <a href="../../en/Improvements/The_Most_Personal_Device_experiment.html" title="The Most Personal Device experiment"><span class="icon">ğŸ“‚</span>The Most Personal Device experiment</a>
        </li>
        <li>
          <a href="../../en/About_this_blog/Unicode_font_subset.html" title="Unicode font subset">Unicode font subset</a>
        </li>
        <li>
          <a href="../../en/Weekly_updates/Lifelog_2020-05-25_Work_in_progress_everywhere.html" title="Lifelog 2020-05-25; Work in progress everywhere">Lifelog 2020-05-25; Work in progress everywhere</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/Improvements/Vitamins_nootropics_and_other_boosters.html">Vitamins, nootropics and other boosters</a>
        </li>
        <li>
          <a href="http://blog.rfox.eu/en/objWiki/Transaction_support_for_simple_in_memory_database.html">Transaction support for simple in-memory database</a>
        </li>
      </ul>& <a href="../../Changelog.html" title="Changelog">more</a>
    </div>
  </div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8322439660353685" data-ad-slot="4657737295" data-ad-format="auto" data-full-width-responsive="true"></ins> 
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script> 
  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false">
  </script> 
  <script>
  window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#edeff5",
      "text": "#838391"
    },
    "button": {
      "background": "#4b81e8"
    }
  }
  });
  </script>
</body>
</html>

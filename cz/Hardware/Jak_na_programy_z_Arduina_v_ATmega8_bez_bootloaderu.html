<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Jak na programy z Arduina v ATmega8 bez bootloaderu</title>
  <link rel="stylesheet" type="text/css" href="../../style.css">
  <link rel="alternate" type="application/atom+xml" href="https://blog.rfox.eu/atom_cz.xml">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Bystroushaak">
  <meta name="twitter:creator" content="@Bystroushaak">
  <meta name="twitter:title" content="Jak na programy z Arduina v ATmega8 bez bootloaderu">
  <meta name="twitter:description" content="V tomto blogpostu jsou popsány dvě věci - jak použít Arduino jako programátor pro rodinu AVR a jak použít programy z Arduina v ATmega8-16PU bez nutnosti bootloaderu a dalších opičin.">
  <meta name="twitter:image" content="https://blog.rfox.eu/cz/Hardware/Jak_na_programy_z_Arduina_v_ATmega8_bez_bootloaderu/Untitled.png">
  <script src="../../scripts.js"></script>
  <meta name="description" content="V tomto blogpostu jsou popsány dvě věci - jak použít Arduino jako programátor pro rodinu AVR a jak použít programy z Arduina v ATmega8-16PU bez nutnosti bootloaderu a dalších opičin.">
  <meta name="keywords" content="hardware,arduino,programovani,m0wFG3PRCoJVTs7JcgBwsOXb3U7yPxBB"><!-- Global site tag (gtag.js) - Google Analytics -->

  <script src="https://www.googletagmanager.com/gtag/js?id=UA-142545439-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-142545439-1');
  </script>
</head>
<body onload="on_body_load();">
  <div id="sidebar_top">
    <div>
      <a href="https://blog.rfox.eu/atom_cz.xml"><img src="../../rss_icon.png" style="width: 3em;"></a>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a href="https://twitter.com/Bystroushaak"><img src="../../twitter_icon.png" style="width: 3em;"></a>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a href="https://www.patreon.com/bePatron?u=2618881"><img src="../../patreon.png" style="width: 3em;"></a>
    </div>
    <h3>New posts</h3>
    <div id="last_five_top">
      <ul>
        <li>
          <a href="../Programovani/Jak_na_vlastni_LLM_GPT.html" title="Jak na vlastní LLM (GPT)">Jak na vlastní LLM (GPT)</a>
        </li>
        <li>
          <a href="../Povidky/Software.html" title="Software">Software</a>
        </li>
        <li>
          <a href="../Ostatni/Paromobilita_je_budoucnost.html" title="Paromobilita je budoucnost">Paromobilita je budoucnost</a>
        </li>
        <li>
          <a href="../Ostatni/Algoritmus_hledani_programatorske_prace_2021-4.html" title="Algoritmus hledání programátorské práce 2021/4">Algoritmus hledání programátorské práce 2021/4</a>
        </li>
        <li>
          <a href="../3D_tisk/Nastaveni_Blenderu_pro_3D_tisk.html" title="Nastavení Blenderu pro 3D tisk">Nastavení Blenderu pro 3D tisk</a>
        </li>
        <li>
          <a href="../3D_modelovani/Geometricky_stred_Prahy.html" title="Geometrický střed Prahy">Geometrický střed Prahy</a>
        </li>
        <li>
          <a href="../../Utrzky/Posta_poezie.html" title="Pošta (poezie)">Pošta (poezie)</a>
        </li>
        <li>
          <a href="../Ostatni/Statni_zklamani.html" title="Státní zklamání">Státní zklamání</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_TODO_list_1_Drzak_na_sluchatka.html" title="3D TODO list 1; Držák na sluchátka">3D TODO list 1; Držák na sluchátka</a>
        </li>
        <li>
          <a href="../Ostatni/Dva_podvodnici.html" title="Dva podvodníci">Dva podvodníci</a>
        </li>
      </ul>
    </div>& <a href="../../Zmeny.html" title="Změny">more</a>
    <div>
      <h3>Tagy</h3>
      <p><a href="../../Tagy/arduino.html" title="arduino">arduino</a>, <a href="../../Tagy/hardware.html" title="hardware">hardware</a>, <a href="../../Tagy/programovani.html" title="programovani">programovani</a></p>
    </div>
    <div>
      <h3>Blog categories</h3>
      <ul class="no_icon">
        <li>
          <a href="../3D_modelovani.html" title="3D modelování">📂 3D modelování</a>
        </li>
        <li>
          <a href="../3D_tisk.html" title="3D tisk">📂 3D tisk</a>
        </li>
        <li>
          <a href="../Abclinuxu.html" title="Abclinuxu">📂 Abclinuxu</a>
        </li>
        <li>
          <a href="../Crypto.html" title="Crypto">📂 Crypto</a>
        </li>
        <li>
          <a href="../Hardware.html" title="Hardware">📂 Hardware</a>
        </li>
        <li>
          <a href="../Hrbitov.html" title="Hřbitov">📂 Hřbitov</a>
        </li>
        <li>
          <a href="../Knihy.html" title="Knihy">📂 Knihy</a>
        </li>
        <li>
          <a href="../Ostatni.html" title="Ostatní">📂 Ostatní</a>
        </li>
        <li>
          <a href="../Povidky.html" title="Povídky">📂 Povídky</a>
        </li>
        <li>
          <a href="../Predstaveni.html" title="Představení">📂 Představení</a>
        </li>
        <li>
          <a href="../Programovani.html" title="Programování">📂 Programování</a>
        </li>
        <li>
          <a href="../index.html" title="Czech section">📂 Czech section</a>
        </li>
      </ul>
    </div>
  </div><a href="../../index.html" class="breadcrumb" title="Bystroushaak's blog">Bystroushaak's blog</a> / <a href="../index.html" class="breadcrumb" title="Czech section">Czech section</a> / <a href="index.html" class="breadcrumb" title="Hardware">Hardware</a> / Jak na programy z Arduina v ATmega8 bez bootloaderu
  <article id="f53d7f07-e452-4f1a-bea8-b534abdb2e19" class="page sans">
    <header>
      <h1 class="page-title">Jak na programy z Arduina v ATmega8 bez bootloaderu</h1>
    </header>
    <div class="page-body">
      <p id="730e45be-3400-4b95-9d23-487906a8f300" class=""><time>@2011/05/14</time></p>
      <p id="5a631dea-9f14-4eb7-b6d0-d958f4522610" class="">V tomto blogpostu jsou popsány dvě věci - jak použít Arduino jako programátor pro rodinu AVR a jak použít programy z Arduina v ATmega8-16PU bez nutnosti bootloaderu a dalších opičin.</p>
      <p id="ffeb9a2c-d9bd-4054-af7f-ad7957be8814" class=""><a href="http://cs.wikipedia.org/wiki/Arduino">Arduino</a> mám už nějaký ten pátek a musím říct, že je to skvělá věc. Stovky knihoven, jednoduché, přesto mocné a snadno pochopitelné API, zabudovaná podpora USB, příjemné, multiplatformní IDE .. co víc si přát? Jediný jeho "problém" je cena. Přeci jen stojí <a href="http://www.czechduino.cz/">nemalé peníze</a> a tak není úplně optimální ho zabudovávat do projektů na trvalo.</p>
      <p id="0955c08b-432f-4fcf-9a54-79dfb3f18db4" class="">Naštěstí existuje způsob, jak tento problém odstranit - nepoužívat celé Arduino, ale jen samotný čip s regulátorem napětí. Je jasné že přijdete o možnost komunikace s počítačem, ale to se mi nezdá jako nevýhoda - předpokládám že na Arduinu program ozkoušíte a pak ho již funkční vpálíte do standalone ATmegy. Doma se mi už delší dobu válí pár ATmega8-16PU ještě z doby kdy stály cca 70kč, takže to budu demonstrovat na nich. Pokud je nemáte, můžete klidně použít jejich novější verzi - <a href="http://www.gme.cz/cz/atmega88-20pu-p432-191.html">ATmega88</a>, nebo něco výkonnějšího.</p>
      <h1 id="ed63f3b3-7d83-45b9-b1f9-fc0a98b09c65" class="">Jak na to?</h1>
      <p id="6997b545-91c1-4e45-bc70-af4c3cb0d672" class="">Celý postup se dá rozdělit do těchto kroků:</p>
      <h2 id="d8c1fdf3-642a-4e72-978e-83d67afc58fc" class="">I. Zapojení podle schématu</h2>
      <p id="a94c3482-281d-4e7d-b273-ad704351eea2" class="">Na začátku je zapotřebí zapojit obvod podle následujícího schématu:</p>
      <figure id="f7cca947-573c-4025-a25a-47dc76452434" class="image">
        <a href="Jak_na_programy_z_Arduina_v_ATmega8_bez_bootloaderu/Untitled.png" title="Untitled.png"><img style="width:319px" src="Jak_na_programy_z_Arduina_v_ATmega8_bez_bootloaderu/Untitled.png"></a>
      </figure>
      <h2 id="d54a72f6-7d56-4f99-8c8d-3db8ba907a3d" class="">II. Upload programátoru do Arduina</h2>
      <p id="d63b59b4-df51-4ada-ba80-7307b64235e7" class="">Dál následuje přeměna Arduina na programátor. Jedná se o velice jednoduchý krok - stačí si stáhnout <a href="http://code.google.com/p/mega-isp/">mega-isp</a> sketch. Poté co jej flashnete do Arduina se z něj stane primitivní, ale pro naše účely postačující programátor.</p>
      <h2 id="cc481e55-2317-4249-ba89-54d233f84991" class="">III. Změna konfiguračního souboru</h2>
      <p id="412bfa94-33f7-43fc-b42d-37c6e24dc944" class="">Protože <a href="http://arduino.cc/en/Main/Software">Arduino IDE</a> normálně používá jiné čipy, je zapotřebí mu sdělit že chceme kompilovat pro <em>náš</em> mikroprocesor. Ve složce <strong>arduino-00{V}/hardware/arduino</strong> (kde {V} je současná verze, v době psaní článku 22) najdete soubor <strong>boards.txt</strong>. Otevřete ho a přidejte na konec cosi jako:</p>
      <pre id="4bd73bb6-434e-49a3-b1e9-b9719b8f926a" class="code code-wrap"><code>atmega8noxtal.name=ATmega8-noxtal @8MHz

atmega8noxtal.upload.protocol=stk500
atmega8noxtal.upload.maximum_size=7168
atmega8noxtal.upload.speed=38400

atmega8noxtal.bootloader.low_fuses=0xe4
atmega8noxtal.bootloader.high_fuses=0xc4
atmega8noxtal.bootloader.path=atmega8_noxtal
atmega8noxtal.bootloader.file=ATmegaBOOT.hex
atmega8noxtal.bootloader.unlock_bits=0x3F
atmega8noxtal.bootloader.lock_bits=0x0F

atmega8noxtal.build.mcu=atmega8
atmega8noxtal.build.f_cpu=8000000L
atmega8noxtal.build.core=arduino</code></pre>
      <p id="149badc0-07a6-408e-865a-bcf0a39eddd7" class="">Povšiměte si hlavně řádek s parametry <strong>build.f_cpu</strong> a <strong>build.mcu</strong>, kam dosaďte frekvenci na které váš čip poběží (8000000L je vhodné pro interní oscilátor) a vámi používaný čip (parametr je pro avr-gcc, najdete ho v <a href="http://linux.die.net/man/1/avr-gcc">manu</a>). Upravený soubor uložte.</p>
      <h2 id="3366e22e-0c06-40fe-9610-55a541848789" class="">IV. Kompilace programu</h2>
      <p id="10927668-411e-4497-8a01-bc8ef67e583f" class="">Spusťte IDE. V záložce <strong>Tools/Boards</strong> se vám objevila nová deska (<strong>ATmega8-noxtal @8MHz</strong>) - vyberte jí.</p>
      <p id="2b4d5e3c-29ef-4c54-a1b8-39019b5ab0c0" class="">Nyní si něco naprogramujte, můžete použít třeba základní sketch z File/Examples/Basics/Blink, nezapomeňte však na potřebný výstup připojit diodu. Já jsem použil toto:</p>
      <pre id="cecd94f8-58bc-4883-8429-67bb58860947" class="code code-wrap"><code>#define LEDPIN 8
 
void setup(){
  pinMode(LEDPIN, OUTPUT);
}
 
void loop(){
  digitalWrite(LEDPIN, HIGH);   // sets the LED on
  delay(1000);                  // waits for a second
  digitalWrite(LEDPIN, LOW);    // sets the LED off
  delay(1000);                  // waits for a second
}</code></pre>
      <p id="c1713f7f-4547-4074-96e3-adc460f4e7c8" class="">Nyní program <span style="border-bottom:0.05em solid">zkompilujte</span> kliknutím na ikonu šipky v levo nahoře. <strong>Nepokoušejte se program uploadnout, nevložil by se do čipu, ale do Arduina!</strong></p>
      <h2 id="53046b6c-fa02-40de-a389-6a8c4430edab" class="">V. Upload</h2>
      <p id="e22dc411-f24e-4e5e-af5e-7326d103b08b" class="">Doufám že máte nainstalované <a href="http://www.nongnu.org/avrdude/">avrdude</a>, pokud ne, nainstalujte si ho.</p>
      <p id="19457324-bbbc-4b16-ac32-e63b197b6384" class="">Další část je poněkud .. nečistá. Otevřete si /tmp a najděte složku se jménem začínajícím na <strong>build</strong>. Nezavírejte během toho IDE, jinak se smaže. Otevřete si v ní konzoli a zadejte příkaz</p>
      <pre id="454cd4b0-28bb-4d0f-a79c-0f83c47f7905" class="code code-wrap"><code>avrdude -C /etc/avrdude.conf -p m8 -c avrisp -b 19200 -P /dev/ttyUSB0 -U flash:w:`ls *.hex`</code></pre>
      <p id="ec469a1c-a595-4698-a490-fb4d249ea9fd" class="">Za <strong>m8</strong> dosaďte váš čip dle <a href="http://linux.die.net/man/1/avrdude">manuálu</a> avrdude.</p>
      <pre id="41caa603-eb41-4854-b488-14824cbbccd9" class="code code-wrap"><code>bystrousak@kitakitsune:/tmp/build5859820408225631991.tmp$ avrdude -C /etc/avrdude.conf -p m8 -c avrisp -b 19200 -P /dev/ttyUSB0 -U flash:w:`ls *.hex`

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.12s

avrdude: Device signature = 0x1e9307
avrdude: NOTE: FLASH memory has been specified, an erase cycle will be performed
         To disable this feature, specify the -D option.
avrdude: erasing chip
avrdude: reading input file "AtMega8_sigle_blink.cpp.hex"
avrdude: input file AtMega8_sigle_blink.cpp.hex auto detected as Intel Hex
avrdude: writing flash (812 bytes):

Writing | ################################################## | 100% 1.27s

avrdude: 812 bytes of flash written
avrdude: verifying flash memory against AtMega8_sigle_blink.cpp.hex:
avrdude: load data flash data from input file AtMega8_sigle_blink.cpp.hex:
avrdude: input file AtMega8_sigle_blink.cpp.hex auto detected as Intel Hex
avrdude: input file AtMega8_sigle_blink.cpp.hex contains 812 bytes
avrdude: reading on-chip flash data:

Reading | ################################################## | 100% 1.46s

avrdude: verifying ...
avrdude: 812 bytes of flash verified

avrdude: safemode: Fuses OK

avrdude done.  Thank you.

bystrousak@kitakitsune:/tmp/build5859820408225631991.tmp$</code></pre>
      <h2 id="19b5af92-094f-4252-878c-8842a927ce99" class="">Co dělat když to nejde</h2>
      <p id="cbde740d-9fd1-4853-a48a-f73037a49e25" class="">Pokud se vám stane, že avrdude vypisuje cosi jako</p>
      <pre id="94fe5224-4674-4412-ba45-750804697eb9" class="code code-wrap"><code>avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.12s

avrdude: Device signature = 0x000000
avrdude: Yikes!  Invalid device signature.
         Double check connections and try again, or use -F to override
         this check.


avrdude done.  Thank you.</code></pre>
      <p id="901bcf30-4802-493a-8ab2-2651db8df71f" class="">neklesejte na mysli a zkontrolujte zapojení drátů - tahle chyba typicky nastává pokud dráty nemají kontakt, čip je zablokovaný (teba jste v minulosti použili špatné fuse), nebo vypálený.</p>
      <h1 id="f0a8021b-a22c-4c55-9189-902577773e34" class="">Odkazy</h1>
      <ul id="65629308-f2b4-42f1-bca1-32a85db10288" class="bulleted-list">
        <li style="list-style-type:disc">
          <a href="http://www.arduino.cc/en/Main/PinMapping">Piny</a> - porovnání pinů ATmega8 s označeními použitými v Arduinu
        </li>
      </ul>
      <ul id="fdfa1b02-ad35-4550-bb2b-f418c6e7b3fe" class="bulleted-list">
        <li style="list-style-type:disc">
          <a href="http://www.arduino.cc/playground/Learning/AtmegaStandalone">Atmega Standalone</a> - nějaká ta teorie, ovšem zdaleka ne všechna
        </li>
      </ul>
      <ul id="02a458fa-5ed2-4bec-ae04-e4b4615041fa" class="bulleted-list">
        <li style="list-style-type:disc">
          <a href="http://letsmakerobots.com/node/16014">Programming an atmega with the Arduino IDE</a> - odsud jsem kdysi získal inspiraci
        </li>
      </ul>
      <ul id="50938743-dfae-42b7-a8b7-4572917776c1" class="bulleted-list">
        <li style="list-style-type:disc">
          <a href="http://kitakitsune.org/">kitakitsune.org</a> - něco pro zlepšení SEO :P
        </li>
      </ul>
      <ul id="128cbb1a-3608-4061-8c0a-af29df85e7c9" class="bulleted-list">
        <li style="list-style-type:disc">
          <a href="http://todbot.com/blog/2009/05/26/minimal-arduino-with-atmega8/">ATmega8 s nějakými těmi stabilizačními obvody</a>
        </li>
      </ul>
      <h1 id="fbd18e34-4cbd-4ca5-aa6a-303368f4e48a" class="">Závěr</h1>
      <p id="27859119-905b-45f1-95fa-a6ce411a3e1f" class="">Jedná se o poměrně užitečnou schopnost IDE, protože kdo někdy zkusil programovat AVR v čistém C, určitě mi dá za pravdu že programovat Arduino je mnohokrát jednodušší a komfortnější. Doufám že tento blogpost pomůže těm kteří by to sami nezvládli a ukáže možnost těm, které to nenapadlo.</p>
      <p id="94324c49-ab07-41e7-9666-b0fed1dbca85" class="">Na závěr bych rád poděkoval <a href="http://asciiwolf.com/">AsciiWolfovi</a>, že mě svými dotazy donutil tohle sepsat :).</p>
      <p id="4923f2b8-0733-4dd1-b564-7ce61a1a1d4d" class=""></p>
    </div>
  </article>
  <div class="corner-ribbon top-right red">
    <a href="https://www.patreon.com/bePatron?u=2618881">Become a Patron</a>
  </div><a class="twitter-share-button" id="twitter_button" href="#"><img src="../../tweet_button.svg"></a>
  <div id="sidebar_bottom">
    <hr>
    <p>Did you enjoy the blogpost? Here are other posts from this blog:</p>
    <div id="last_five_bottom">
      <ul>
        <li>
          <a href="../Programovani/Jak_na_vlastni_LLM_GPT.html" title="Jak na vlastní LLM (GPT)">Jak na vlastní LLM (GPT)</a>
        </li>
        <li>
          <a href="../Povidky/Software.html" title="Software">Software</a>
        </li>
        <li>
          <a href="../Ostatni/Paromobilita_je_budoucnost.html" title="Paromobilita je budoucnost">Paromobilita je budoucnost</a>
        </li>
        <li>
          <a href="../Ostatni/Algoritmus_hledani_programatorske_prace_2021-4.html" title="Algoritmus hledání programátorské práce 2021/4">Algoritmus hledání programátorské práce 2021/4</a>
        </li>
        <li>
          <a href="../3D_tisk/Nastaveni_Blenderu_pro_3D_tisk.html" title="Nastavení Blenderu pro 3D tisk">Nastavení Blenderu pro 3D tisk</a>
        </li>
        <li>
          <a href="../3D_modelovani/Geometricky_stred_Prahy.html" title="Geometrický střed Prahy">Geometrický střed Prahy</a>
        </li>
        <li>
          <a href="../../Utrzky/Posta_poezie.html" title="Pošta (poezie)">Pošta (poezie)</a>
        </li>
        <li>
          <a href="../Ostatni/Statni_zklamani.html" title="Státní zklamání">Státní zklamání</a>
        </li>
        <li>
          <a href="../3D_tisk/3D_TODO_list_1_Drzak_na_sluchatka.html" title="3D TODO list 1; Držák na sluchátka">3D TODO list 1; Držák na sluchátka</a>
        </li>
        <li>
          <a href="../Ostatni/Dva_podvodnici.html" title="Dva podvodníci">Dva podvodníci</a>
        </li>
      </ul>
    </div>
    <p>You can find <a href="../../Zmeny.html" title="Změny">many more in changelog</a>..</p>
    <div>
      <h3>Tagy</h3>
      <p><a href="../../Tagy/arduino.html" title="arduino">arduino</a>, <a href="../../Tagy/hardware.html" title="hardware">hardware</a>, <a href="../../Tagy/programovani.html" title="programovani">programovani</a></p>
    </div>
    <div>
      <h3>Blog categories</h3>
      <ul class="no_icon">
        <li>
          <a href="../3D_modelovani.html" title="3D modelování">📂 3D modelování</a>
        </li>
        <li>
          <a href="../3D_tisk.html" title="3D tisk">📂 3D tisk</a>
        </li>
        <li>
          <a href="../Abclinuxu.html" title="Abclinuxu">📂 Abclinuxu</a>
        </li>
        <li>
          <a href="../Crypto.html" title="Crypto">📂 Crypto</a>
        </li>
        <li>
          <a href="../Hardware.html" title="Hardware">📂 Hardware</a>
        </li>
        <li>
          <a href="../Hrbitov.html" title="Hřbitov">📂 Hřbitov</a>
        </li>
        <li>
          <a href="../Knihy.html" title="Knihy">📂 Knihy</a>
        </li>
        <li>
          <a href="../Ostatni.html" title="Ostatní">📂 Ostatní</a>
        </li>
        <li>
          <a href="../Povidky.html" title="Povídky">📂 Povídky</a>
        </li>
        <li>
          <a href="../Predstaveni.html" title="Představení">📂 Představení</a>
        </li>
        <li>
          <a href="../Programovani.html" title="Programování">📂 Programování</a>
        </li>
        <li>
          <a href="../index.html" title="Czech section">📂 Czech section</a>
        </li>
      </ul>
    </div>
    <h3>Follow this blog</h3>
    <div>
      <a href="https://blog.rfox.eu/atom_cz.xml"><img src="../../rss_icon.png" style="width: 5em;"></a>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a href="https://twitter.com/Bystroushaak"><img src="../../twitter_icon.png" style="width: 5em;"></a>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<a href="https://www.patreon.com/bePatron?u=2618881"><img src="../../patreon.png" style="width: 5em;"></a>
    </div>
  </div>
</body>
</html>
